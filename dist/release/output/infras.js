!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var e="0.0.7";let t=null;const n=["off","error","warn","info","log","debug","trace"];let o={};function r(e){const t=global.Env&&global.Env.logLevel||"log";return o[t]&&o[t][e]}var l={setNativeConsole:function(){t=global.console,n.forEach(e=>{const t=n.indexOf(e);o[e]={},n.forEach(r=>{n.indexOf(r)<=t&&(o[e][r]=!0)})});{const{trace:e,debug:t,log:n,info:o,warn:l,error:s,time:i,timeEnd:a}=console,c=console;console._ori={trace:e,debug:t,log:n,info:o,warn:l,error:s,time:i,timeEnd:a},c.trace=((...e)=>{r("trace")&&console._ori.debug.apply(console,e)}),c.debug=((...e)=>{r("debug")&&(console._ori.debug||console._ori.trace).apply(console,e)}),c.log=((...e)=>{r("log")&&console._ori.log.apply(console,e)}),c.info=((...e)=>{r("info")&&console._ori.info.apply(console,e)}),c.warn=((...e)=>{r("warn")&&console._ori.warn.apply(console,e)}),c.error=((...e)=>{r("error")&&console._ori.error.apply(console,e)}),c.time=((...e)=>{global.Env.enableLogTime&&r("info")&&console._ori.time&&console._ori.time.apply(console,e)}),c.timeEnd=((...e)=>{global.Env.enableLogTime&&r("info")&&console._ori.timeEnd&&console._ori.timeEnd.apply(console,e)})}},resetNativeConsole:function(){o={},global.console=t}};let s=null;function i(e){return"string"==typeof e?{uri:e}:"object"==typeof e?e:void 0}var a={setNativeRouter:function(){if(s=global.history){const{go:e,back:t,push:n,replace:o}=s;global.history._ori={go:e,back:t,push:n,replace:o},global.history.go=((...e)=>{global.history._ori.go.apply(global.history,e)}),global.history.back=(()=>{global.history._ori.back.apply(global.history)}),global.history.forward=(()=>{}),global.history.push=((...e)=>{const t=i(e);t&&global.history._ori.push.apply(global.history,t)}),global.history.replace=((...e)=>{const t=i(e);t&&global.history._ori.replace.apply(global.history,t)})}else global.history={go:function(...e){},back:function(...e){},forward:function(...e){},push:function(...e){},replace:function(...e){}}},resetNativeRouter:function(){global.history=s}};let c=null,u=null,p=null,d=null,h=null,f=null,g=null,m=null,b=null;var v={setNativeConsole:l.setNativeConsole,resetNativeConsole:l.resetNativeConsole,setNativeTimer:function(){c=global.setTimeout,u=global.setInterval,p=global.requestAnimationFrame,d=global.clearTimeout,h=global.setTimeoutNative,f=global.clearInterval,g=global.setIntervalNative,m=global.cancelAnimationFrame,b=global.requestAnimationFrameNative;const e={};let t=0;"function"==typeof h&&(global.setTimeoutWrap=function(n,o,r){return e[++t]=o,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### setTimeoutWrap ${t}----`),h(n,t,r),t},global.setTimeout=function(e,t){return global.setTimeoutWrap(-1,e,t)},global.setTimeoutCallback=function(t){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### setTimeout 执行回调 ${t}----`),"function"==typeof e[t]&&(e[t](),delete e[t])},global.clearTimeout=global.clearTimeoutWrap=function(t){"function"==typeof d&&d(t),"function"==typeof e[t]?delete e[t]:e[t]=void 0}),"function"==typeof g&&(global.setIntervalWrap=function(n,o,r){return e[++t]=o,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### setIntervalWrap ${t}----`),g(n,t,r),t},global.setInterval=function(e,t){return global.setIntervalWrap(-1,e,t)},global.setIntervalCallback=function(t){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### setInterval 执行回调 ${t}----`),"function"==typeof e[t]&&e[t]()},global.clearInterval=global.clearIntervalWrap=function(t){"function"==typeof f&&f(t),"function"==typeof e[t]?delete e[t]:e[t]=void 0}),"function"==typeof b&&(global.requestAnimationFrameWrap=function(n,o){return e[++t]=o,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### requestAnimationFrame ${t}----`),b(n,t),t},global.requestAnimationFrame=function(e){return global.requestAnimationFrameWrap(-1,e)},global.requestAnimationFrameCallback=function(n){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### requestAnimationFrame 执行回调 ${t}----`),"function"==typeof e[n]&&e[n]()},global.cancelAnimationFrame=global.cancelAnimationFrameWrap=function(t){"function"==typeof m&&m(t),"function"==typeof e[t]?delete e[t]:e[t]=void 0})},resetNativeTimer:function(){global.setTimeout=c,global.clearTimeout=d,global.clearTimeoutWrap=null,global.setTimeoutCallback=null,global.setTimeoutWrap=null,global.setInterval=u,global.clearInterval=f,global.clearIntervalWrap=null,global.setIntervalCallback=null,global.setIntervalWrap=null,global.requestAnimationFrame=p,global.cancelAnimationFrame=m,global.cancelAnimationFrameWrap=null,global.requestAnimationFrameCallback=null,global.requestAnimationFrameWrap=null},setNativeRouter:a.setNativeRouter,resetNativeRouter:a.resetNativeRouter,freezePrototype:function(){Object.freeze(Object),Object.freeze(Array),Object.freeze(Object.prototype),Object.freeze(Array.prototype),Object.freeze(String.prototype),Object.freeze(Number.prototype),Object.freeze(Boolean.prototype),Object.freeze(Error.prototype),Object.freeze(Date.prototype),Object.freeze(RegExp.prototype)}};function y(e,t,n){return"function"==typeof global.compileAndRunScript?function(e,t,n){let o="(function (";const r=[],l=[];for(const t in e)r.push(t),l.push(e[t]);for(let e=0;e<r.length-1;++e)o+=r[e],o+=",";o+=r[r.length-1],o+=") {",o+=t,o+="} )";const s=global.compileAndRunScript(o,n);return s&&"function"==typeof s?s(...l):s}(e,t,n):function(e,t){const n=[],o=[];for(const t in e)n.push(t),o.push(e[t]);return n.push(t),new Function(...n)(...o)}(e,t)}function E(e){const t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()}function _(e){const t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}const w=/-(\w)/g,N=_(e=>e.replace(w,A));function A(e,t){return t?t.toUpperCase():""}const T=/([a-z\d])([A-Z])/g,$=_(e=>e.replace(T,"$1-$2").toLowerCase());function O(e){return null!==e&&"object"==typeof e}let k=0;function C(){return++k}const S={},P={};let I={};const L={MODE:{SYNC:0,CALLBACK:1,SUBSCRIBE:2},TYPE:{METHOD:0,ATTRIBUTE:1,EVENT:2},NORMALIZE:{RAW:0,JSON:1},RESULT:{MODULE_INST:0}};function R(e,t,n){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### require模块：${t}`);const o=[t];let r,l={};if(t.indexOf(".")<0){const e=t+".";for(const t in J())t.startsWith(e)&&o.push(t)}if(o.forEach(o=>{const s=J()[o];if(!s)return;let i=o.replace(t,"");if("."===i.substr(0,1)&&(i=i.substr(1)),s.instantiable){const e=function(...t){const n=e.__init__(...t);Object.defineProperty(this,"_instId",{enumerable:!1,configurable:!1,writable:!1,value:n&&n.instId})};if(0===i.length)l=e;else{const t=i.split(".");if(t.length>0){const n=t.pop();F(l,t)[n]=e}}}if(o===t)r=l;else if(i.length>0){const e=i.split(".");e.length>0&&(r=F(l,e))}!function(e,t,n,o){const r=n.methods;for(const l in r){const s=r[l],i=s.instanceMethod?t.prototype:t;l in i&&console.warn(`### App Framework ### 模块${n.name}的接口函数${l}---- 重复定义`);const a=function(...t){if(e._isApp&&!e._defined)throw new Error(`请确认Native方法调用[${n.name}.${l}()]发生在应用app的生命周期的创建['onCreate()']之后`);const r=Object.prototype.hasOwnProperty.call(this,"_instId")?this._instId:o;return x(e,n,s,t,r)};Object.defineProperty(i,l,{configurable:!1,enumerable:!0,get(){return a.bind(this)},set(e){console.warn(`### App Framework ### 接口${n.name}的方法(${l})为可读，不可覆盖`)}}),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### require---- 模块${n.name}接口函数${l}`)}const l=n.attributes;for(const e in l){const o=l[e],r=o.instanceMethod?t.prototype:t;Object.defineProperty(r,e,{configurable:!1,enumerable:!0,get(){if(o[1])return this[o[1].name]();console.warn(`### App Framework ### 模块${n.name}的接口属性(${e})不可读`)},set(t){o[2]?this[o[2].name]({value:t}):console.warn(`### App Framework ### 模块${n.name}的接口属性(${e})不可写`)}})}const s=n.events;for(const e in s){const o=s[e];o.cache=o.cache||{};const r=o.instanceMethod?t.prototype:t;Object.defineProperty(r,e,{configurable:!1,enumerable:!0,get(){const e=void 0===this._instId?-1:this._instId;return o.cache[e]},set(t){if("function"!=typeof t&&-1===[null,void 0].indexOf(t))console.warn(`### App Framework ### 模块${n.name}的接口事件(${e})值类型必须是函数或null`);else{const e=void 0===this._instId?-1:this._instId,n="function"==typeof t?t.bind(this):t;this[o.name]({success:n}),o.cache[e]=t}}})}}(e,r,s,n)}),0===Object.keys(l).length)throw new Error(`请确认引入的模块[${t}]：名称正确并且在manifest.json的features中声明`);return l}function F(e,t){if(!e)return;let n=e;return t.forEach(e=>{e in n||(n[e]={}),n=n[e]}),n}const j=["success","cancel","fail","complete"];function x(e,t,n,o,r){const{name:l,type:s}=t,{name:i,mode:a,type:c,normalize:u}=n;if(!e._callbacks)return console.warn(`### App Framework ### 容器已销毁,接口调用(${l}.${i}())无效`),new Error("invokeNative: 容器已销毁");if("feature"===s&&!global.JsBridge)return new Error("invokeNative: JsBridge没有初始化");if("module"===s&&!global.ModuleManager)return new Error("invokeNative: ModuleManager没有初始化");const p="feature"===s?global.JsBridge:global.ModuleManager,d=o.length>0?o[0]:{};d&&d.callback&&(d.success&&console.warn("### App Framework ### invoke函数不能同时出现'success'和'callback'参数"),d.success=d.callback);let h={};const f={};if(O(d))for(const t in d){const n=d[t];j.indexOf(t)>=0?"function"==typeof n?f[t]=n:console.warn(`### App Framework ### invoke函数的回调参数${t}类型不是function`):"callback"!==t&&(u===L.NORMALIZE.JSON?h[t]=D(n,e):h[t]="function"==typeof t?D(n,e):n)}else"function"==typeof d?f.success=d:h=d;if(u===L.NORMALIZE.JSON&&(h=JSON.stringify(h)),a===L.MODE.SYNC){const n=p.invoke(l,i,h,"-1",r);return null==n?void console.warn(`### App Framework ### invoke函数 '${l}.${i}' 返回值为null`):(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### invoke函数 '${l}.${i}' 调用成功，返回值为: ${n}`),M(e,n,t,i).data)}{let n,o,s;c===L.TYPE.METHOD&&a===L.MODE.CALLBACK&&(f.flagCallback=!0);const u=[];if(Object.keys(f).length){const r=global.isRpkMinPlatformVersionGEQ(1040)?void 0:f,l=C();e._callbacks[l]=(l=>{const a=f,c=M(e,l,t,i),u=c.code,p=c.data;0===u&&a.success?a.success.call(r,p):100===u&&a.cancel?a.cancel.call(r):u>=200&&a.fail&&a.fail.call(r,p,u),a.complete&&a.complete.call(r,p),n&&(0===u?o({data:p}):s({data:p,code:u}))}),S[l]={instance:e.id.toString(),preserved:a===L.MODE.SUBSCRIBE},u.push(h),u.push(l.toString())}else u.push(h),u.push("-1");if(p.invoke(l,i,...u,r),c===L.TYPE.METHOD&&a===L.MODE.CALLBACK&&1===Object.keys(f).length)return n=new Promise((e,t)=>{o=e,s=t})}}function M(e,t,n,o){const r="string"==typeof t?JSON.parse(t):t||{},l=r.content;return l&&l._nativeType===L.RESULT.MODULE_INST?(n.instantiable&&"__init__"===o?r.data=l:r.data=R(e,l.name,l.instId),e._nativeInstList&&e._nativeInstList.push(t)):r.data=l,r}function D(e,t){switch(E(e)){case"undefined":case"null":return"";case"regexp":return e.toString();case"date":return e.toISOString();case"number":case"string":case"boolean":case"array":case"object":return e;case"function":const n=C();return t._callbacks?t._callbacks[n]=e:global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### normalize() inst实例已经销毁，不再注册回调"),S[n]={instance:t.id.toString(),preserved:!1},n.toString();default:return JSON.stringify(e)}}function B(e,t){P[e]=t}function J(){return I}class W{constructor(e){this.id=e,this._callbacks={},this._nativeInstList=[],B(e,this)}invoke(e,t,n,o){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 调用对象(${e.id})的回调(${t}) 参数：`,JSON.stringify(n));const r=e._callbacks[t];if("function"==typeof r){const l=r(n);return void 0!==o&&!1!==o||(e._callbacks[t]=void 0),l}return new Error(`invoke: 无效invoke回调函数Id "${t}"`)}destroy(){this._callbacks=null,this._nativeInstList=null,B(this.id,null)}}let z={};const H={};class U{constructor(e="message",t={}){this.type=e,this.data=t.data||null,this.timeStamp=Date.now()}}const q={};function G(e,t=null){q[e]=t}var V={init:function(){v.setNativeConsole(),v.setNativeTimer(),v.setNativeRouter()},exposeToNative:function(e){for(const t in e)global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 注册全局函数----",t),global[t]=((...n)=>{const o=e[t](...n);return o instanceof Error&&console.error(o.toString()),o})},defineBundle:G,requireBundle:function(e){if(e=e.replace(/\.js$/,""),!q[e]){let t=global.readResource(`assets:///js/bundles/${e}.js`);"string"==typeof t&&(t=y({},`${t}; return ${e}`,`/bundles/${e}.js`)),G(e,t)}return q[e]},loadResource:function(e){return global.readResource(e)},BroadcastChannel:class{constructor(e){if(global.Env.engine===global.ENGINE_TYPE.CARD)throw new Error("BroadcastChannel is not supported.");Object.defineProperty(this,"name",{configurable:!1,enumerable:!0,writable:!1,value:String(e)}),this._closed=!1,this.onmessage=null,H[this.name]||(H[this.name]=[]),H[this.name].push(this)}postMessage(e){if(this._closed)throw new Error(`BroadcastChannel "${this.name}" is closed.`);const t=H[this.name];if(t&&t.length)for(let n=0;n<t.length;++n){const o=t[n];o._closed||o===this||"function"==typeof o.onmessage&&o.onmessage(new U("message",{data:e}))}}close(){if(!this._closed&&(this._closed=!0,H[this.name])){const e=H[this.name].indexOf(this);e>-1?H[this.name].splice(e,1):delete H[this.name]}}},ENGINE_TYPE:{PAGE:"page",CARD:"card"},ModuleHost:W,requireModule:R,exposure:{registerModules:function(e,t="feature"){"string"==typeof e&&(e=JSON.parse(e)),global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### registerModules---- ",JSON.stringify(e)),"object"==typeof(e=e.map(function(e){return e.__type__=t,e}))&&function(e,t=!0){let n=[];Array.isArray(e)?n=e:n.push(e),n.forEach(e=>{const n=e.name;global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 注册模块---- ${n} <${e.__type__}>`);let o=I[n];o||(o={type:e.__type__,name:e.name,methods:{},attributes:{},events:{},instantiable:e.instantiable},I[n]=o),o.methods||(o.methods={});const r=o.methods;e.methods&&e.methods.length&&e.methods.forEach(e=>{const l=e.name;if(void 0===e.mode&&(e.mode=L.MODE.SYNC),void 0===e.type&&(e.type=L.TYPE.METHOD),void 0===e.normalize&&(e.normalize=L.NORMALIZE.JSON),void 0===e.instanceMethod&&(e.instanceMethod=!1),!o.instantiable&&e.instanceMethod)throw new Error(`模块 ${o.name} 配置定义错误`);if(e.type===L.TYPE.ATTRIBUTE){const t=e.alias,n=e.access;o.attributes[t]=o.attributes[t]||{},o.attributes[t][n]=e,o.attributes[t].instanceMethod=e.instanceMethod}else if(e.type===L.TYPE.EVENT){const t=e.alias;o.events[t]=e}l?r[l]&&!t||(r[l]=e,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 注册模块 ${n} 接口---- ${l}`)):console.warn(`### App Framework ### 模块 ${n} 的接口没有name属性`)})})}(e)},execInvokeCallback:function(e){"string"==typeof e&&(e=JSON.parse(e));const t=function(e){const t=S[e];return t&&!0===t.preserved||(S[e]=void 0),t}(e.callback);if(global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 处理invoke回调----",JSON.stringify(t)),t){const n=function(e){return P[e]}(t.instance);if(n){const o=[n,e.callback,e.data,t.preserved];return n._callbacks?n.invoke(...o):new Error(`execInvokeCallback: 回调函数所属对象已经无效 "${n.id}"`)}}return new Error(`execInvokeCallback: 无效invoke回调Id "${t&&t.instance}"`)},registerManifest:function(e){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 注册manifest信息：${JSON.stringify(e)}`),"string"==typeof e&&(e=JSON.parse(e)),z=e||{}},getManifestField:function(e){const t=e.split(".");let n=z;for(let e=0,o=t.length;e<o&&null!=(n=n[t[e]]);e++);return n},isRpkMinPlatformVersionGEQ:function(e){return z.minPlatformVersion>=e}}};class Y{constructor(e,t={bubbles:!1,cancelable:!1}){if(arguments.length>1&&"object"!=typeof t)throw new Error(`### App Runtime ### addEventListener() 参数2传递的话，必须是对象：${t}`);this._type=e,this._bubbles=t.bubbles,this._cancelable=t.cancelable,this._target=null,this._currentTarget=null,this._eventPhase=Y.NONE,this._defaultPrevented=!1,this._timeStamp=Date.now(),this._supportW3C=!0,this._flagStopPropagation=!1,this._flagStopImmediatePropagation=!1,this._throwError=!0}get type(){return this._type}get bubbles(){return this._bubbles}get cancelable(){return this._cancelable}get target(){return this._target}get currentTarget(){return this._currentTarget}get eventPhase(){return this._eventPhase}get defaultPrevented(){return this._defaultPrevented}get timeStamp(){return this._timeStamp}stopPropagation(){this._flagStopPropagation=!0}stopImmediatePropagation(){this._flagStopImmediatePropagation=!0,this.stopPropagation()}preventDefault(){throw new Error("### App Runtime ### preventDefault() 暂不支持该方法")}toJSON(){return{type:this._type,target:this._target,currentTarget:this._currentTarget,timeStamp:this._timeStamp}}}Y.NONE=0,Y.CAPTURING_PHASE=1,Y.AT_TARGET=2,Y.BUBBLING_PHASE=3;class X extends Y{constructor(){super(...arguments),this._touches=null,this._changedTouches=null}get touches(){return this._touches}set touches(e){if(this._touches)throw new Error("### App Framework ### TouchEvent 不支持修改 touches 属性");this._touches=e}get changedTouches(){return this._changedTouches}set changedTouches(e){if(this._changedTouches)throw new Error("### App Framework ### TouchEvent 不支持修改 changedTouches 属性");this._changedTouches=e}toJSON(){const e=super.toJSON();return Object.assign(e,{touches:this._touches,changedTouches:this._changedTouches})}}const Z={HTML_ID:"-1"},K={UNKNOWN:0,ELEMENT:1,ATTR:2,TEXT:3,COMMENT:8,DOCUMENT:9,DOCUMENT_FRAGMENT:11,FIGMENT:101};let Q=1;class ee{constructor(){this._nodeType=ee.NodeType.UNKNOWN,this._nodeName=null,this._nodeValue=null,this._ownerDocument=null,this._textContent=null,this.ref=(Q++).toString(),this.childNodes=[],this.layoutChildren=[],this.parentNode=null,this.nextSibling=null,this.previousSibling=null,this._docId=null,this._layout=!1,this._render=!1,this._renderCount=null}get nodeType(){return this._nodeType}get nodeName(){return this._nodeName}get nodeValue(){return this._nodeValue}get ownerDocument(){return this._ownerDocument}get textContent(){return this._textContent}set textContent(e){if(this.nodeType!==ee.NodeType.TEXT){const t=this.ownerDocument.createTextNode(e);this.appendChild(t)}else this._textContent=e}}ee.NodeRef=Z,ee.NodeType=K;const te={};function ne(e){return te[e]}function oe(e){const t=ne(e);return t&&t.listener?t.listener:null}function re(e,t){if(e._docId===t)return;const n=ne(t);if(n){e._docId=t,n._nodeMap[e.ref]=e;for(let t=0,n=e.childNodes.length;t<n;t++)re(e.childNodes[t],e._docId)}}function le(e,t){e.parentNode=t,t._docId&&(re(e,t._docId),e._depth=t._depth+1);for(let t=0,n=e.childNodes.length;t<n;t++)le(e.childNodes[t],e)}function se(e,t,n,o){n<0&&(n=0);const r=t[n-1],l=t[n];return t.splice(n,0,e),o&&(r&&(r.nextSibling=e||null),e.previousSibling=r||null,e.nextSibling=l||null,l&&(l.previousSibling=e||null)),n}function ie(e,t,n){const o=t.indexOf(e);if(!(o<0)){if(n){const n=t[o-1],r=t[o+1];n&&(n.nextSibling=r||null),r&&(r.previousSibling=n||null),e.previousSibling=null,e.nextSibling=null}t.splice(o,1)}}function ae(e,t,n,o){const r=t.indexOf(e);if(r<0||r===n)return-1;ie(e,t,o);let l=n;return r<=n&&(l=n-1),se(e,t,l,o),n}const ce=/^data.+/;function ue(e,t){const n=[],o=Object.assign({},t);if(e)for(let t=0,r=e.length;t<r;t++){const r=e[t];o.hasOwnProperty(r.name)?(n.push({name:$(r.name),value:o[r.name],disabled:!1}),delete o[r.name]):r.disabled&&n.push({name:$(r.name),value:r.value,disabled:r.disabled})}for(const e in o)n.push({name:$(e),value:o[e],disabled:!1});return n}const pe={};function de(e){"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)||(e=[e]),e.forEach(e=>{if(!e)return;e.name||(e.name=e.type,delete e.type),e.methods=e.methods||[],global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 注册组件---- ",JSON.stringify(e));let t=pe[e.name];t?t.methods=Array.from(new Set(t.methods.concat(e.methods))):(t=pe[e.name]=JSON.parse(JSON.stringify(e))).def={}})}function he(e){return pe[e]}function fe(e){return e._attr}function ge(e){return e._style}function me(e,t=!0,n=!1,o=!1){if(e.nodeType===K.ELEMENT){const r={ref:e.ref.toString(),type:e._type},l=function(e){if(e._styleObjectId)return e._styleObjectId;let t=e;for(;t&&!t._styleObjectId;)t=t.parentNode;return t&&(e._styleObjectId=t._styleObjectId),e._styleObjectId}(e);l&&(r.prop={_styleObjectId:l}),n&&e._styleObject&&(r.styleObject=e._styleObject);const s=fe(e);if(s&&Object.keys(s).length){r.attr={};for(const e in s){const t=s[e];r.attr[e]=-1!==[null,void 0].indexOf(t)?"":t}}const i=ge(e);if(i&&Object.keys(i).length&&(r.inlineStyle=i),o){const t=function(e){return e.mergedStyle}(e);t&&Object.keys(t).length&&(r.style=t)}const a=Object.keys(e._eventTargetListeners||{});a&&a.length&&(r.event=a);const c=e.layoutChildren||e.childNodes;if(t&&c&&c.length){const e=[];for(let r=0,l=c.length;r<l;r++){const l=c[r],s=me(l,t,n,o);ve(l)?e.push(s):e.push.apply(e,s)}r.children=e}return r}if(e.nodeType===K.FIGMENT){const r=[];if(t&&e.layoutChildren&&e.layoutChildren.length)for(let l=0,s=e.layoutChildren.length;l<s;l++){const s=e.layoutChildren[l],i=me(s,t,n,o);s.nodeType===K.FIGMENT?r.push.apply(r,i):r.push(i)}return r}if(e.nodeType===K.COMMENT)return[];global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### getNodeAsJSON() 忽略该类型(${e.nodeType})的节点序列化`)}function be(e){return e._layout}function ve(e){return e._render}function ye(e,t=!1){let n=t?e:e.parentNode;for(;n&&!ve(n);)n=n.parentNode;return n}function Ee(e){if(null!==e._renderCount)return e._renderCount;let t=ve(e)?1:0;if(be(e)&&!ve(e))for(let n=0,o=e.layoutChildren.length;n<o;n++)t+=Ee(e.layoutChildren[n]);return e._renderCount=t,t}function _e(e){let t=e;for(;t;)t._renderCount=null,t=t.parentNode}function we(e){const t=e.parentNode;if(e.nodeType===K.DOCUMENT||e.ref===Z.HTML_ID)return 0;if(!t||!be(e))return-1;const n=Ne(e,t);let o=0;return ve(t)||(o=we(t)),n<0||o<0?-1:n+o}function Ne(e,t){if(!t.layoutChildren||t.layoutChildren.length<=0)return-1;const n=t.layoutChildren.indexOf(e);if(n>0){let e=0;for(let o=0,r=n;o<r;o++)e+=Ee(t.layoutChildren[o]);return e}return n}function Ae(e){delete e._depth,delete e._tmpRenderIndexInParent,delete e._eventTargetListeners,delete e._bindWatcherList,delete e._vm,function(e){if(delete e._docId,delete e._layout,delete e._render,delete e._renderCount,delete e.nextSibling,delete e.previousSibling,delete e.parentNode,e.childNodes)for(let t=e.childNodes.length-1;t>=0;t--)Te(e.childNodes[t]);delete e.layoutChildren,delete e.childNodes,delete e._content,delete e._ownerDocument,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 销毁节点：节点(${e.ref})剩余属性有：[${Object.keys(e).join(", ")}]`)}(e)}function Te(e){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 销毁元素：${JSON.stringify(me(e,!1,!1,!1))}`),delete e._classList,delete e._styleObject,delete e._styleObjectId,delete e._useParentStyle,delete e._usedCSSPropertyCache,delete e._matchedCssRuleCache,delete e._mergedStyleCache,delete e._ownCssRuleCache,delete e._attr,delete e._style,delete e._dataset,Ae(e)}function $e(e,t,n){n instanceof Object||(n={capture:!!n});const o=t.type,r=e._eventTargetListeners[o],l=n.capture?Y.CAPTURING_PHASE:Y.BUBBLING_PHASE;if(r&&r[l]&&r[l].list){const n=r[l].list;for(let o=0,r=n.length;o<r;o++){const r=n[o];t._target=e,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### fireTargetEventListener() 事件响应:${t.type}，节点:${e.ref}`),r&&r.call(t.target,t)}}}class Oe extends ee{constructor(){super(...arguments),this._eventTargetListeners={}}addEventListener(e,t,n){if(arguments.length<2)throw new Error(`### App Runtime ### addEventListener() 至少需要传递两个参数:${arguments.length}`);if("string"!=typeof e)throw new Error("### App Runtime ### addEventListener() 参数1必须是字符串，事件类型");if("function"!=typeof t)throw new Error("### App Runtime ### addEventListener() 参数2必须是函数，监听事件");global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### addEventListener() 节点(${this.ref})注册事件(${e})`),n instanceof Object||(n={capture:!!n,once:!1,passive:!1});const o=n.capture?Y.CAPTURING_PHASE:Y.BUBBLING_PHASE,r=this._eventTargetListeners[e]=this._eventTargetListeners[e]||{};if(r[o]=r[o]||{},r[o].list=r[o].list||[],r[o].hash=r[o].hash||{},-1===r[o].list.indexOf(t)){const e=r[o].list.push(t);r[o].hash[e-1]={capture:!!n.capture,once:!!n.once,passive:!!n.passive}}const l=oe(this._docId);l&&l.addEvent(this.ref,e)}removeEventListener(e,t,n){if(arguments.length<2)throw new Error(`### App Runtime ### addEventListener() 至少需要传递两个参数:${arguments.length}`);if("string"!=typeof e)throw new Error("### App Runtime ### addEventListener() 参数1必须是字符串，事件类型");if("function"!=typeof t)throw new Error("### App Runtime ### addEventListener() 参数2必须是函数，监听事件");global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### Element ${this.ref} 执行 removeEventListener(${e})---- `),n instanceof Object||(n={capture:!!n});const o=n.capture?Y.CAPTURING_PHASE:Y.BUBBLING_PHASE,r=this._eventTargetListeners[e]=this._eventTargetListeners[e]||{};r[o]=r[o]||{},r[o].list=r[o].list||[],r[o].hash=r[o].hash||{};const l=r[o].list.indexOf(t);-1!==l&&(r[o].list.splice(l,1),r[o].hash[l]=null),0===r[o].list.length&&(r[o]=null)}dispatchEvent(e){if(!(e instanceof Y))throw new Error("### App Runtime ### dispatchEvent() 参数1所属类必须是事件类");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 执行事件:${e.type}, 来自节点:${this.ref}`),!e._supportW3C)return $e(this,e);e._target=this;const t=e.type,n=function(e,t=!1){const n=[];let o=ye(e,t);for(;o;)n.push(o),o=ye(o);return n}(this,!0),o=n.slice().reverse().concat(n);if(o[0]&&o[0].parentNode===o[0].ownerDocument){const e=o[0].ownerDocument;o.unshift(e),o.push(e)}for(;o.length>0;){const n=o[0],r=o.indexOf(n),l=o.indexOf(this);if(e._eventPhase=r<l?Y.CAPTURING_PHASE:r===l?Y.AT_TARGET:Y.BUBBLING_PHASE,e._currentTarget=n,!e.bubbles&&e.eventPhase===Y.BUBBLING_PHASE)break;global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 执行事件:${t}, 阶段:${e.eventPhase}, Target:${e.target.ref}, CurrentTarget:${e.currentTarget.ref}`);const s=n._eventTargetListeners[t];let i=e.eventPhase;if(e.target===e.currentTarget&&(i=n===o[1]?Y.CAPTURING_PHASE:Y.BUBBLING_PHASE),s&&s[i]&&s[i].list){const t=s[i].hash,o=s[i].list.slice();for(let r=0,l=o.length;r<l&&!e._flagStopImmediatePropagation;r++){const l=o[r];try{global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 事件响应:${e.type}，阶段:${e.eventPhase}`),l&&l.call(e.currentTarget,e)}catch(t){console.error(`### App Runtime ### dispatchEvent() 事件响应:${e.type}，阶段:${e.eventPhase}, JS报错:`,t.message,l),console.error(t.stack),e._throwError&&global.setTimeout(()=>{throw t},0)}t[r]&&t[r].once&&n.removeEventListener(e.type,l,t[r])}}if(e._flagStopImmediatePropagation||e._flagStopPropagation)break;o.shift()}e._currentTarget=null}}function ke(e){if(e.nodeType===ee.NodeType.ELEMENT&&e._docId)for(let t=0,n=e.layoutChildren.length;t<n;t++)ke(e.layoutChildren[t])}function Ce(e,t,n){if(t.nodeType===ee.NodeType.DOCUMENT_FRAGMENT){const o=t.childNodes.slice();for(let r=0,l=o.length;r<l;r++)t.removeChild(o[r]),Ce(e,o[r],n);return t}const o=ye(e,!0),r=n?e.childNodes.indexOf(n):e.childNodes.length,l=oe(e._docId);if(t.nodeType===ee.NodeType.TEXT)throw new Error(`### App Runtime ### 不支持在非渲染节点中添加文本节点：${t.textContent}`);if(t.parentNode){if(ae(t,e.childNodes,r,!0),be(t))if(n){const r=ae(t,e.layoutChildren,e.layoutChildren.indexOf(n));_e(e);const s=we(t);if(l&&r>=0)return l.moveNode(t,o,s)}else{const n=ae(t,e.layoutChildren,e.layoutChildren.length);_e(e);const r=we(t);if(l&&n>=0)return l.moveNode(t,o,r)}}else if(le(t,e),se(t,e.childNodes,r,!0),ke(t),be(t))if(n){se(t,e.layoutChildren,e.layoutChildren.indexOf(n)),_e(e);const r=we(t);if(l)return l.addNode(t,o,r)}else{se(t,e.layoutChildren,e.layoutChildren.length),_e(e);const n=e===o?-1:we(t);if(l)return l.addNode(t,o,n)}}class Se extends Oe{constructor(){super(...arguments),this._depth=null,this._tmpRenderIndexInParent=null}appendChild(e){if(!(e&&e instanceof ee))throw new Error("### App Runtime ### appendChild() 函数的node参数无效");if(e.parentNode&&e.parentNode!==this)throw new Error("### App Runtime ### appendChild() 参数node的父节点不匹配");return Ce(this,e,null)}insertBefore(e,t){if(!(e&&2===arguments.length&&e instanceof ee))throw new Error("### App Runtime ### insertBefore() 函数的node/before参数无效");if(e.parentNode&&e.parentNode!==this)throw new Error("### App Runtime ### insertBefore() 参数node的父节点不匹配");return e===t||e.nextSibling&&e.nextSibling===t?e:Ce(this,e,t)}removeChild(e){if(!(e&&e instanceof ee))throw new Error("### App Runtime ### removeChild() node参数无效");if(e.parentNode!==this)throw new Error("### App Runtime ### removeChild() 参数node的父节点不匹配");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### removeChild() 移除节点：${JSON.stringify(me(e,!1,!1,!1))}`),_e(e),e.parentNode=null,be(e)){if(ve(e)){const t=oe(e._docId);t&&t.removeElement(e.ref)}else{const t=e.childNodes.slice();for(let n=0;n<t.length;n++)e.removeChild(t[n])}ie(e,this.layoutChildren)}return ie(e,this.childNodes,!0),function e(t,n){if(t._docId!==n)return;const o=ne(n);if(o){for(let n=0,o=t.childNodes.length;n<o;n++)e(t.childNodes[n],t._docId);t._depth=null,o._nodeMap[t.ref]=null,t._docId=null}}(e,e._docId),e}toJSON(){return me(this,!0,!1,!1)}}class Pe extends Se{constructor(e){super(...arguments),this._nodeType=ee.NodeType.COMMENT,this._nodeName="#comment",this._nodeValue=e,this._layout=!0,this._render=!1,this._data=e}get data(){return this._data}set data(e){const t=""+e;return this._nodeValue=t,this._data=t,this._data}appendChild(e){throw new Error("### App Runtime ### appendChild() 注释节点不支持插入子节点")}insertBefore(e,t){throw new Error("### App Runtime ### insertBefore() 注释节点不支持插入子节点")}toString(){return"\x3c!-- "+this._data+" --\x3e"}}function Ie(e,t,n,o){if(!e._ownerDocument||"ref"===t)return;if(!O(n)&&fe(e)[t]===n&&!1!==o)return;if("class"===t)e._classList=null;else if(ce.test(t)){const o=t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()).replace(/^data-/,"").replace(/-([a-z])/g,(e,t)=>t.toUpperCase());e._dataset[o]=n}const r=fe(e)[t];fe(e)[t]=n,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的属性(${t})更新(${r}=>${n})`),Re(e,o,t,n)}function Le(e,t,n){if(!e._ownerDocument)return;if(t=t||"",ge(e)===t&&!1!==n)return;!function(e,t){e._style=t||{}}(e,"string"==typeof t?function(e){const t={};return e.split(";").filter(e=>e.trim()).forEach(e=>{const n=e.indexOf(":");let o=e.substring(0,n).trim();o=N(o);const r=e.substring(n+1).trim();t[o]=r}),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的样式转换：${e} 为${JSON.stringify(t)}`),t}(t):t),Re(e,n,"style")}function Re(e,t,n,o,r){const l=oe(e._docId);l&&("class"===n?!t&&l.setStyles(e.ref,null,{class:o}):"id"===n?!t&&l.setStyles(e.ref,null,{id:o}):"style"===n?r?!t&&l.setStyle(e.ref,...r):!t&&l.setStyles(e.ref,ge(e)):!t&&l.setAttr(e.ref,n,o))}class Fe extends Se{constructor(e){super(...arguments),this._nodeType=ee.NodeType.ELEMENT,this._nodeName=e.toUpperCase(),this._tagName=e.toUpperCase(),this._type=e,this._attr={},this._style={},this._dataset={},this._layout=!0,this._render=!0,this._classList=null,this._styleObject=null,this._styleObjectId=null,this._useParentStyle=null,this._usedCSSPropertyCache={},this._matchedCssRuleCache={},this._mergedStyleCache=null,this._ownCssRuleCache={}}get style(){return this._style}get type(){return console.warn("### App Runtime ### type属性将被废弃，不推荐使用"),this._type}get id(){console.warn("### App Runtime ### id属性将被废弃，不推荐使用");const e=fe(this);return e&&e.id}get dataset(){return this._dataset}get attr(){return console.warn("### App Runtime ### attr属性将被废弃，不推荐使用"),fe(this)}get tagName(){return this._tagName}get mergedStyle(){return null}appendChild(e){return e.nodeType===ee.NodeType.TEXT?(Ie(this,"value",e.textContent),le(e,this),e):super.appendChild(e)}insertBefore(e,t){return e.nodeType===ee.NodeType.TEXT?(Ie(this,"value",e.textContent),le(e,this),e):super.insertBefore(e,t)}hasAttribute(e){const t=fe(this);return t&&t.hasOwnProperty(e)}toString(){const e=fe(this),t=ge(this);return"<"+this._type+" attr="+JSON.stringify(e)+" style="+JSON.stringify(t)+">"+this.layoutChildren.map(e=>e.toString()).join("")+"</"+this._type+">"}}class je extends Se{constructor(){super(...arguments),this._nodeType=ee.NodeType.DOCUMENT_FRAGMENT,this._nodeName="#document-fragment",this._layout=!0,this._render=!1}}class xe extends Se{constructor(){super(...arguments),this._nodeType=ee.NodeType.FIGMENT,this._nodeName="#figment",this._layout=!0,this._render=!1}toString(){let e="";return this.childNodes.length&&(e=this.childNodes.map(e=>e.toString()).join("")),e}}class Me extends Se{constructor(e){super(...arguments),this._nodeType=ee.NodeType.TEXT,this._nodeName="#text",this._textContent=e,this._wholeText=e,this._layout=!1,this._render=!1}get wholeText(){return this._wholeText}appendChild(e){throw new Error("### App Runtime ### appendChild() 文本节点不支持插入子节点")}insertBefore(e,t){throw new Error("### App Runtime ### insertBefore() 文本节点不支持插入子节点")}}class De extends Fe{constructor(){super(...arguments),this.ref=ee.NodeRef.HTML_ID,this._depth=0}appendChild(e){return function(e,t,n){if(e.layoutChildren.length>0||t.parentNode)return void console.warn("### App Runtime ### Document添加多个Body节点----");const o=ne(e._docId),r=e.childNodes,l=r.indexOf(n);l<0?r.push(t):r.splice(l,0,t),be(t)?(re(t,t._docId),le(t,e),se(t,e.layoutChildren,e.layoutChildren.length),_e(e),ke(t),o.body=t,oe(e._docId).createBody(t)):le(t,e)}(this,e)}insertBefore(e,t){console.warn("### App Runtime ### 暂不支持nodeHtml.insertBefore()")}}class Be extends Fe{get value(){return this._attr&&this._attr.value}set value(e){this._attr&&(this._attr.value=e)}get checked(){return this._attr&&this._attr.checked}set checked(e){this._attr&&(this._attr.checked=e)}}const Je=/^(touchstart|touchmove|touchcancel|touchend)$/,We=/^(touchstart|touchmove|touchcancel|touchend|click|longpress)$/;function ze(e,t){let n;return Je.test(e)?(n=new X(e,t))._supportW3C=!1:(n=new Y(e,t))._supportW3C=!1,We.test(e)&&global.isRpkMinPlatformVersionGEQ(1040)&&(n._supportW3C=!0,n._bubbles=!0),n}function He(e){const t=new De("html");return t._ownerDocument=e,re(t,e._docId),t.parentNode=e,e.childNodes.push(t),e.layoutChildren.push(t),t}class Ue extends Se{constructor(e,t){var n,o;super(...arguments),this._nodeType=ee.NodeType.DOCUMENT,this._nodeName="#document",this.body=null,e=e?e.toString():"",this._docId=e,this._nodeMap={},this.listener=t,this._styleSheetHash={},this._styleSheetHash[0]=[],n=this._docId,o=this,n&&(te[n]=o),Object.defineProperty(this,"documentElement",{configurable:!0,enumerable:!1,writable:!1,value:He(this)})}createElement(e){let t;return(t="input"===e||"textarea"===e?new Be(e):new Fe(e))._ownerDocument=this,t}createDocumentFragment(){const e=new je;return e._ownerDocument=this,e}createTextNode(e){const t=new Me(e);return t._ownerDocument=this,t}createComment(e){const t=new Pe(e);return t._ownerDocument=this,t}createEvent(e,t){return ze(e,t)}}function qe(e,t=[]){return{module:"dom",method:e,args:t}}class Ge{constructor(e,t){this.id=e,this.streamer=t,this.actionLen=0}createFinish(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### createFinish---- ");const t=this.streamer.over(this.id,[qe("createFinish")],e);return this.resetActionLen(),t}updateFinish(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### updateFinish---- ");const t=this.streamer.over(this.id,[qe("updateFinish")],e);return this.resetActionLen(),t}createBody(e){const t=me(e,!0,!0,!1),n=t.children;delete t.children;const o=[qe("createBody",[t])];return n&&o.push.apply(o,n.map(e=>qe("addElement",[t.ref,e,-1]))),this.addActions(o)}addNode(e,t,n){let o;if(t&&ve(t)||console.error(`### App Runtime ### addNode的parent(${t.type})必须是可渲染节点`),n<0&&(n=-1),ve(e))o=this.addElement(e,t.ref,n);else{let r=n;e.layoutChildren.every(e=>(o=ve(e)?this.addElement(e,t.ref,r):this.addNode(e,t,r),r+=Ee(e),-1!==o))}return o}addElement(e,t,n){return n>=0||(n=-1),this.addActions(qe("addElement",[t,me(e,!0,!0,!1),n]))}removeNode(e){let t;return ve(e)?t=this.removeElement(e.ref):e.layoutChildren.every(e=>-1!==(t=ve(e)?this.removeElement(e.ref):this.removeNode(e))),t}removeElement(e){if(Array.isArray(e)){const t=e.map(e=>qe("removeElement",[e]));return this.addActions(t)}return this.addActions(qe("removeElement",[e]))}moveNode(e,t,n){let o;if(t&&ve(t)||console.error("### App Runtime ### moveNode的parent必须是可渲染节点"),n>=0||(n=-1),ve(e))o=this.moveElement(e.ref,t.ref,n);else{let r=n;e.layoutChildren.every(e=>(o=ve(e)?this.moveElement(e.ref,t.ref,r):this.moveNode(e,t,r),r+=Ee(e),-1!==o))}return o}moveElement(e,t,n){return this.addActions(qe("moveElement",[e,t,n]))}setProp(e,t,n){const o={prop:{}};return o.prop[t]=n,this.addActions(qe("updateProps",[e,o]))}setAttr(e,t,n){const o={attr:{}};return null==n?(console.warn(`### App Runtime ### 组件 ${e} 的属性 ${t} 被修改为 undefined/null, 自动修改为默认值或空值`),o.attr[t]=""):o.attr[t]=n,this.addActions(qe("updateAttrs",[e,o]))}setStyle(e,t,n){const o={style:{}};return null==n?(console.warn(`### App Runtime ### 组件 ${e} 的样式 ${t} 被修改为 undefined/null, 自动修改为默认值或空值`),o.style[t]=""):o.style[t]=n,this.addActions(qe("updateStyle",[e,o]))}setStyles(e,t,n){const o={attr:n};return t&&(o.style=t),this.addActions(qe("updateStyles",[e,o]))}setStyleObject(e,t,n,o,r){return this.addActions(qe("updateStyleObject",[e,t,n,o,r]))}addEvent(e,t){return this.addActions(qe("addEvent",[e,t]))}removeEvent(e,t){return this.addActions(qe("removeEvent",[e,t]))}updatePageTitleBar(e){return this.addActions(qe("updateTitleBar",[e]))}exitFullscreen(){return this.addActions(qe("exitFullscreen",[]))}invokeComponentMethod(e,t,n,o){return this.addActions({component:e,ref:t,method:n,args:o})}addActions(e){Array.isArray(e)||(e=[e]),global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### addActions---- ",JSON.stringify(e)),this.actionLen+=e.length,this.streamer.push(this.id,e)}hasActions(){return!!this.actionLen}resetActionLen(){this.actionLen=0}}class Ve{constructor(e,t){this.call=e,this.batchThreshold=void 0===t?50:t,this._boolDefineNextTick=!0,this.list=[]}push(e,t){let n;if(0===this.batchThreshold)this.list.push.apply(this.list,t);else if(1===this.batchThreshold)this.list.push.apply(this.list,t),n=this.call(e,this.list),this.list.splice(0);else{if(!(this.batchThreshold>1))throw new Error(`### App Runtime ### push() 不支持的batchThreshold值：${this.batchThreshold}`);for(this.list.push.apply(this.list,t);this.list.length>=this.batchThreshold;){const t=this.list.splice(0,this.batchThreshold);n=this.call(e,t)}}return this._boolDefineNextTick&&this._defineNextTick(e),n}over(e,t){return this.list.length&&(this.call(e,this.list),this.list.splice(0)),this.call(e,t)}_defineNextTick(e){this._nextTick||(this._nextTick=Promise.resolve().then(()=>{this.list.length&&console.warn(`### App Runtime ### _defineNextTick(${e}) 应该由框架保证及时发送`),this._nextTick=null}))}}const Ye=function(e,t,...n){return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Bridge ### sendActions() 发送消息：${e},${t.length},${JSON.stringify(t)}`),t=JSON.stringify(t,function(e,t){return t&&t.constructor===RegExp?{type:E(t),source:t.source,flags:t.flags}:t}),global.callNative(e,t,...n)};const Xe=[{newN:"t",oldN:"type",newV:["d","a","t","u","p","pe"],oldV:["descendant","attribute","tag","universal","pseudo","pseudo-element"]},{newN:"n",oldN:"name"},{newN:"i",oldN:"ignoreCase"},{newN:"a",oldN:"action"},{newN:"v",oldN:"value"}];let Ze=1;var Ke={init:function(){Object.freeze(Y),Object.freeze(Y.prototype),Object.freeze(Pe),Object.freeze(Pe.prototype),Object.freeze(Ue),Object.freeze(Ue.prototype),Object.freeze(Fe),Object.freeze(Fe.prototype),Object.freeze(xe),Object.freeze(xe.prototype),Object.freeze(je),Object.freeze(je.prototype),Object.freeze(De),Object.freeze(De.prototype),Object.freeze(ee),Object.freeze(ee.prototype),Object.freeze(Se),Object.freeze(Se.prototype),Object.freeze(Oe),Object.freeze(Oe.prototype),Object.freeze(Me),Object.freeze(Me.prototype)},Node:ee,Event:Y,TouchEvent:X,helper:{registerComponents:de,getComponentDefaultOptions:he,bindComponentMethods:function(e){const t=he(e.tagName.toLowerCase());if(t&&t.methods){const n=t.methods.filter(e=>"animate"!==e);return n.forEach(function(n){e[n]||(e[n]=function(...o){const r=oe(e._docId);r?(r.invokeComponentMethod(t.name,e.ref,n,o),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 调用组件的方法：${t.name}.${n}()`,JSON.stringify(o))):console.warn(`### App Runtime ### 调用组件的方法无效：${t.name}.${n}(), 组件已销毁`)})}),n}return[]},createDocument:function(e){const t=new Ve(Ye),n=new Ge(e,t);return new Ue(e,n)},registerStyleObject:function(e,t,n,o){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 基于节点(${o&&o.ref})注册样式节点(${n})`),!o._ownerDocument)return;!function(e){for(const t in e){const n=e[t];if(n&&n._meta&&n._meta.ruleDef){const e=n._meta.ruleDef;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let e=0,t=Xe.length;e<t;e++){const t=Xe[e];n.hasOwnProperty(t.newN)&&(n[t.oldN]=n[t.newN],delete n[t.newN],t.newV&&t.newV.indexOf(n[t.oldN])>-1&&(n[t.oldN]=t.oldV[t.newV.indexOf(n[t.oldN])]))}}}}}(t);const r=Ze++;n||(o._styleObject=t,o._styleObjectId=r);const l=oe(o._docId);l&&l.setStyleObject(o.ref,n,e,r,t)},createEvent:ze,createFigment:function(e){const t=new xe;return t._ownerDocument=e,t},updatePageTitleBar:function(e,t){const n=oe(e._docId);n&&n.updatePageTitleBar(t)},exitFullscreen:function(e){const t=oe(e._docId);t&&t.exitFullscreen()},setElementProp:function(e,t,n,o){if(!e._ownerDocument||"ref"===t)return;if(e[t]===n&&!1!==o)return;const r=e[t];e[t]=n,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的内部属性(${t})更新(${r}=>${n})`);const l=oe(e._docId);l&&l.setProp(e.ref,t,n)},setElementAttr:Ie,setElementStyle:function(e,t,n,o){e._ownerDocument&&(ge(e)[t]===n&&!1!==o||(ge(e)[t]=n,Re(e,o,"style",null,[t,n])))},setElementStyles:Le,getElementMatchedCssRuleList:function(e,t){const n=ge(e),o=[{editable:!0,styleSheetName:null,style:ue(e._inlineStyleFullList,n)}],r=JSON.parse(JSON.stringify(o));return console.warn(`### App Runtime ### 获取样式:该平台版本仅支持获取节点${e.ref}的内联样式`),r},setElementMatchedCssRule:function(e,t,n){const o={},r=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];r.push({name:t.name,value:t.value,disabled:t.disabled}),t.disabled||(o[t.name]=t.value)}"INLINE"===t?(Le(e,o),e._inlineStyleFullList=r,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 更新样式:元素(${e.ref})的内联样式：${t}:${JSON.stringify(o)}`)):console.warn(`### App Runtime ### 更新样式:该平台版本仅支持更新内联样式，不支持：${t}`)},resetNodeChildren:function(e){for(let t=0,n=e.layoutChildren.length;t<n;t++){const n=e.layoutChildren[t];n._tmpRenderIndexInParent=Ne(n,e)}e.childNodes.length=0,e.layoutChildren.length=0},restoreNodeChildren:function(e,t){if(!t.parentNode||t.parentNode!==e)return;e.childNodes.push(t),e.layoutChildren.push(t);const n=ye(e,!0);if(be(t)){const o=oe(e._docId),r=we(t),l=r!==t._tmpRenderIndexInParent;if(t._tmpRenderIndexInParent=null,o&&l)return o.moveNode(t,n,r)}},fireTargetEventListener:$e,clearTargetEventListener:function(e,t,n){n instanceof Object||(n={capture:!!n});const o=n.capture?Y.CAPTURING_PHASE:Y.BUBBLING_PHASE;e._eventTargetListeners[t]&&delete e._eventTargetListeners[t][o]},getDocumentNodeByRef:function(e,t){return e._nodeMap[t]},isNodeInDocument:function(e){return!(!e||!e._docId)},recreateDocument:function(e){const t=e.body;t?e.listener.createBody(t):console.error("### App Runtime ### Document没有body节点, 无法重建")},destroyTagNode:function(e){switch(e.nodeType){case K.DOCUMENT:!function(e){var t;global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 销毁文档"),delete e._nodeMap,delete e.listener,delete e._styleSheetHash,e.documentElement&&Te(e.documentElement),delete e.documentElement,delete e.body,delete e.childNodes,delete e.layoutChildren,Ae(e),t=e._docId,te[t]=null}(e);break;case K.ELEMENT:Te(e);break;default:Ae(e)}},getNodeAsJSON:me,getNodeDepth:function(e){return e._depth}},exposure:{registerComponents:de}};const Qe={initApp:"quickapp.app.initApp",initPage:"quickapp.page.initPage",destroyPage:"quickapp.page.destroyPage",fireEvent:"quickapp.page.fireEvent",onShow:"quickapp.page.onShow",onHide:"quickapp.page.onHide",onBackPress:"quickapp.page.onBackPress",onMenuPress:"quickapp.page.onMenuPress",onOrientationChange:"quickapp.page.onOrientationChange",callbackDone:"quickapp.page.callbackDone"};class et{constructor(e,t){if(t instanceof et)return t;this.timestamp=Date.now(),this.detail=t,this.type=e;let n=!1;this.stop=function(){n=!0},this.hasStopped=function(){return n}}}const tt=["onCreate","onInit","onReady","onShow","onHide","onDestroy","onBackPress","onMenuPress","onOrientationChange"];et.reserveEvents=tt,et.isReservedEvent=function(e){return tt.indexOf(e)>=0};const nt=750,ot=320;const rt={};Object.setPrototypeOf(rt,new class{constructor(){this.eventMap={}}subscribe(e,t,n){if(n&&n.once){const n=o=>{t(o),this.remove(e,n)};return this.subscribe(e,n)}if(this.eventMap[e]=this.eventMap[e]||[],"function"==typeof t){const n=this.eventMap[e];-1===n.indexOf(t)&&n.push(t)}}publish(e,t,n){let o=null;const r=this.eventMap[e]||[];for(let e=0,n=r.length;e<n;e++)o=r[e](t,o);return o}remove(e,t){if(!this.eventMap[e])return;const n=this.eventMap[e],o=n.indexOf(t);o>-1&&n.splice(o,1)}});let lt=null;class st extends W{constructor(e,t){super(...arguments),this._isApp=!0,this.options=t||{},this.name="",this.entry="",this.customComponentMap={},this.designWidth=nt,this._def=null,this._data={},this._events={},this._status=null,this._shareDocStyle=!1}$clear(){this.options={},this.name="",this.customComponentMap={},this.designWidth=nt,this._def=null,this._data={},this._events={},this.destroy()}get $data(){return O(this._data)||(this._data={}),this._data}set $data(e){const t="function"==typeof e?e():e;t?(this._data=this._data||{},Object.keys(t).forEach(e=>{!function(e){const t=(e+"").charCodeAt(0);return 36===t||95===t}(e)?(e in this._data&&console.warn(`### App Framework ### App 全局数据 (${e}) 被覆盖`),this._data[e]=t[e]):console.error(`### App Framework ### 页面数据属性名 '${e}' 非法, 属性名不能以$或_开头`)})):(this._data={},console.warn("### App Framework ### App 全局数据被清空"))}get $def(){return this._def}set $def(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### App 元数据初始化----"),this._def=e;const t=e.manifest;if(global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### App 元数据manifest----",JSON.stringify(t)),t){this.name=t.name;const e=t.config;global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### App 元数据config----",JSON.stringify(e)),e&&(this.$data=e.data,this.designWidth=e.designWidth||nt,this.designWidth<ot&&(this.designWidth=ot),this._shareDocStyle=!!e.shareDocStyle);const n=t.router;global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### App 元数据router----",JSON.stringify(n)),n&&(this.entry=n.entry||"")}for(const t in e){"function"!=typeof e[t]||et.isReservedEvent(t)||(this[t]=e[t])}this.$on("applc:onCreate",function(e){this._status=e.type.toLowerCase().replace(/.*:on/,"")}),this.$on("applc:onDestroy",function(e){this._status=e.type.toLowerCase().replace(/.*:on/,"")}),et.reserveEvents.forEach(t=>{this.$on(`applc:${t}`,e[t])}),this._defined=!0}get $status(){return this._status}get $valid(){return"create"===this._status}$emit(e,t){const n=this._events[e];if(n)for(let o=0;o<n.length;o++){const r=new et(e,t);n[o].call(this,r)}}$on(e,t){if(!e||"function"!=typeof t)return;const n=this._events;n[e]=n[e]||[],n[e].push(t)}$off(e){if(!e)return;delete this._events[e]}exit(){null===lt&&(lt=rt.platform.requireModule(this,"system.app")),lt.exit(this.id)}}Object.freeze(st),Object.freeze(st.prototype);class it extends W{constructor(e,t,n,o,r,l){super(...arguments),this._isPage=!0,this.app=t,this.name=null,this.vm=null,this.intent=n,this.doc=rt.runtime.helper.createDocument(e),this.doc.designWidth=this.app.designWidth,this._valid=!0,this._visible=!1,this._meta=Object.assign({query:r},n,o),this._orientation=n.orientation,l&&this._registerCss(l)}_registerCss(e){const t=e&&e.list||[];for(let e=0,n=t.length;e<n;e++)rt.runtime.helper.registerStyleObject("index",t[e],!0,this.doc.documentElement)}get $valid(){return this._valid}get $visible(){return this._valid&&this._visible}get orientation(){return this._orientation}get pageName(){return this._meta.name}get pageComponent(){return this._meta.component}get query(){return this._meta.query}invoke(...e){super.invoke(...e),this.$valid&&rt.publish(Qe.callbackDone,[this])}}function at(e,t,n=[],o){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 调用页面(${e.id})的回调(${t}) 参数：`,JSON.stringify(n)),!e._callbacks)return new Error(`invoke: 回调函数 "${t}" 没有注册`);if(!e.$valid)return void console.error(`invoke: 回调函数所属对象(${e.id})已经无效, 终止回调执行`);const r=e._callbacks[t];if("function"==typeof r){const l=r(...n);return void 0!==o&&!1!==o||(e._callbacks[t]=void 0),e.doc&&rt.publish(Qe.callbackDone,[e]),l}return new Error(`callback: 无效回调函数Id "${t}"`)}function ct(e,t){switch(E(e)){case"undefined":case"null":return"";case"regexp":return e.toString();case"date":return e.toISOString();case"number":case"string":case"boolean":case"array":return e;case"object":if(e.nodeType)return e.ref;const n={};for(const o in e)n[o]=ct(e[o],t);return n;case"function":const o=C();return t._callbacks?t._callbacks[o]=e:global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### normalize() 页面已经销毁，不再注册回调"),o.toString();default:return JSON.stringify(e)}}let ut={};const pt={},dt={},ht={};function ft(e){ht[e]=function(...t){for(const n in ut){const o=ut[n];o&&o[e]&&o[e](...t)}}}function gt(e){ht[e]="createApplication"===e?function(t,n){let o=pt[t];return o?new Error(`Runtime ${e}:无效应用id "${t}"`):(o={framework:"xFramework",created:Date.now()},pt[t]=o,console.log(`### App Framework ### 创建应用 ${t}---- 框架: ${o.framework} 版本: ${global.frameworkVersion}`),ut[o.framework].createApplication(t,n))}:"destroyApplication"===e?function(t){const n=pt[t];if(n&&ut[n.framework]){const e=ut[n.framework].destroyApplication(t);return pt[t]=null,e}return new Error(`Runtime ${e}:无效应用Id:  "${t}"`)}:function(...t){const n=t[0],o=pt[n];return o&&ut[o.framework]?ut[o.framework][e](...t):new Error(`Runtime ${e}:无效应用Id:  "${n}"`)}}function mt(e){let t,n;"string"==typeof e?t=e:e.length&&e.length>1&&(t=e[0],n=e[1]),"createPage"===t?ht[t]=function(e,n,o,r,l,s,i){const a=pt[n];if(!a)return new Error(`Runtime ${t}:无效应用id "${n}"`);let c=dt[e];return c?new Error(`Runtime ${t}:无效页面id "${e}"`):(c={appId:n,created:Date.now()},dt[e]=c,console.log(`### App Framework ### 创建页面 ${e}----应用Id: ${n}`),ut[a.framework].createPage(e,n,o,r,l,s,i))}:(ht[t]=function(...n){const o=n[0],r=dt[o];if(r){const l=pt[r.appId];if(l&&ut[l.framework]){const r=ut[l.framework][t](...n);return"destroyPage"===e&&(dt[o]=null),r}return new Error(`Runtime ${t}:无效应用Id:  "${r.appId}"`)}return"backPressPage"===e?(console.error(`### App Framework ### backPressPage 无效页面Id:  "${o}"`),!1):new Error(`Runtime ${t}:无效页面Id:  "${o}"`)},n&&(ht[n]=function(...e){const n=e[0],o=dt[n];if(o){const r=pt[o.appId];return r&&ut[r.framework]?ut[r.framework][t](...e):new Error(`Runtime ${t}:无效页面Id: "${n}"`)}}))}const bt=["registerDsl","locateDsl"],vt=["createApplication","getAppConfig","notifyAppError","destroyApplication"],yt=["createPage","destroyPage","recreatePage","changeVisiblePage","backPressPage","menuPressPage","orientationChangePage",["processCallbacks","execJSBatch"],"getPage","getPageRoot","getPageElementStyles","setPageElementStyles","setPageElementAttrs","replacePageElementWithHtml"];const Et={},_t={};function wt(e){let t=e;"string"==typeof e&&(t=y({},`${e}; return dsl;`)),function(e){e.init(rt)}(t)}const Nt={1:(e,...t)=>(function e(t,n,o,r,l){if(!t.$valid)return new Error("fireEvent: 只有Page才能发送Dom事件");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 向页面(${t.id}) 的节点(${n})发送事件 "${o}"---- ${JSON.stringify(l)}`),Array.isArray(n))return void n.some(n=>!1!==e(t,n,o,r));return rt.publish(Qe.fireEvent,[t,n,o,r,l])})(e,...t),2:(e,...t)=>at(e,...t)};const At={config:rt,init:function(e){rt.platform=e.platform,rt.runtime=e.runtime,rt.dock=e.dock,function(e){ut={xFramework:e.dock},bt.forEach(ft),vt.forEach(gt),yt.forEach(mt)}(e)},locateDsl:function(){let e=global.getManifestField("config.dsl.name");e||(global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 无法从manifest找到对应的dsl名称"),e="xvm");let t=rt.platform.loadResource("dsl.js");t?global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 从安装包中获取dsl"):(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 从平台中获取dsl-${e}`),t=rt.platform.loadResource(`assets:///js/dsls/dsl-${e}.js`)),wt(t)},registerDsl:wt,createApplication:function(e,t){let n,o=Et[e];return o?n=new Error(`createApplication: 无效应用Id "${e}"`):(global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 平台配置信息：",JSON.stringify(global.Env)),o=new st(e),Et[e]=o,n=rt.publish(Qe.initApp,[o,t])),n},notifyAppError:function(e,t){const n=Et[e];if(n){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### notifyAppError 应用(${e})响应`),n.$def&&"function"==typeof n.$def.onError)try{n.$def.onError.call(n,t)}catch(e){throw e.message=`$INTERRUPTION$:${e.message}`,e}}else console.error(`### App Framework ### notifyAppError 应用(${e})无效`)},destroyApplication:function(e){const t=Et[e];return t?(function(e){e.$emit("applc:onDestroy"),e.$clear(),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 成功销毁应用(${e.id})----`)}(t),Et):new Error(`destroyApplication: 无效应用Id "${e}"`)},createPage:function(e,t,n,o,r,l,s){const i=Et[t];if(!i)return new Error(`createPage: 无效应用Id "${t}"`);s=JSON.parse(s||null);let a,c=_t[e];if(c)a=new Error(`createPage: 无效页面Id "${e}"`);else{global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 创建页面(${e})---- `,JSON.stringify(r)),c=new it(e,i,r,l,o,s),_t[e]=c;const t=function(e,t,n){const o=e,r={};return{setTimeout:function(e,l){const s=n(e,o),i=global.setTimeoutWrap(o.id,function(){t(o,s)},l||0);return r[i.toString()]=s,i.toString()},setInterval:function(e,l){const s=n(e,o),i=global.setIntervalWrap(o.id,function(){t(o,s,[],!0)},l||0);return r[i.toString()]=s,i.toString()},clearTimeout:function(e){global.clearTimeoutWrap(e),r[e]=void 0},clearInterval:function(e){global.clearIntervalWrap(e),r[e]=void 0},requestAnimationFrame:function(e){const l=n(e,o),s=global.requestAnimationFrameWrap(o.id,function(){t(o,l)});return r[s.toString()]=l,s.toString()},cancelAnimationFrame:function(e){global.cancelAnimationFrameWrap(e),r[e]=void 0}}}(c,at,ct);a=rt.publish(Qe.initPage,[c,n,o,t])}return a},recreatePage:function(e){const t=_t[e];let n;return n=t?function(e){if(console.log(`### App Framework ### 重建页面(${e.id})----`),!e.$valid)return console.error(`### App Framework ### 页面(${e.id})缺少dom数据`),new Error("recreatePage: 无效数据");rt.runtime.helper.recreateDocument(e.doc),e.doc.listener.createFinish()}(t):new Error(`recreatePage: 无效页面Id "${e}"`)},destroyPage:function(e){const t=_t[e];return t?(rt.publish(Qe.destroyPage,[t]),function(e){console.log(`### App Framework ### 销毁页面(${e.id})----`),e.intent=null,e.name=null,rt.runtime.helper.destroyTagNode(e.doc),e.doc=null,e._valid=!1,e._visible=!1,e.destroy(),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### 成功销毁页面(${e.id})----`)}(t),delete _t[e],_t):new Error(`destroyPage: 无效页面Id "${e}"`)},changeVisiblePage:function(e,t){const n=_t[e];if(n){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### changeVisiblePage 页面(${e})响应：${t}`),n._visible=t;const o=t?Qe.onShow:Qe.onHide;rt.publish(o,[n])}else console.error(`### App Framework ### changeVisiblePage 页面(${e})无效`)},backPressPage:function(e){const t=_t[e];let n=!1;return t?(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### backPressOnPage 页面(${e})响应`),n=rt.publish(Qe.onBackPress,[t])):console.error(`### App Framework ### backPressOnPage 页面(${e})无效`),!0!==n&&(n=!1),n},menuPressPage:function(e){const t=_t[e];let n=!1;return t?(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### menuPressOnPage 页面(${e})响应`),n=rt.publish(Qe.onMenuPress,[t])):console.error(`### App Framework ### menuPressOnPage 页面(${e})无效`),n},orientationChangePage:function(e,t){const n=_t[e];n?(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### orientationChangePage 页面(${e})响应：${JSON.stringify(t)}`),rt.publish(Qe.onOrientationChange,[n,t])):console.error(`### App Framework ### orientationChangePage 页面(${e})无效`)},processCallbacks:function(e,t){if(!Array.isArray(t))return new Error(`processCallbacks: 无效任务回调数据 "${e}"`);let n=_t[e];if(n||(n=Et[e]),n){const e=[];return t.forEach(t=>{const o=Nt[t.action],r=[...t.args];"function"==typeof o?(r.unshift(n),e.push(o(...r))):(console.error(`### App Framework ### 无法识别的回调函数类型 (${t.action})`),e.push("invalid"))}),e}return new Error(`processCallbacks: 无效回调来源Id "${e}"`)},getAppConfig:function(e){const t=Et[e];let n;return n=t?t.$def:new Error(`getAppConfig: 无效应用Id "${e}"`)},getPageRoot:function(e){const t=_t[e];let n;return n=t?function(e){const t=(e.doc||{}).body||{};return rt.runtime.helper.getNodeAsJSON(t)}(t):new Error(`getPageRoot: 无效页面Id "${e}"`)},getPage:function(e){return _t[e]},getPageElementStyles:function(e,t){const n=_t[e];let o;return o=n&&n.doc?function(e,t){let n;const o=rt.runtime.helper.getDocumentNodeByRef(e.doc,t);if(o){const e=rt.runtime.helper.getElementMatchedCssRuleList(o);return n={inlineStyle:e.shift(),matchedCSSRules:e}}return n=new Error(`getElementStyles: 无效节点ref "${t}"`)}(n,t):new Error(`getPageElementStyles: 无效页面Id "${e}"`)},setPageElementStyles:function(e,t,n,o){const r=_t[e];let l;return r&&r.doc?(global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 更新页面元素样式: ",JSON.stringify(arguments)),l=function(e,t,n,o){let r;const l=rt.runtime.helper.getDocumentNodeByRef(e.doc,t);if(l){for(let e=0,t=o.length;e<t;e++){const t=o[e];t.name=N(t.name)}r=rt.runtime.helper.setElementMatchedCssRule(l,n,o),e.doc.listener.updateFinish()}else r=new Error(`setPageElementStyles: 无效节点ref "${t}"`);return r}(r,t,n,o)):l=new Error(`setPageElementStyles: 无效页面Id "${e}"`),l},setPageElementAttrs:function(e,t,n){const o=_t[e];let r;return o&&o.doc?(global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 更新页面元素的属性: ",JSON.stringify(arguments)),r=function(e,t,n){let o;const r=rt.runtime.helper.getDocumentNodeByRef(e.doc,t);if(r){for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.name=N(t.name.trim()),""===t.name);else if("style"===t.name){const e=t.value.split(";").map(e=>{const t=e.split(":");return{name:N(t[0].trim()),value:t[1]}}).filter(e=>""!==e.name),n={},o=[];for(let t=0,r=e.length;t<r;t++){const r=e[t];o.push({name:r.name,value:r.value,disabled:r.disabled}),r.disabled||(n[r.name]=r.value)}rt.runtime.helper.setElementStyles(r,n)}else rt.runtime.helper.setElementAttr(r,t.name,t.value)}e.doc.listener.updateFinish()}else o=new Error(`setElementAttrs: 无效节点ref "${t}"`);return o}(o,t,n)):r=new Error(`setPageElementAttrs: 无效页面Id "${e}"`),r},replacePageElementWithHtml:function(e,t,n){const o=_t[e];let r;if(o&&o.doc){const e=rt.runtime.helper.getDocumentNodeByRef(o.doc,t),l=e.parentNode,s=l.layoutChildren.indexOf(e);try{const t=rt.platform.requireBundle("parser.js").parseHTML(n),i=function e(t,n){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 编译节点：${JSON.stringify(t)}`),t.hasOwnProperty("length")){const o=[];for(let r=0,l=t.length;r<l;r++){const l=e(t[r],n);l&&o.push(l)}return o}if(!t.nodeType||t.nodeType===n.NodeType.ELEMENT){const o=n.createElement(t.type);for(const e in t.attr)rt.runtime.helper.setElementAttr(o,e,t.attr[e]);t.classList&&t.classList.length&&rt.runtime.helper.setElementAttr(o,"class",t.classList.join(" "));for(const e in t.style)rt.runtime.helper.setElementStyle(o,e,t.style[e]);if(t.children)for(let r=0,l=t.children.length;r<l;r++){const l=e(t.children[r],n);l&&o.appendChild(l)}return o}console.warn(`### App Runtime ### 不支持插入的节点类型：${t.nodeType}`)}(t,o.doc);if(i){l.removeChild(e);const t=i.hasOwnProperty("length")?i:[i];for(let e=0,n=t.length;e<n;e++){const n=t[e];l.insertBefore(n,l.layoutChildren[s+e])}o.doc.listener.updateFinish(),global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### 使用HTML替换元素:",JSON.stringify(arguments),JSON.stringify(t))}else r=new Error(`replacePageElementWithHtml: 使用HTML替换元素，编译出错：${JSON.stringify(t)}`)}catch(e){r=new Error(`replacePageElementWithHtml: 使用HTML替换元素：${e}`)}}else r=new Error(`replacePageElementWithHtml: 无效页面Id "${e}"`);return r},bindComponentMethods:function(e,t){if(t&&!t._hasBind){const n=t.tagName.toLowerCase();t.animate=function(e,t){return(n,o)=>{const r={keyframes:n,options:o},l=rt.platform.requireBundle("animation.js"),s=rt.platform.requireModule(t.app,"system.animation"),i=new l(t,e,r,s);return Object.freeze(i)}}(t,e),rt.runtime.helper.bindComponentMethods(t).forEach(function(n){const o=t[n];t[n]=function(...r){if(e&&e.doc&&e.$valid){rt.publish(Qe.callbackDone,[e]);const l=r.map(t=>ct(t,e));o.apply(t[n],l)}}}),"canvas"===n&&function(e,t){const n=rt.platform.requireBundle("canvas.js"),o=rt.platform.requireModule(t.app,"system.canvas");e=n.enable(e,t.app,{module:o})}(t,e),t._hasBind=!0}return t},exposure:ht};global.initInfras=function(){global.frameworkVersion=e;const t={};t.platform=V,V.init(),t.platform.exposeToNative(V.exposure),global.BroadcastChannel=V.BroadcastChannel,global.ENGINE_TYPE=V.ENGINE_TYPE,t.runtime=Ke,Ke.init(),t.platform.exposeToNative(Ke.exposure),t.dock=At,At.init(t),t.platform.exposeToNative(At.exposure),t.platform.defineBundle("parser"),t.platform.defineBundle("canvas"),t.platform.defineBundle("animation")}});
//# sourceMappingURL=infras.js.map
