!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self)["infras-ext"]={})}(this,function(e){"use strict";function t(e){const t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()}function n(e){const t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}const o=/-(\w)/g,r=n(e=>e.replace(o,s));function s(e,t){return t?t.toUpperCase():""}const a=/([a-z\d])([A-Z])/g,i=n(e=>e.replace(a,"$1-$2").toLowerCase());function l(...e){const t=e.reduce((e,t)=>e.concat(t),[]);return Array.from(new Set(t))}class c{constructor(e,t={bubbles:!1,cancelable:!1}){if(arguments.length>1&&"object"!=typeof t)throw new Error(`### App Runtime ### addEventListener() 参数2传递的话，必须是对象：${t}`);this._type=e,this._bubbles=t.bubbles,this._cancelable=t.cancelable,this._target=null,this._currentTarget=null,this._eventPhase=c.NONE,this._defaultPrevented=!1,this._timeStamp=Date.now(),this._supportW3C=!0,this._flagStopPropagation=!1,this._flagStopImmediatePropagation=!1}get type(){return this._type}get bubbles(){return this._bubbles}get cancelable(){return this._cancelable}get target(){return this._target}get currentTarget(){return this._currentTarget}get eventPhase(){return this._eventPhase}get defaultPrevented(){return this._defaultPrevented}get timeStamp(){return this._timeStamp}stopPropagation(){this._flagStopPropagation=!0}stopImmediatePropagation(){this._flagStopImmediatePropagation=!0,this.stopPropagation()}preventDefault(){throw new Error("### App Runtime ### preventDefault() 暂不支持该方法")}toJSON(){return{type:this._type,target:this._target,currentTarget:this._currentTarget,timeStamp:this._timeStamp}}}c.NONE=0,c.CAPTURING_PHASE=1,c.AT_TARGET=2,c.BUBBLING_PHASE=3;class d extends c{constructor(){super(...arguments),this._touches=null,this._changedTouches=null}get touches(){return this._touches}set touches(e){if(this._touches)throw new Error("### App Framework ### TouchEvent 不支持修改 touches 属性");this._touches=e}get changedTouches(){return this._changedTouches}set changedTouches(e){if(this._changedTouches)throw new Error("### App Framework ### TouchEvent 不支持修改 changedTouches 属性");this._changedTouches=e}toJSON(){const e=super.toJSON();return Object.assign(e,{touches:this._touches,changedTouches:this._changedTouches})}}const h={HTML_ID:"-1"},u={UNKNOWN:0,ELEMENT:1,ATTR:2,TEXT:3,COMMENT:8,DOCUMENT:9,DOCUMENT_FRAGMENT:11,FIGMENT:101};let p=1;class m{constructor(){this._nodeType=m.NodeType.UNKNOWN,this._nodeName=null,this._nodeValue=null,this._ownerDocument=null,this._textContent=null,this.ref=(p++).toString(),this.childNodes=[],this.layoutChildren=[],this.parentNode=null,this.nextSibling=null,this.previousSibling=null,this._docId=null,this._layout=!1,this._render=!1,this._renderCount=null}get nodeType(){return this._nodeType}get nodeName(){return this._nodeName}get nodeValue(){return this._nodeValue}get ownerDocument(){return this._ownerDocument}get textContent(){return this._textContent}set textContent(e){if(this.nodeType!==m.NodeType.TEXT){const t=this.ownerDocument.createTextNode(e);this.appendChild(t)}else this._textContent=e}}m.NodeRef=h,m.NodeType=u;const f={};function g(e){return f[e]}function _(e){const t=g(e);return t&&t.listener?t.listener:null}function y(e,t){if(e._docId===t)return;const n=g(t);if(n){e._docId=t,n._nodeMap[e.ref]=e;for(let t=0,n=e.childNodes.length;t<n;t++)y(e.childNodes[t],e._docId)}}function b(e,t){return e._nodeMap[t]}function v(e,t){e.parentNode=t,t._docId&&(y(e,t._docId),e._depth=t._depth+1);for(let t=0,n=e.childNodes.length;t<n;t++)v(e.childNodes[t],e)}function C(e,t,n,o){n<0&&(n=0);const r=t[n-1],s=t[n];return t.splice(n,0,e),o&&(r&&(r.nextSibling=e||null),e.previousSibling=r||null,e.nextSibling=s||null,s&&(s.previousSibling=e||null)),n}function w(e,t,n){const o=t.indexOf(e);if(!(o<0)){if(n){const n=t[o-1],r=t[o+1];n&&(n.nextSibling=r||null),r&&(r.previousSibling=n||null),e.previousSibling=null,e.nextSibling=null}t.splice(o,1)}}function E(e,t,n,o){const r=t.indexOf(e);if(r<0||r===n)return-1;w(e,t,o);let s=n;return r<=n&&(s=n-1),C(e,t,s,o),n}function A(e,t){const n=g(e);return n?n._styleSheetHash[t]:null}function F(e){const t=[];let n=e;const o=e._docId,r=g(o)._styleSheetHash[0].map(e=>A(o,e));for(t.push(...r),e._useParentStyle&&(n=e.parentNode);n&&!n._styleSheetId;)n=n.parentNode;if(n&&n._styleSheetId){const e=A(o,n._styleSheetId);-1===t.indexOf(e)&&t.push(e)}return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 获取节点(${e.ref}:${e._type})的样式表:${t.map(e=>e.id).join(",")}`),t}const N=/^data.+/;function x(e,t){const n=[],o=Object.assign({},t);if(e)for(let t=0,r=e.length;t<r;t++){const r=e[t];o.hasOwnProperty(r.name)?(n.push({name:i(r.name),value:o[r.name],disabled:!1}),delete o[r.name]):r.disabled&&n.push({name:i(r.name),value:r.value,disabled:r.disabled})}for(const e in o)n.push({name:i(e),value:o[e],disabled:!1});return n}function S(e){return(e||"").split(/\s+/).filter(e=>""!==e).filter((e,t,n)=>n.indexOf(e)===t)}const T={};function R(e){"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)||(e=[e]),e.forEach(e=>{if(!e)return;e.name||(e.name=e.type,delete e.type),e.methods=e.methods||[],global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 注册组件---- ",JSON.stringify(e));let t=T[e.name];t?t.methods=Array.from(new Set(t.methods.concat(e.methods))):(t=T[e.name]=JSON.parse(JSON.stringify(e))).def={}})}function L(e){return T[e]}function I(e){const t=L(e.tagName.toLowerCase());if(t&&t.methods){const n=t.methods.filter(e=>"animate"!==e);return n.forEach(function(n){e[n]||(e[n]=function(...o){const r=_(e._docId);r?(r.invokeComponentMethod(t.name,e.ref,n,o),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 调用组件的方法：${t.name}.${n}()`,JSON.stringify(o))):console.warn(`### App Runtime ### 调用组件的方法无效：${t.name}.${n}(), 组件已销毁`)})}),n}return[]}function O(e){return e._attr}function P(e){return e._style}function D(e){if(e._classList)return e._classList;const t=O(e);return e._classList=S(t.class),e._classList}function k(e){return e._finalStyleCache=e._finalStyleCache||function(e,t){if(!t)return global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 计算节点CSS样式优先级 没有样式缓存对象，不再计算"),{};const n=$(t),o=n.map(e=>e.style);global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 按照优先级合并节点样式：",n.map(e=>`"${e.name}"`).join(" < "));const r=Object.assign({},...o),s=Object.keys(Object.assign({},e,r));for(let t=0,n=s.length;t<n;t++){const n=s[t];void 0!==r[n]&&void 0===e[n]?e[n]=!0:void 0===r[n]&&void 0!==e[n]&&(r[n]="")}return r}(e._usedCSSPropertyCache,e._matchedCssRuleCache),e._finalStyleCache}function B(e,t){e._style=t||{}}function $(e){const t=[];for(const n in e){const o=e[n];o&&o.length&&t.push.apply(t,o)}return t.sort((e,t)=>e.score.sum-t.score.sum),t}function j(e){const t={};return e.split(";").filter(e=>e.trim()).forEach(e=>{const n=e.indexOf(":");let o=e.substring(0,n).trim();o=r(o);const s=e.substring(n+1).trim();t[o]=s}),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的样式转换：${e} 为${JSON.stringify(t)}`),t}function M(e,t=!0){if(e.nodeType===u.ELEMENT){const n={ref:e.ref.toString(),type:e._type},o=O(e);if(o&&Object.keys(o).length){n.attr={};for(const e in o){const t=o[e];n.attr[e]=-1!==[null,void 0].indexOf(t)?"":t}}const r=k(e);r&&Object.keys(r).length&&(n.style=r);const s=Object.keys(e._eventTargetListeners||{});if(s&&s.length&&(n.event=s),t&&e.layoutChildren&&e.layoutChildren.length){const t=[];for(let n=0,o=e.layoutChildren.length;n<o;n++){const o=e.layoutChildren[n],r=M(o);U(o)?t.push(r):t.push.apply(t,r)}n.children=t}return n}if(e.nodeType===u.FIGMENT){const n=[];if(t&&e.layoutChildren&&e.layoutChildren.length)for(let t=0,o=e.layoutChildren.length;t<o;t++){const o=e.layoutChildren[t],r=M(o);o.nodeType===u.FIGMENT?n.push.apply(n,r):n.push(r)}return n}if(e.nodeType===u.COMMENT)return[];global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### getNodeAsJSON() 忽略该类型(${e.nodeType})的节点序列化`)}function z(e){return e._depth}function G(e){return e._layout}function U(e){return e._render}function W(e,t=!1){let n=t?e:e.parentNode;for(;n&&!U(n);)n=n.parentNode;return n}function H(e,t=!1){const n=[];let o=W(e,t);for(;o;)n.push(o),o=W(o);return n}function J(e){if(null!==e._renderCount)return e._renderCount;let t=U(e)?1:0;if(G(e)&&!U(e))for(let n=0,o=e.layoutChildren.length;n<o;n++)t+=J(e.layoutChildren[n]);return e._renderCount=t,t}function q(e){let t=e;for(;t;)t._renderCount=null,t=t.parentNode}function Z(e){const t=e.parentNode;if(e.nodeType===u.DOCUMENT||e.ref===h.HTML_ID)return 0;if(!t||!G(e))return-1;const n=V(e,t);let o=0;return U(t)||(o=Z(t)),n<0||o<0?-1:n+o}function V(e,t){if(!t.layoutChildren||t.layoutChildren.length<=0)return-1;const n=t.layoutChildren.indexOf(e);if(n>0){let e=0;for(let o=0,r=n;o<r;o++)e+=J(t.layoutChildren[o]);return e}return n}function K(e){switch(e.nodeType){case u.DOCUMENT:!function(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 销毁文档"),delete e._nodeMap,delete e.listener,delete e._styleSheetHash,e.documentElement&&Y(e.documentElement);delete e.documentElement,delete e.body,delete e.childNodes,delete e.layoutChildren,X(e),t=e._docId,f[t]=null;var t}(e);break;case u.ELEMENT:Y(e);break;default:X(e)}}function X(e){delete e._depth,delete e._tmpRenderIndexInParent,delete e._eventTargetListeners,delete e._bindWatcherList,delete e._vm,function(e){if(delete e._docId,delete e._layout,delete e._render,delete e._renderCount,delete e.nextSibling,delete e.previousSibling,delete e.parentNode,e.childNodes)for(let t=e.childNodes.length-1;t>=0;t--)Y(e.childNodes[t]);delete e.layoutChildren,delete e.childNodes,delete e._content,delete e._ownerDocument,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 销毁节点：节点(${e.ref})剩余属性有：[${Object.keys(e).join(", ")}]`)}(e)}function Y(e){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 销毁元素：${JSON.stringify(M(e,!1))}`),delete e._classList,delete e._styleSheetId,delete e._useParentStyle,delete e._usedCSSPropertyCache,delete e._matchedCssRuleCache,delete e._finalStyleCache,delete e._ownCssRuleCache,delete e._attr,delete e._style,delete e._dataset,X(e)}var Q=Object.freeze({registerComponents:R,getComponentDefaultOptions:L,bindComponentMethods:I,getDocumentNodeByRef:b,getNodeAttributesAsObject:O,getNodeInlineStyleAsObject:P,getNodeAttrClassList:D,getNodeFinalStyleAsObject:k,setNodeInlineStyle:B,sortNodeStyleCache:$,getNodeAsJSON:M,getNodeDepth:z,supportLayout:G,supportRender:U,renderParent:W,renderParents:H,calcRenderCount:J,resetRenderCount:q,renderIndexInRenderParent:Z,renderIndexInParent:V,destroyTagNode:K,cssText2StyleObject:j});function ee(e,t,n){n instanceof Object||(n={capture:!!n});const o=t.type,r=e._eventTargetListeners[o],s=n.capture?c.CAPTURING_PHASE:c.BUBBLING_PHASE;if(r&&r[s]&&r[s].list){const n=r[s].list;for(let o=0,r=n.length;o<r;o++){const r=n[o];t._target=e,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### fireTargetEventListener() 事件响应:${t.type}，节点:${e.ref}`),r&&r.call(t.target,t)}}}class te extends m{constructor(){super(...arguments),this._eventTargetListeners={}}addEventListener(e,t,n){if(arguments.length<2)throw new Error(`### App Runtime ### addEventListener() 至少需要传递两个参数:${arguments.length}`);if("string"!=typeof e)throw new Error("### App Runtime ### addEventListener() 参数1必须是字符串，事件类型");if("function"!=typeof t)throw new Error("### App Runtime ### addEventListener() 参数2必须是函数，监听事件");global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### addEventListener() 节点(${this.ref})注册事件(${e})`),n instanceof Object||(n={capture:!!n,once:!1,passive:!1});const o=n.capture?c.CAPTURING_PHASE:c.BUBBLING_PHASE,r=this._eventTargetListeners[e]=this._eventTargetListeners[e]||{};if(r[o]=r[o]||{},r[o].list=r[o].list||[],r[o].hash=r[o].hash||{},-1===r[o].list.indexOf(t)){const e=r[o].list.push(t);r[o].hash[e-1]={capture:!!n.capture,once:!!n.once,passive:!!n.passive}}const s=_(this._docId);s&&s.addEvent(this.ref,e)}removeEventListener(e,t,n){if(arguments.length<2)throw new Error(`### App Runtime ### addEventListener() 至少需要传递两个参数:${arguments.length}`);if("string"!=typeof e)throw new Error("### App Runtime ### addEventListener() 参数1必须是字符串，事件类型");if("function"!=typeof t)throw new Error("### App Runtime ### addEventListener() 参数2必须是函数，监听事件");global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### Element ${this.ref} 执行 removeEventListener(${e})---- `),n instanceof Object||(n={capture:!!n});const o=n.capture?c.CAPTURING_PHASE:c.BUBBLING_PHASE,r=this._eventTargetListeners[e]=this._eventTargetListeners[e]||{};r[o]=r[o]||{},r[o].list=r[o].list||[],r[o].hash=r[o].hash||{};const s=r[o].list.indexOf(t);-1!==s&&(r[o].list.splice(s,1),r[o].hash[s]=null),0===r[o].list.length&&(r[o]=null)}dispatchEvent(e){if(!(e instanceof c))throw new Error("### App Runtime ### dispatchEvent() 参数1所属类必须是事件类");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 执行事件:${e.type}, 来自节点:${this.ref}`),!e._supportW3C)return ee(this,e);e._target=this;const t=e.type,n=H(this,!0),o=n.slice().reverse().concat(n);if(o[0]&&o[0].parentNode===o[0].ownerDocument){const e=o[0].ownerDocument;o.unshift(e),o.push(e)}for(;o.length>0;){const n=o[0],r=o.indexOf(n),s=o.indexOf(this);if(e._eventPhase=r<s?c.CAPTURING_PHASE:r===s?c.AT_TARGET:c.BUBBLING_PHASE,e._currentTarget=n,!e.bubbles&&e.eventPhase===c.BUBBLING_PHASE)break;global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 执行事件:${t}, 阶段:${e.eventPhase}, Target:${e.target.ref}, CurrentTarget:${e.currentTarget.ref}`);const a=n._eventTargetListeners[t];let i=e.eventPhase;if(e.target===e.currentTarget&&(i=n===o[1]?c.CAPTURING_PHASE:c.BUBBLING_PHASE),a&&a[i]&&a[i].list){const t=a[i].hash,o=a[i].list.slice();for(let r=0,s=o.length;r<s&&!e._flagStopImmediatePropagation;r++){const s=o[r];try{global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 事件响应:${e.type}，阶段:${e.eventPhase}`),s&&s.call(e.currentTarget,e)}catch(t){console.error(`### App Runtime ### dispatchEvent() 事件响应:${e.type}，阶段:${e.eventPhase}, JS报错:`,t.message,s),console.error(t.stack)}t[r]&&t[r].once&&n.removeEventListener(e.type,s,t[r])}}if(e._flagStopImmediatePropagation||e._flagStopPropagation)break;o.shift()}e._currentTarget=null}}const ne={TAG:1,CLASS:1e3,ID:1e6,STEP:1e6,INLINE:1e9},oe={TAG:1,CLASS:2,ID:3,DESC:4,INLINE:5},re={name:null,type:null,score:null,order:0,style:null,_sheetId:null,_hitNodeMap:null,_styleFullList:null};function se(e){const t=Object.assign({},re,{type:oe.TAG,score:{self:ne.TAG,depth:1},_hitNodeMap:{}},e);return t.score.sum=t.score.self*ne.STEP+t.order,t}function ae(e){const t=Object.assign({},re,{type:oe.CLASS,score:{self:ne.CLASS,depth:1},_hitNodeMap:{}},e);return t.score.sum=t.score.self*ne.STEP+t.order,t}function ie(e){const t=Object.assign({},re,{type:oe.ID,score:{self:ne.ID,depth:1},_hitNodeMap:{}},e);return t.score.sum=t.score.self*ne.STEP+t.order,t}function le(e){const t=Object.assign({},re,{type:oe.DESC,_hitNodeMap:{}},e);return t.score=function(e,t){const n={id:0,class:0,tag:0,self:0,depth:1};for(let t=0,o=e.length;t<o;t++){const o=e[t];ce(o)?n.tag+=1:he(o)?n.id+=1:de(o)?n.class+=1:ue(o)&&(n.depth+=1)}return n.self=n.id*ne.ID+n.class*ne.CLASS+n.tag*ne.TAG,{self:n.self,depth:n.depth}}(t.meta.ruleDef,t.order),t.score.sum=t.score.self*ne.STEP+t.order,t}function ce(e){return"tag"===e.type}function de(e){return"attribute"===e.type&&"class"===e.name}function he(e){return"attribute"===e.type&&"id"===e.name}function ue(e){return"descendant"===e.type||"child"===e.type}function pe(e,t){let n;switch(e.type){case oe.TAG:n={match:e.name===t._type,matchChanged:!1,pathChanged:!1};break;case oe.CLASS:n={match:-1!==D(t).indexOf(e.name.substring(1)),matchChanged:!1,pathChanged:!1};break;case oe.ID:n={match:O(t).id===e.name.substring(1),matchChanged:!1,pathChanged:!1};break;case oe.DESC:n=function(e,t){const n=e.meta.ruleDef,o=[];let r=[t];for(let s=n.length-1;s>=0;s--){const a=n[s],i=s===n.length-1;if(0===(r=fe(a,r)).length||t._depth<e.score.depth)return me(e,t,!1,[]);i||-1!==["descendant","child"].indexOf(a.type)||o.push(r[0].ref)}return me(e,t,!0,o)}(e,t);break;default:throw new Error(`不支持的CSS规则类型：${e.type}`)}return n.match?function(e,t){e._hitNodeMap[t]=!0}(e,t.ref):function(e,t){delete e._hitNodeMap[t]}(e,t.ref),n}function me(e,t,n,o){const r={match:n,matchChanged:null,pathChanged:null};if(n){const n=t._ownCssRuleCache[e.order];n?n.join(",")===o.join(",")?(r.matchChanged=!1,r.pathChanged=!1):(r.matchChanged=!1,r.pathChanged=!0):(r.matchChanged=!0,r.pathChanged=!0),t._ownCssRuleCache[e.order]=o}else{t._ownCssRuleCache[e.order]?(r.matchChanged=!0,r.pathChanged=!0):(r.matchChanged=!1,r.pathChanged=!1),t._ownCssRuleCache[e.order]=null}return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 节点(${t._type}:${t.ref})与后代CSS规则(${e.name})的匹配计算：${JSON.stringify(r)}`),r}function fe(e,t){const n=e.type;switch(n){case"attribute":return function(e,t){if(de(e)){const n=t.find(t=>-1!==D(t).indexOf(e.value));return n?[n]:[]}if(he(e)){const n=t.find(t=>O(t).id===e.value);return n?[n]:[]}return console.warn(`### App Runtime ### 未知的CSS Selector规则：${e.name}，当前支持：class, id`),[]}(e,t);case"tag":return function(e,t){const n=t.find(t=>t._type===e.name);return n?[n]:[]}(e,t);case"descendant":return function(e,t){const n=[];for(let e=0,o=t.length;e<o;e++){const o=t[e];n.push.apply(n,H(o))}return n}(0,t);case"child":return function(e,t){const n=[];for(let e=0,o=t.length;e<o;e++){const o=t[e],r=W(o);r&&n.push(r)}return n}(0,t);default:return console.warn(`### App Runtime ### 未知的CSS Selector规则：${n}，当前支持：tag, class, id, 后代, '>'`),[]}}function ge(e,t){if(!g(e._docId))return void(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### calcNodeStyle() 节点(${e.ref}:${e._type})暂无关联document`));if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### calcNodeStyle() 节点(${e.ref}:${e._type})计算类型：${t}`),e._finalStyleCache=null,!t||t===oe.INLINE){const t=e._matchedCssRuleCache[oe.INLINE];e._matchedCssRuleCache[oe.INLINE]=t||[]}let n,o,r,s,a;t&&t!==oe.TAG||(e._matchedCssRuleCache[oe.TAG]=[]),t&&t!==oe.CLASS||(e._matchedCssRuleCache[oe.CLASS]=[]),t&&t!==oe.ID||(e._matchedCssRuleCache[oe.ID]=[]);const i=P(e);if((!t||t===oe.INLINE)&&((n=e._matchedCssRuleCache[oe.INLINE]).length?n[0].style=i:n.push(function(e){const t=Object.assign({},re,{name:"INLINE",type:oe.INLINE,score:{self:ne.INLINE},_hitNodeMap:{}},e);return t.score.sum=t.score.self*ne.STEP+t.order,t}({style:i})),t===oe.INLINE))return;const l=F(e);for(let i=0,c=l.length;i<c;i++){const c=l[i],d=(c.id,c.nameHash),h=c.descLast;if(!t||t===oe.TAG){n=e._matchedCssRuleCache[oe.TAG];const t=e._type;if(a=!1)n.push.apply(n,a);else{o=r=[],d.hasOwnProperty(t)&&(o=_e([d[t]],e));const a=h[t]&&h[t].list||[];a.length>0&&(r=ye(a,e)),s=o.concat(r),n.push.apply(n,s)}}const u=D(e);if(u.length>0&&(!t||t===oe.CLASS)){n=e._matchedCssRuleCache[oe.CLASS];const t=u.map(e=>`.${e}`);for(let i=0,l=t.length;i<l;i++){const l=t[i];if(a=!1)n.push.apply(n,a);else{if(o=r=[],d.hasOwnProperty(l)&&(o=_e([d[l]],e)),h[l]){r=ye(h[l].list||[],e)}s=o.concat(r),n.push.apply(n,s)}}}if(O(e).id&&(!t||t===oe.ID)){n=e._matchedCssRuleCache[oe.ID];const t=O(e).id,i=`#${t}`;if(a=!1)n.push.apply(n,a);else{o=r=[],t&&d.hasOwnProperty(i)&&(o=_e([d[i]],e));const a=h[i]&&h[i].list||[];t&&a.length>0&&(r=ye(a,e)),s=o.concat(r),n.push.apply(n,s)}}}}function _e(e,t){const n=[];for(let o=0,r=e.length;o<r;o++){const r=e[o];pe(r,t).match&&n.push(r)}return n}function ye(e,t){const n=[];for(let o=0;o<e.length;o++){const r=e[o];pe(r,t).match&&n.push(r)}return n}function be(e,t){const n=function(e,t){const n=F(e),o=[];for(let e=0,r=n.length;e<r;e++){const r=n[e],s=r.descNotLast;if(s[t]){const e=s[t].list;o.push(...e)}}return o}(e,t),o=[];for(let t=0,r=n.length;t<r;t++){const r=ve(n[t],e);o.push(...r)}return l(o)}function ve(e,t){const n=[];for(let o=0,r=t.layoutChildren.length;o<r;o++){const r=t.layoutChildren[o];if(U(r)){pe(e,r).matchChanged&&n.push(r.ref)}const s=ve(e,r);n.push(...s)}return n}function Ce(e){if(e.nodeType===m.NodeType.ELEMENT&&e._docId){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 添加到文档时计算节点(${e.ref}:${e._type})的样式`),ge(e);for(let t=0,n=e.layoutChildren.length;t<n;t++)Ce(e.layoutChildren[t])}}function we(e,t,n){if(t.nodeType===m.NodeType.DOCUMENT_FRAGMENT){const o=t.childNodes.slice();for(let r=0,s=o.length;r<s;r++)t.removeChild(o[r]),we(e,o[r],n);return t}const o=W(e,!0),r=n?e.childNodes.indexOf(n):e.childNodes.length,s=_(e._docId);if(t.nodeType===m.NodeType.TEXT)throw new Error(`### App Runtime ### 不支持在非渲染节点中添加文本节点：${t.textContent}`);if(t.parentNode){if(E(t,e.childNodes,r,!0),G(t))if(n){const r=E(t,e.layoutChildren,e.layoutChildren.indexOf(n));q(e);const a=Z(t);if(s&&r>=0)return s.moveNode(t,o,a)}else{const n=E(t,e.layoutChildren,e.layoutChildren.length);q(e);const r=Z(t);if(s&&n>=0)return s.moveNode(t,o,r)}}else if(v(t,e),C(t,e.childNodes,r,!0),Ce(t),G(t))if(n){C(t,e.layoutChildren,e.layoutChildren.indexOf(n)),q(e);const r=Z(t);if(s)return s.addNode(t,o,r)}else{C(t,e.layoutChildren,e.layoutChildren.length),q(e);const n=e===o?-1:Z(t);if(s)return s.addNode(t,o,n)}}class Ee extends te{constructor(){super(...arguments),this._depth=null,this._tmpRenderIndexInParent=null}appendChild(e){if(!(e&&e instanceof m))throw new Error("### App Runtime ### appendChild() 函数的node参数无效");if(e.parentNode&&e.parentNode!==this)throw new Error("### App Runtime ### appendChild() 参数node的父节点不匹配");return we(this,e,null)}insertBefore(e,t){if(!(e&&2===arguments.length&&e instanceof m))throw new Error("### App Runtime ### insertBefore() 函数的node/before参数无效");if(e.parentNode&&e.parentNode!==this)throw new Error("### App Runtime ### insertBefore() 参数node的父节点不匹配");return e===t||e.nextSibling&&e.nextSibling===t?e:we(this,e,t)}removeChild(e){if(!(e&&e instanceof m))throw new Error("### App Runtime ### removeChild() node参数无效");if(e.parentNode!==this)throw new Error("### App Runtime ### removeChild() 参数node的父节点不匹配");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### removeChild() 移除节点：${JSON.stringify(M(e))}`),q(e),e.parentNode=null,G(e)){if(U(e)){const t=_(e._docId);t&&t.removeElement(e.ref)}else{const t=e.childNodes.slice();for(let n=0;n<t.length;n++)e.removeChild(t[n])}w(e,this.layoutChildren)}return w(e,this.childNodes,!0),function e(t,n){if(t._docId!==n)return;const o=g(n);if(o){for(let n=0,o=t.childNodes.length;n<o;n++)e(t.childNodes[n],t._docId);t._depth=null,o._nodeMap[t.ref]=null,t._docId=null}}(e,e._docId),e}toJSON(){return M(this)}}class Ae extends Ee{constructor(e){super(...arguments),this._nodeType=m.NodeType.COMMENT,this._nodeName="#comment",this._nodeValue=e,this._layout=!0,this._render=!1,this._data=e}get data(){return this._data}set data(e){const t=""+e;return this._nodeValue=t,this._data=t,this._data}appendChild(e){throw new Error("### App Runtime ### appendChild() 注释节点不支持插入子节点")}insertBefore(e,t){throw new Error("### App Runtime ### insertBefore() 注释节点不支持插入子节点")}toString(){return"\x3c!-- "+this._data+" --\x3e"}}function Fe(e,t,n,o){if(!e._ownerDocument||"ref"===t)return;if((null===(r=n)||"object"!=typeof r)&&O(e)[t]===n&&!1!==o)return;var r;if("class"===t)e._classList=null;else if(N.test(t)){const o=t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()).replace(/^data-/,"").replace(/-([a-z])/g,(e,t)=>t.toUpperCase());e._dataset[o]=n}const s=O(e)[t];O(e)[t]=n,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的属性(${t})更新(${s}=>${n})`),xe(e,o,t,n),function(e,t,n,o,r){const s=_(e._docId),a=g(e._docId);if(!s)return;if(!a._supportNotLastRuleTypeUpdate)return;if(!O(e).hasOwnProperty("descRestyling"))return;if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的属性(${n})更新(${r}=>${o})`),"class"===n){const t=S(r),n=S(o),s=function(e,t){const n={};return e.forEach(e=>n[e]=!0),t.forEach(e=>n[e]?delete n[e]:n[e]=!0),Object.keys(n)}(t,n).map(e=>`.${e}`),i=s.map(t=>be(e,t)),c=l(...i);for(let e=0,t=c.length;e<t;e++){const t=c[e],n=b(a,t);n&&(ge(n),Se(n))}}else if("id"===n){const t=r?be(e,`#${r}`):[],n=o?be(e,`#${o}`):[],s=l(t,n),i=s;for(let e=0,t=i.length;e<t;e++){const t=i[e],n=b(a,t);n&&(ge(n),Se(n))}}}(e,0,t,n,s)}function Ne(e,t,n){if(!e._ownerDocument)return;if(t=t||"",P(e)===t&&!1!==n)return;B(e,"string"==typeof t?j(t):t),xe(e,n,"style")}function xe(e,t,n,o,r){const s=_(e._docId);s&&("class"===n?(ge(e,oe.CLASS),!t&&s.setStyles(e.ref,k(e),{class:o})):"id"===n?(ge(e,oe.ID),!t&&s.setStyles(e.ref,k(e),{id:o})):"style"===n?(ge(e,oe.INLINE),r?!t&&s.setStyle(e.ref,...r):!t&&s.setStyles(e.ref,k(e))):!t&&s.setAttr(e.ref,n,o))}function Se(e){const t=_(e._docId);t&&t.setStyles(e.ref,k(e))}function Te(e,t){const n=$(e._matchedCssRuleCache);return n.reverse(),t?n.filter(e=>e.name===t):n}class Re extends Ee{constructor(e){super(...arguments),this._nodeType=m.NodeType.ELEMENT,this._nodeName=e.toUpperCase(),this._tagName=e.toUpperCase(),this._type=e,this._attr={},this._style={},this._dataset={},this._layout=!0,this._render=!0,this._classList=null,this._styleSheetId=null,this._useParentStyle=null,this._usedCSSPropertyCache={},this._matchedCssRuleCache={},this._finalStyleCache=null,this._ownCssRuleCache={}}get style(){return this._style}get type(){return console.warn("### App Runtime ### type属性将被废弃，不推荐使用"),this._type}get id(){console.warn("### App Runtime ### id属性将被废弃，不推荐使用");const e=O(this);return e&&e.id}get dataset(){return this._dataset}get attr(){return console.warn("### App Runtime ### attr属性将被废弃，不推荐使用"),O(this)}get tagName(){return this._tagName}appendChild(e){return e.nodeType===m.NodeType.TEXT?(Fe(this,"value",e.textContent),v(e,this),e):super.appendChild(e)}insertBefore(e,t){return e.nodeType===m.NodeType.TEXT?(Fe(this,"value",e.textContent),v(e,this),e):super.insertBefore(e,t)}hasAttribute(e){const t=O(this);return t&&t.hasOwnProperty(e)}toString(){const e=O(this),t=k(this);return"<"+this._type+" attr="+JSON.stringify(e)+" style="+JSON.stringify(t)+">"+this.layoutChildren.map(e=>e.toString()).join("")+"</"+this._type+">"}}class Le extends Ee{constructor(){super(...arguments),this._nodeType=m.NodeType.DOCUMENT_FRAGMENT,this._nodeName="#document-fragment",this._layout=!0,this._render=!1}}class Ie extends Ee{constructor(){super(...arguments),this._nodeType=m.NodeType.FIGMENT,this._nodeName="#figment",this._layout=!0,this._render=!1}toString(){let e="";return this.childNodes.length&&(e=this.childNodes.map(e=>e.toString()).join("")),e}}class Oe extends Ee{constructor(e){super(...arguments),this._nodeType=m.NodeType.TEXT,this._nodeName="#text",this._textContent=e,this._wholeText=e,this._layout=!1,this._render=!1}get wholeText(){return this._wholeText}appendChild(e){throw new Error("### App Runtime ### appendChild() 文本节点不支持插入子节点")}insertBefore(e,t){throw new Error("### App Runtime ### insertBefore() 文本节点不支持插入子节点")}}class Pe extends Re{constructor(){super(...arguments),this.ref=m.NodeRef.HTML_ID,this._depth=0}appendChild(e){return function(e,t,n){if(e.layoutChildren.length>0||t.parentNode)return void console.warn("### App Runtime ### Document添加多个Body节点----");const o=g(e._docId),r=e.childNodes,s=r.indexOf(n);s<0?r.push(t):r.splice(s,0,t),G(t)?(y(t,t._docId),v(t,e),C(t,e.layoutChildren,e.layoutChildren.length),q(e),Ce(t),o.body=t,_(e._docId).createBody(t)):v(t,e)}(this,e)}insertBefore(e,t){console.warn("### App Runtime ### 暂不支持nodeHtml.insertBefore()")}}class De extends Re{get value(){return this._attr&&this._attr.value}set value(e){this._attr&&(this._attr.value=e)}get checked(){return this._attr&&this._attr.checked}set checked(e){this._attr&&(this._attr.checked=e)}}const ke=/^(touchstart|touchmove|touchcancel|touchend)$/,Be=/^(touchstart|touchmove|touchcancel|touchend|click|longpress)$/;function $e(e,t){let n;return ke.test(e)?(n=new d(e,t))._supportW3C=!1:(n=new c(e,t))._supportW3C=!1,Be.test(e)&&global.isRpkMinPlatformVersionGEQ(1040)&&(n._supportW3C=!0,n._bubbles=!0),n}function je(e){const t=new Pe("html");return t._ownerDocument=e,y(t,e._docId),t.parentNode=e,e.childNodes.push(t),e.layoutChildren.push(t),t}class Me extends Ee{constructor(e,t){var n,o;super(...arguments),this._nodeType=m.NodeType.DOCUMENT,this._nodeName="#document",this.body=null,e=e?e.toString():"",this._docId=e,this._nodeMap={},this.listener=t,this._styleSheetHash={},this._styleSheetHash[0]=[],n=this._docId,o=this,n&&(f[n]=o),Object.defineProperty(this,"documentElement",{configurable:!0,enumerable:!1,writable:!1,value:je(this)}),this._supportNotLastRuleTypeUpdate=!0}createElement(e){let t;return(t="input"===e||"textarea"===e?new De(e):new Re(e))._ownerDocument=this,t}createDocumentFragment(){const e=new Le;return e._ownerDocument=this,e}createTextNode(e){const t=new Oe(e);return t._ownerDocument=this,t}createComment(e){const t=new Ae(e);return t._ownerDocument=this,t}createEvent(e,t){return $e(e,t)}}var ze=function(e,t){var n=[];if(""!==(e=function e(t,n,o){var r,s,a,i,l=[],c=!1;function d(){var e=n.match(Ge)[0];return n=n.substr(e.length),Ye(e)}function h(e){for(;Qe(n.charAt(e));)e++;n=n.substr(e)}function u(e){for(var t=0;"\\"===n.charAt(--e);)t++;return 1==(1&t)}for(h(0);""!==n;)if(Qe(s=n.charAt(0)))c=!0,h(1);else if(s in Je)l.push({type:Je[s]}),c=!1,h(1);else if(","===s){if(0===l.length)throw new SyntaxError("empty sub-selector");t.push(l),l=[],c=!1,h(1)}else if(c&&(l.length>0&&l.push({type:"descendant"}),c=!1),"*"===s)n=n.substr(1),l.push({type:"universal"});else if(s in qe)n=n.substr(1),l.push({type:"attribute",name:qe[s][0],action:qe[s][1],value:d(),ignoreCase:!1});else if("["===s){if(n=n.substr(1),!(r=n.match(We)))throw new SyntaxError("Malformed attribute selector: "+n);n=n.substr(r[0].length),a=Ye(r[1]),o&&("lowerCaseAttributeNames"in o?!o.lowerCaseAttributeNames:o.xmlMode)||(a=a.toLowerCase()),l.push({type:"attribute",name:a,action:He[r[2]],value:Ye(r[4]||r[5]||""),ignoreCase:!!r[6]})}else if(":"===s){if(":"===n.charAt(1)){n=n.substr(2),l.push({type:"pseudo-element",name:d().toLowerCase()});continue}if(n=n.substr(1),a=d().toLowerCase(),r=null,"("===n.charAt(0))if(a in Ze){var p=(i=n.charAt(1))in Ke;if(n=n.substr(p+1),n=e(r=[],n,o),p){if(n.charAt(0)!==i)throw new SyntaxError("unmatched quotes in :"+a);n=n.substr(1)}if(")"!==n.charAt(0))throw new SyntaxError("missing closing parenthesis in :"+a+" "+n);n=n.substr(1)}else{for(var m=1,f=1;f>0&&m<n.length;m++)"("!==n.charAt(m)||u(m)?")"!==n.charAt(m)||u(m)||f--:f++;if(f)throw new SyntaxError("parenthesis not matched");r=n.substr(1,m-2),n=n.substr(m),a in Ve&&((i=r.charAt(0))===r.slice(-1)&&i in Ke&&(r=r.slice(1,-1)),r=Ye(r))}l.push({type:"pseudo",name:a,data:r})}else{if(!Ge.test(n))return l.length&&"descendant"===l[l.length-1].type&&l.pop(),et(t,l),n;a=d(),o&&("lowerCaseTags"in o?!o.lowerCaseTags:o.xmlMode)||(a=a.toLowerCase()),l.push({type:"tag",name:a})}return et(t,l),n}(n,e+"",t)))throw new SyntaxError("Unmatched selector: "+e);return n},Ge=/^(?:\\.|[\w\-\u00b0-\uFFFF])+/,Ue=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,We=/^\s*((?:\\.|[\w\u00b0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])([^]*?)\3|(#?(?:\\.|[\w\u00b0-\uFFFF\-])*)|)|)\s*(i)?\]/,He={__proto__:null,undefined:"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},Je={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent"},qe={__proto__:null,"#":["id","equals"],".":["class","element"]},Ze={__proto__:null,has:!0,not:!0,matches:!0},Ve={__proto__:null,contains:!0,icontains:!0},Ke={__proto__:null,'"':!0,"'":!0};function Xe(e,t,n){var o="0x"+t-65536;return o!=o||n?t:o<0?String.fromCharCode(o+65536):String.fromCharCode(o>>10|55296,1023&o|56320)}function Ye(e){return e.replace(Ue,Xe)}function Qe(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function et(e,t){if(e.length>0&&0===t.length)throw new SyntaxError("empty sub-selector");e.push(t)}const tt=new WeakMap;function nt(e,t){if(!tt.has(t)){const n=function(e,t){const n=Object.keys(t||{}),o={id:ot++,name:e,from:0,size:0,nameHash:{},descLast:{},descNotLast:{}};o.from=rt,o.size=n.length,rt+=n.length;for(let e=0,r=n.length;e<r;e++){const r=n[e],s=t[r];let a;if(!s||"_"===r[0])continue;if(s.animationName){const e=at(s.animationName,t);e&&(s.animationKeyframes=e)}if(s.fontFamily){const e=it(s.fontFamily,t);e&&(s.fontFamilyDesc=e)}if(!s._meta&&st.test(r)){try{const e=ct(r),t=e[0];t.length>1&&(s._meta={},s._meta.ruleDef=t)}catch(e){console.warn(`### App Runtime ### 编译CSS后代选择器(${r})出错：${e.message}`);continue}global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 编译CSS后代选择器(${r})`)}if(s._meta&&s._meta.ruleDef){const e=s._meta.ruleDef;for(let t=0,n=e.length;t<n;t++){const n=e[t];ce(n)?n.idtt=n.name:de(n)?n.idtt=`.${n.value}`:he(n)&&(n.idtt=`#${n.value}`)}}global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 遍历样式节点(${o.id})的选择器(${r})：${JSON.stringify(s)}`);const i=Object.assign({},s),l=o.from+e;if(i._meta){const e=i._meta;delete i._meta,o.nameHash[r]=a=le({name:r,score:null,order:l,style:i,meta:e,_sheetId:o.id});const t=a.meta.ruleDef,n=t[t.length-1];for(let e=0,n=t.length;e<n-1;e++){const n=t[e];if(!ue(n)){const e=n.idtt;o.descNotLast[e]=o.descNotLast[e]||{list:[]},o.descNotLast[e].list.push(a)}}if(!ue(n)){const e=n.idtt;o.descLast[e]=o.descLast[e]||{list:[]},o.descLast[e].list.push(a)}}else{if("@KEYFRAMES"===r)continue;"#"===r[0]?o.nameHash[r]=a=ie({name:r,order:l,style:i,_sheetId:o.id}):"."===r[0]?o.nameHash[r]=a=ae({name:r,order:l,style:i,_sheetId:o.id}):o.nameHash[r]=a=se({name:r,order:l,style:i,_sheetId:o.id})}}return o}(e,t);tt.set(t,n)}return tt.get(t)}let ot=1,rt=1;const st=/\s/;function at(e,t){const n=t["@KEYFRAMES"];if(n){const t=n[e];if(t)return JSON.stringify(t)}return null}function it(e,t){const n=t["@FONT-FACE"],o=e.replace(/["']+/g,"").split(","),r=[];return o.length>0?(o.forEach(e=>{(e=e.trim())&&(n&&n[e]?r.push(n[e]):r.push({fontName:e}))}),JSON.stringify(r)):null}const lt=new Map;function ct(e){return lt.has(e)||lt.set(e,ze(e)),lt.get(e)}function dt(){Object.freeze(c),Object.freeze(c.prototype),Object.freeze(Ae),Object.freeze(Ae.prototype),Object.freeze(Me),Object.freeze(Me.prototype),Object.freeze(Re),Object.freeze(Re.prototype),Object.freeze(Ie),Object.freeze(Ie.prototype),Object.freeze(Le),Object.freeze(Le.prototype),Object.freeze(Pe),Object.freeze(Pe.prototype),Object.freeze(m),Object.freeze(m.prototype),Object.freeze(Ee),Object.freeze(Ee.prototype),Object.freeze(te),Object.freeze(te.prototype),Object.freeze(Oe),Object.freeze(Oe.prototype)}function ht(e,t=[]){return{module:"dom",method:e,args:t}}class ut{constructor(e,t){this.id=e,this.streamer=t,this.actionLen=0}createFinish(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### createFinish---- ");const t=this.streamer.over(this.id,[ht("createFinish")],e);return this.resetActionLen(),t}updateFinish(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### updateFinish---- ");const t=this.streamer.over(this.id,[ht("updateFinish")],e);return this.resetActionLen(),t}createBody(e){const t=M(e),n=t.children;delete t.children;const o=[ht("createBody",[t])];return n&&o.push.apply(o,n.map(e=>ht("addElement",[t.ref,e,-1]))),this.addActions(o)}addNode(e,t,n){let o;if(t&&U(t)||console.error(`### App Runtime ### addNode的parent(${t.type})必须是可渲染节点`),n<0&&(n=-1),U(e))o=this.addElement(e,t.ref,n);else{let r=n;e.layoutChildren.every(e=>(o=U(e)?this.addElement(e,t.ref,r):this.addNode(e,t,r),r+=J(e),-1!==o))}return o}addElement(e,t,n){return n>=0||(n=-1),this.addActions(ht("addElement",[t,M(e),n]))}removeNode(e){let t;return U(e)?t=this.removeElement(e.ref):e.layoutChildren.every(e=>-1!==(t=U(e)?this.removeElement(e.ref):this.removeNode(e))),t}removeElement(e){if(Array.isArray(e)){const t=e.map(e=>ht("removeElement",[e]));return this.addActions(t)}return this.addActions(ht("removeElement",[e]))}moveNode(e,t,n){let o;if(t&&U(t)||console.error("### App Runtime ### moveNode的parent必须是可渲染节点"),n>=0||(n=-1),U(e))o=this.moveElement(e.ref,t.ref,n);else{let r=n;e.layoutChildren.every(e=>(o=U(e)?this.moveElement(e.ref,t.ref,r):this.moveNode(e,t,r),r+=J(e),-1!==o))}return o}moveElement(e,t,n){return this.addActions(ht("moveElement",[e,t,n]))}setProp(e,t,n){}setAttr(e,t,n){const o={attr:{}};return null==n?(console.warn(`### App Runtime ### 组件 ${e} 的属性 ${t} 被修改为 undefined/null, 自动修改为默认值或空值`),o.attr[t]=""):o.attr[t]=n,this.addActions(ht("updateAttrs",[e,o]))}setStyle(e,t,n){const o={style:{}};return null==n?(console.warn(`### App Runtime ### 组件 ${e} 的样式 ${t} 被修改为 undefined/null, 自动修改为默认值或空值`),o.style[t]=""):o.style[t]=n,this.addActions(ht("updateStyle",[e,o]))}setStyles(e,t,n){const o={attr:n};return t&&Object.keys(t).length&&(o.style=t),this.addActions(ht("updateStyle",[e,o]))}addEvent(e,t){return this.addActions(ht("addEvent",[e,t]))}removeEvent(e,t){return this.addActions(ht("removeEvent",[e,t]))}updatePageTitleBar(e){return this.addActions(ht("updateTitleBar",[e]))}exitFullscreen(){return this.addActions(ht("exitFullscreen",[]))}invokeComponentMethod(e,t,n,o){return this.addActions({component:e,ref:t,method:n,args:o})}addActions(e){Array.isArray(e)||(e=[e]),global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### addActions---- ",JSON.stringify(e)),this.actionLen+=e.length,this.streamer.push(this.id,e)}hasActions(){return!!this.actionLen}resetActionLen(){this.actionLen=0}}class pt{constructor(e,t){this.call=e,this.batchThreshold=void 0===t?50:t,this._boolDefineNextTick=!0,this.list=[]}push(e,t){let n;if(0===this.batchThreshold)this.list.push.apply(this.list,t);else if(1===this.batchThreshold)this.list.push.apply(this.list,t),n=this.call(e,this.list),this.list.splice(0);else{if(!(this.batchThreshold>1))throw new Error(`### App Runtime ### push() 不支持的batchThreshold值：${this.batchThreshold}`);for(this.list.push.apply(this.list,t);this.list.length>=this.batchThreshold;){const t=this.list.splice(0,this.batchThreshold);n=this.call(e,t)}}return this._boolDefineNextTick&&this._defineNextTick(e),n}over(e,t){return this.list.length&&(this.call(e,this.list),this.list.splice(0)),this.call(e,t)}_defineNextTick(e){this._nextTick||(this._nextTick=Promise.resolve().then(()=>{this.list.length&&console.warn(`### App Runtime ### _defineNextTick(${e}) 应该由框架保证及时发送`),this._nextTick=null}))}}const mt=[{newN:"t",oldN:"type",newV:["d","a","t","u","p","pe"],oldV:["descendant","attribute","tag","universal","pseudo","pseudo-element"]},{newN:"n",oldN:"name"},{newN:"i",oldN:"ignoreCase"},{newN:"a",oldN:"action"},{newN:"v",oldN:"value"}];var ft={registerComponents:R,getComponentDefaultOptions:L,bindComponentMethods:I,registerStyleObject:function(e,t,n,o,r){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 基于节点(${r&&r.ref})注册样式节点(${o})`),n&&(function(e){for(const t in e){const n=e[t];if(n&&n._meta&&n._meta.ruleDef){const e=n._meta.ruleDef;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let e=0,t=mt.length;e<t;e++){const t=mt[e];n.hasOwnProperty(t.newN)&&(n[t.oldN]=n[t.newN],delete n[t.newN],t.newV&&t.newV.indexOf(n[t.oldN])>-1&&(n[t.oldN]=t.oldV[t.newV.indexOf(n[t.oldN])]))}}}}}(n),function(e,t,n,o){const r=t.id;e._styleSheetHash[r]=t,n?e._styleSheetHash[0].push(r):o._styleSheetId=r}(e,nt(t,n),o,r))},createEvent:$e,createFigment:function(e){const t=new Ie;return t._ownerDocument=e,t},updatePageTitleBar:function(e,t){const n=_(e._docId);n&&n.updatePageTitleBar(t)},exitFullscreen:function(e){const t=_(e._docId);t&&t.exitFullscreen()},setElementProp:function(e,t,n,o){if(!e._ownerDocument||"ref"===t)return;if(e[t]===n&&!1!==o)return;const r=e[t];e[t]=n,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的内部属性(${t})更新(${r}=>${n})`);const s=_(e._docId);s&&s.setProp(e.ref,t,n)},setElementAttr:Fe,setElementStyle:function(e,t,n,o){e._ownerDocument&&(P(e)[t]===n&&!1!==o||(P(e)[t]=n,xe(e,o,"style",null,[t,n])))},setElementStyles:Ne,getElementMatchedCssRuleList:function(e,t){const n=Te(e,t),o=JSON.parse(JSON.stringify(n));for(let t=0,n=o.length;t<n;t++){const n=o[t];n.editable=!0,n.style=x(n._styleFullList,n.style),delete n._styleFullList;const r=A(e._docId,n._sheetId);n.styleSheetName=r?r.name:""}return o},setElementMatchedCssRule:function(e,t,n){const o={},r=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];r.push({name:t.name,value:t.value,disabled:t.disabled}),t.disabled||(o[t.name]=t.value)}const s=Te(e,t)[0];if(s){if(s.type===oe.INLINE)s._styleFullList=r,Ne(e,o);else{const t=g(e._docId);s._styleFullList=r,s.style=o;const n=function(e){return Object.keys(e._hitNodeMap)}(s);for(let e=0,o=n.length;e<o;e++){const o=b(t,n[e]),r=pe(s,o).match;global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 更新CSS规则(${s.name})的样式，元素(${o.ref})的匹配结果：${r}`),r&&(o._finalStyleCache=null,Se(o))}}global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 更新样式:元素(${e.ref})的匹配样式：${t}:${JSON.stringify(o)}`)}else global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 更新样式:元素(${e.ref})无匹配样式：${t}`)},resetNodeChildren:function(e){for(let t=0,n=e.layoutChildren.length;t<n;t++){const n=e.layoutChildren[t];n._tmpRenderIndexInParent=V(n,e)}e.childNodes.length=0,e.layoutChildren.length=0},restoreNodeChildren:function(e,t){if(!t.parentNode||t.parentNode!==e)return;e.childNodes.push(t),e.layoutChildren.push(t);const n=W(e,!0);if(G(t)){const o=_(e._docId),r=Z(t),s=r!==t._tmpRenderIndexInParent;if(t._tmpRenderIndexInParent=null,o&&s)return o.moveNode(t,n,r)}},fireTargetEventListener:ee,clearTargetEventListener:function(e,t,n){n instanceof Object||(n={capture:!!n});const o=n.capture?c.CAPTURING_PHASE:c.BUBBLING_PHASE;e._eventTargetListeners[t]&&delete e._eventTargetListeners[t][o]},getDocumentNodeByRef:b,isNodeInDocument:function(e){return!(!e||!e._docId)},recreateDocument:function(e){const t=e.body;t?e.listener.createBody(t):console.error("### App Runtime ### Document没有body节点, 无法重建")},destroyTagNode:K,getNodeAsJSON:M,getNodeDepth:z};const gt=function(e,n,...o){return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Bridge ### sendActions() 发送消息：${e},${n.length},${JSON.stringify(n)}`),n=JSON.stringify(n,function(e,n){return n&&n.constructor===RegExp?{type:t(n),source:n.source,flags:n.flags}:n}),global.callNative(e,n,...o)},_t=function(e){const t=new pt(gt),n=new ut(e,t);return new Me(e,n)};var yt={init:function(){dt(),ft.createDocument=_t},Node:m,Event:c,TouchEvent:d,helper:ft,exposure:{registerComponents:ft.registerComponents}};const bt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var vt={arrayBufferToBase64:function(e){const t=new Uint8Array(256);for(let e=0;e<bt.length;e++)t[bt.charCodeAt(e)]=e;const n=new Uint8Array(e),o=n.length;let r="";for(let e=0;e<o;e+=3)r+=bt[n[e]>>2],r+=bt[(3&n[e])<<4|n[e+1]>>4],r+=bt[(15&n[e+1])<<2|n[e+2]>>6],r+=bt[63&n[e+2]];return o%3==2?r=r.substring(0,r.length-1)+"=":o%3==1&&(r=r.substring(0,r.length-2)+"=="),r},base64ToArrayBuffer:function(e){const t=new Uint8Array(256);for(let e=0;e<bt.length;e++)t[bt.charCodeAt(e)]=e;let n=.75*e.length;const o=e.length;let r,s,a,i,l,c=0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);const d=new ArrayBuffer(n),h=new Uint8Array(d);for(r=0;r<o;r+=4)s=t[e.charCodeAt(r)],a=t[e.charCodeAt(r+1)],i=t[e.charCodeAt(r+2)],l=t[e.charCodeAt(r+3)],h[c++]=s<<2|a>>4,h[c++]=(15&a)<<4|i>>2,h[c++]=(3&i)<<6|63&l;return d},btoa:function(e){const t=String(e);let n=bt,o=0,r="";for(let e,s,a=.75;!isNaN(e=t.charCodeAt(a))||63&o||(n="=",(a-.75)%1);a+=.75)if(e>127){(s=encodeURI(t.charAt(a)).split("%")).shift();for(let e,t=a%1;s[0|t];t+=.75)e=s[0|t],o=o<<8|parseInt(e,16),r+=n.charAt(63&o>>8-t%1*8);a=.75===a?0:a,a+=.75*s.length%1}else o=o<<8|e,r+=n.charAt(63&o>>8-a%1*8);return r}};let Ct=0;let wt=1;const Et=function(){};class At{constructor(){this._id=wt++,this._width=0,this._height=0,this._src=void 0,this._onload=Et,this._onerror=Et,this.complete=!1}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get src(){return this._src}set src(e){e.startsWith("//")&&(e="http:"+e),this._src=e,At.channel.preloadImage([this._src,this._id],e=>{let t={};"string"==typeof e&&(e=JSON.parse(e)),e.error?(t={type:"error",target:this},this.onerror(t)):(this.complete=!0,this.width="number"==typeof e.width?e.width:0,this.height="number"==typeof e.height?e.height:0,t={type:"load",target:this},this.onload(t))})}addEventListener(e,t){"load"===e?this.onload=t:"error"===e&&(this.onerror=t)}removeEventListener(e,t){"load"===e?this.onload=Et:"error"===e&&(this.onerror=Et)}get onload(){return this._onload}set onload(e){this._onload=e}get onerror(){return this._onerror}set onerror(e){this._onerror=e}}class Ft{constructor(e,t){this._style=t,this._img=e}}class Nt{constructor(){arguments&&4===arguments.length?(this._start_pos={_x:arguments[0],_y:arguments[1]},this._end_pos={_x:arguments[2],_y:arguments[3]},this._type="linear"):arguments&&6===arguments.length&&(this._start_pos={_x:arguments[0],_y:arguments[1],_r:arguments[2]},this._end_pos={_x:arguments[3],_y:arguments[4],_r:arguments[5]},this._type="radial"),this._stop_count=0,this._stops=[0,0,0,0,0]}addColorStop(e,t){this._stop_count<5&&e>=0&&e<=1&&(this._stops[this._stop_count]={_pos:e,_color:t},this._stop_count++)}}class xt{constructor(e){this.className="CanvasRenderingContext2D",this._drawCommands="",this._globalAlpha=1,this._fillStyle="rgb(0,0,0)",this._strokeStyle="rgb(0,0,0)",this._lineWidth=1,this._lineDashOffset=0,this._lineDash=[],this._lineCap="butt",this._lineJoin="miter",this._miterLimit=10,this._globalCompositeOperation="source-over",this._textAlign="start",this._textBaseline="alphabetic",this._font="10px sans-serif",this._savedGlobalAlpha=[],this.timer=null,this.componentId=e.ref,this.canvas=e,this.schedule=!1}set fillStyle(e){this._fillStyle=e;let t="";if("string"==typeof e)this._drawCommands=this._drawCommands.concat("F"+e+";");else if(e instanceof Ft){const t=e._img;xt.channel.bindImageTexture(this.canvas,t),this._drawCommands=this._drawCommands.concat("G"+t._id+","+e._style+";")}else if("linear"===e._type){t="D"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}else if("radial"===e._type){t="H"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._start_pos._r.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._end_pos._r.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}this.usePromise()}get fillStyle(){return this._fillStyle}get globalAlpha(){return this._globalAlpha}set globalAlpha(e){this._globalAlpha=e,this._drawCommands=this._drawCommands.concat("a"+e.toFixed(2)+";"),this.usePromise()}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=e;let t="";if("string"==typeof e)this._drawCommands=this._drawCommands.concat("S"+e+";");else if(e instanceof Ft){const t=e._img;xt.channel.bindImageTexture(this.canvas,t),this._drawCommands=this._drawCommands.concat("Q"+t._id+","+e._style+";")}else if("linear"===e._type){t="N"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}else if("radial"===e._type){t="O"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._start_pos._r.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._end_pos._r.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}this.usePromise()}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._drawCommands=this._drawCommands.concat("W"+e+";"),this.usePromise()}get lineCap(){return this._lineCap}set lineCap(e){this._lineCap=e,this._drawCommands=this._drawCommands.concat("C"+e+";"),this.usePromise()}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin=e,this._drawCommands=this._drawCommands.concat("J"+e+";"),this.usePromise()}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit=e,this._drawCommands=this._drawCommands.concat("M"+e+";"),this.usePromise()}get globalCompositeOperation(){return this._globalCompositeOperation}set globalCompositeOperation(e){this._globalCompositeOperation=e;let t=0;switch(e){case"source-over":t=0;break;case"source-atop":t=1;break;case"source-in":t=2;break;case"source-out":t=3;break;case"destination-over":t=4;break;case"destination-atop":t=5;break;case"destination-in":t=6;break;case"destination-out":t=7;break;case"lighter":t=8;break;case"copy":t=9;break;case"xor":t=10;break;default:t=0}this._drawCommands=this._drawCommands.concat("B"+t+";"),this.usePromise()}get textAlign(){return this._textAlign}set textAlign(e){this._textAlign=e;let t=0;switch(e){case"start":t=0;break;case"end":t=1;break;case"left":t=2;break;case"center":t=3;break;case"right":t=4;break;default:t=0}this._drawCommands=this._drawCommands.concat("A"+t+";"),this.usePromise()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e;let t=0;switch(e){case"alphabetic":t=0;break;case"middle":t=1;break;case"top":t=2;break;case"hanging":t=3;break;case"bottom":t=4;break;case"ideographic":t=5;break;default:t=0}this._drawCommands=this._drawCommands.concat("E"+t+";"),this.usePromise()}get font(){return this._font}set font(e){this._font=e,this._drawCommands=this._drawCommands.concat("j"+e+";"),this.usePromise()}setTransform(e,t,n,o,r,s){this._drawCommands=this._drawCommands.concat("t"+(1===e?"1":e.toFixed(2))+","+(0===t?"0":t.toFixed(2))+","+(0===n?"0":n.toFixed(2))+","+(1===o?"1":o.toFixed(2))+","+r.toFixed(2)+","+s.toFixed(2)+";"),this.usePromise()}transform(e,t,n,o,r,s){this._drawCommands=this._drawCommands.concat("f"+(1===e?"1":e.toFixed(2))+","+(0===t?"0":t.toFixed(2))+","+(0===n?"0":n.toFixed(2))+","+(1===o?"1":o.toFixed(2))+","+r+","+s+";"),this.usePromise()}resetTransform(){this._drawCommands=this._drawCommands.concat("m;"),this.usePromise()}scale(e,t){this._drawCommands=this._drawCommands.concat("k"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}rotate(e){this._drawCommands=this._drawCommands.concat("r"+e.toFixed(6)+";"),this.usePromise()}translate(e,t){this._drawCommands=this._drawCommands.concat("l"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}save(){this._savedGlobalAlpha.push(this._globalAlpha),this._drawCommands=this._drawCommands.concat("v;"),this.usePromise()}restore(){this._drawCommands=this._drawCommands.concat("e;"),this._globalAlpha=this._savedGlobalAlpha.pop(),this.usePromise()}createPattern(e,t){return new Ft(e,t)}createLinearGradient(e,t,n,o){return new Nt(e,t,n,o)}createRadialGradient(e,t,n,o,r,s){return new Nt(e,t,n,o,r,s)}strokeRect(e,t,n,o){this._drawCommands=this._drawCommands.concat("s"+e+","+t+","+n+","+o+";"),this.usePromise()}clearRect(e,t,n,o){this._drawCommands=this._drawCommands.concat("c"+e+","+t+","+n+","+o+";"),this.usePromise()}clip(){this._drawCommands=this._drawCommands.concat("p;"),this.usePromise()}resetClip(){this._drawCommands=this._drawCommands.concat("q;"),this.usePromise()}closePath(){this._drawCommands=this._drawCommands.concat("o;"),this.usePromise()}moveTo(e,t){this._drawCommands=this._drawCommands.concat("g"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}lineTo(e,t){this._drawCommands=this._drawCommands.concat("i"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}getLineDash(){return this._lineDash}setLineDash(e){if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++){if("number"!=typeof e[t])return void console.warn("### App Canvas ### setLineDash 的参数必须为数组且元素值为数字类型");if(isNaN(e[t]))return void console.warn("### App Canvas ### setLineDash 的参数必须为数组且元素值不能为 NaN")}e.length%2==1&&e.push(...e),this._lineDash=e,this._drawCommands=this._drawCommands.concat("I"+e+";"),this.usePromise()}else console.warn("### App Canvas ### setLineDash 的参数必须为数组")}get lineDashOffset(){return this._lineDashOffset}set lineDashOffset(e){"number"==typeof e?isNaN(e)?console.warn("### App Canvas ### lineDashOffset 值不能为 NaN"):(this._lineDashOffset=e,this._drawCommands=this._drawCommands.concat("V"+e+";"),this.usePromise()):console.warn("### App Canvas ### lineDashOffset 值必须为数字类型")}quadraticCurveTo(e,t,n,o){this._drawCommands=this._drawCommands.concat("u"+e+","+t+","+n+","+o+";"),this.usePromise()}bezierCurveTo(e,t,n,o,r,s){this._drawCommands=this._drawCommands.concat("z"+e.toFixed(2)+","+t.toFixed(2)+","+n.toFixed(2)+","+o.toFixed(2)+","+r.toFixed(2)+","+s.toFixed(2)+";"),this.usePromise()}arcTo(e,t,n,o,r){this._drawCommands=this._drawCommands.concat("h"+e+","+t+","+n+","+o+","+r+";"),this.usePromise()}beginPath(){this._drawCommands=this._drawCommands.concat("b;")}fillRect(e,t,n,o){this._drawCommands=this._drawCommands.concat("n"+e+","+t+","+n+","+o+";"),this.usePromise()}rect(e,t,n,o){this._drawCommands=this._drawCommands.concat("w"+e+","+t+","+n+","+o+";"),this.usePromise()}fill(){this._drawCommands=this._drawCommands.concat("L;"),this.usePromise()}stroke(){this._drawCommands=this._drawCommands.concat("x;"),this.usePromise()}arc(e,t,n,o,r,s){let a=0;s&&(a=1),this._drawCommands=this._drawCommands.concat("y"+e.toFixed(2)+","+t.toFixed(2)+","+n.toFixed(2)+","+o+","+r+","+a+";"),this.usePromise()}fillText(e,t,n){this._drawCommands=this._drawCommands.concat("T"+vt.btoa(e)+","+t+","+n+",0.0;"),this.usePromise()}strokeText(e,t,n){this._drawCommands=this._drawCommands.concat("U"+vt.btoa(e)+","+t+","+n+",0.0;"),this.usePromise()}measureText(e){this._drawCommands=this._drawCommands.concat("K"+e+";");const t=parseFloat(xt.channel.renderBufferSync(this.componentId,this._drawCommands));return this._drawCommands="",{width:t}}isPointInPath(e,t){throw new Error("Canvas not supported yet")}drawImage(e,t,n,o,r,s,a,i,l){const c=arguments.length;"image"===e.type&&(e={src:e.attr.src}),xt.channel.bindImageTexture(this.canvas,e),this._drawCommands+=function(e){if(3===c){const o=parseFloat(t)||0,r=parseFloat(n)||0;return"d"+e._id+",0,0,"+e.width+","+e.height+","+o+","+r+","+e.width+","+e.height+";"}if(5===c){const s=parseFloat(t)||0,a=parseFloat(n)||0,i=parseInt(o)||e.width,l=parseInt(r)||e.height;return"d"+e._id+",0,0,"+e.width+","+e.height+","+s+","+a+","+i+","+l+";"}if(9===c)return t=parseFloat(t)||0,n=parseFloat(n)||0,o=parseInt(o)||e.width,r=parseInt(r)||e.height,s=parseFloat(s)||0,a=parseFloat(a)||0,i=parseInt(i)||e.width,l=parseInt(l)||e.height,"d"+e._id+","+t+","+n+","+o+","+r+","+s+","+a+","+i+","+l+";"}(e),this.usePromise()}getImageData(e,t,n,o){this._drawCommands=this._drawCommands.concat("R"+e+","+t+","+n+","+o+";");const r=xt.channel.renderBufferSync(this.componentId,this._drawCommands);this._drawCommands="";const s=vt.base64ToArrayBuffer(r);return{data:new Uint8ClampedArray(s),width:n,height:o}}createImageData(e,t){let n;return 1===arguments.length&&(e=(n=e).width,t=n.height),(e<=0||t<=0)&&(e=0,t=0),{width:e,height:t,data:new Uint8ClampedArray(e*t*4)}}putImageData(e,t,n,o=0,r=0,s,a){const i=arguments.length,l=e.width,c=e.height,d=e.data;if(d.length!==c*l*4)throw new Error("illegal ImageData");if(3===i)this._drawCommands=this._drawCommands.concat("P"+t+","+n+","+l+","+c+","+l+","+c+";"+vt.arrayBufferToBase64(d)+";");else if(7===i){const e={left:o<0?0:o,top:r<0?0:r};e.right=Math.min(Math.max(o+s,e.left),l),e.bottom=Math.min(Math.max(r+a,e.top),c),o=e.left,r=e.top,s=e.right-e.left,a=e.bottom-e.top;const t=new Uint8ClampedArray(s*a*4);let n,i=0;for(let a=r;a<e.bottom;a++){n=4*(l*a+o);for(let e=0;e<s;e++)t[i]=d[n],t[i+1]=d[n+1],t[i+2]=d[n+2],t[i+3]=d[n+3],i+=4,n+=4}this._drawCommands=this._drawCommands.concat("P"+o+","+r+","+s+","+a+","+s+","+a+";"+vt.arrayBufferToBase64(t)+";")}this.usePromise()}usePromise(){const e=this;e.schedule||(Promise.resolve().then(()=>{xt.channel.render2d(e.componentId,e._drawCommands),e._drawCommands="",e.schedule=!1}),e.schedule=!0)}}const St=function(){let e=null;const t={},n=536870913,o=536870912;return{getModule:t=>e,setModule(n,o){const r="__native_module__"+n;t[r]||(t[r]=o,e=o)},callEnable:(t,n)=>e.enable({componentId:t,config:n}),callSetContextType(t,n){e.setContextType({componentId:t,contextType:n})},renderBufferSync:function(e,t){return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas syncDrawBuffer ### ${t} `),global.extendCallNative(e,o,t)},render2d:function(e,t){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas render2d ### ${t} `),global.extendCallNative(e,n,t)},bindImageTexture(t,n={}){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas bindImageTexture url ### ${n.src} `),!n._id){let e=new At;n._id=e._id,e=null}const o=n._id+"_"+n.src;if(-1!==t._bindTexture.indexOf(o))return;let r=e.bindImageTexture({componentId:t.ref,src:n.src,imageId:n._id});"string"==typeof r&&(r=JSON.parse(r)),r&&r.height&&r.width&&(n.height=r.height,n.width=r.width,t._bindTexture.push(o))},preloadImage([t,n],o){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas preloadImage url ### ${t} `),e.preloadImage({url:t,id:n,success:function(e){e.url=t,e.id=n,o&&o(e)}})}}}();var Tt={enable:function(e,t,{module:n}={}){e._bindTexture=[],St.setModule(t.id,n),At.channel=xt.channel=St,St.callEnable(e.ref,[0,-1,!1,!1,1,"white",!1]),global.Image=At;const o={};return e.getContext=function(e){let t=null;if(!e.match(/2d/i))throw new Error("### App Canvas ### not supported context "+e);return o[this.ref]||(o[this.ref]=new xt(this)),t=o[this.ref],St.callSetContextType(this.ref,0),t},e}};const Rt={forall:"∀",part:"∂",exists:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ν",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",middot:"·",nbsp:" ",quot:"'",amp:"&",lt:"<",gt:">",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦","#8203":""};function Lt(e){const t={},n=e.split(",");for(let e=0;e<n.length;e++)t[n[e]]=!0;return t}function It(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})}function Ot(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}function Pt(e,t){const n=[];if(t)switch(e.forEach((e,t)=>{n[t]={},n[t].n=e}),t.length){case 1:e.forEach((e,o)=>{n[o].v=t[0]});break;case 2:e.forEach((e,o)=>{n[o].v=o%2?t[1]:t[0]});break;case 3:e.forEach((e,o)=>{n[o].v=o%2?t[1]:t[o]});break;default:e.forEach((e,o)=>{n[o].v=t[o]})}return n}function Dt(e){return"number"==typeof e||"string"==typeof e}const kt=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,Bt=/^<\/([-A-Za-z0-9_]+)[^>]*>/,$t=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,jt=Lt("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr"),Mt=Lt("br,a,code,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),zt=Lt("abbr,acronym,applet,b,basefont,bdo,big,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),Gt=Lt("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),Ut=Lt("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),Wt=Lt("script,style,block");const Ht=["NOTE","WARNING","ERROR"],Jt={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},qt=["px","%"],Zt=/^[-+]?[0-9]*\.?[0-9]+(.*)$/,Vt=/^#[0-9a-fA-F]{6}$/,Kt=/^#[0-9a-fA-F]{3}$/,Xt=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,Yt=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/,Qt=/^hsl\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*\)$/,en=/^hsla\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d*\.?\d+)\s*\)$/,tn=/^[-+]?[0-9]+$/,nn=/^url\(\s*['"]?\s*([^()]+?)\s*['"]?\s*\)$/,on=/^[a-zA-Z_][a-zA-Z0-9]*$/,rn=/^[-+]?[0-9]*\.?[0-9]+$/,sn={length:function(e,t){const n=(e=(e||"").toString()).match(Zt);if(t||(t=qt),n){const o=n[1];return o?t.indexOf(o.toLowerCase())>=0?{value:e}:{value:parseFloat(e)+t[0],reason:function(e,n,r){return"ERROR: 属性 `"+Ot(e)+"` 不支持单位 `"+o+"`, 目前仅支持 `"+JSON.stringify(t)+"`"}}:{value:parseFloat(e)+t[0],reason:function(e,n,o){return"WARNING: 属性 `"+Ot(e)+"` 没有指定单位，默认为 `"+t[0]+"`"}}}return{value:null,reason:function(e,t,n){return"ERROR: 属性 `"+Ot(e)+"` 的值 `"+t+"` 不正确(仅支持数值)"}}},color:function(e){if((e=(e||"").toString()).match(Vt))return{value:e};if(e.match(Kt))return{value:"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3],reason:function(e,t,n){return"NOTE: 颜色值 `"+t+"` 转换为 `"+n+"`"}};if(Jt[e])return{value:Jt[e],reason:function(e,t,n){return"NOTE: 颜色值 `"+t+"` 转换为 `"+n+"`"}};let t,n,o,r,s,a,i,l;return(t=Xt.exec(e))&&(n=parseInt(t[1]),o=parseInt(t[2]),r=parseInt(t[3]),n>=0&&n<=255&&o>=0&&o<=255&&r>=0&&r<=255)?{value:"rgb("+[n,o,r].join(",")+")"}:(t=Yt.exec(e))&&(n=parseInt(t[1]),o=parseInt(t[2]),r=parseInt(t[3]),s=parseFloat(t[4]),n>=0&&n<=255&&o>=0&&o<=255&&r>=0&&r<=255&&s>=0&&s<=1)?{value:"rgba("+[n,o,r,s].join(",")+")"}:(t=Qt.exec(e)||en.exec(e))&&(a=parseInt(t[1]),i=parseInt(t[2]),l=parseInt(t[3]),s=parseFloat(t[4]),a>=0&&a<=360&&i>=0&&i<=100&&l>=0&&l<=100)?s>=0&&s<=1?{value:`hsla(${a},${i}%,${l}%,${s})`}:{value:`hsl(${a},${i}%,${l}%)`}:"transparent"===e?{value:"rgba(0,0,0,0)"}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的颜色值 `"+t+"` 无效`"}}},number:function(e){const t=(e=(e||"").toString()).match(rn);return t&&!t[1]?{value:parseFloat(e)}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+t+"` 无效 ` (仅支持数值)"}}},integer:function(e){return(e=(e||"").toString()).match(tn)?{value:parseInt(e,10)}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+t+"` 无效 ` (仅支持整数)"}}},url:function(e){if((e=(e||"").toString().trim()).match(/^none$/i))return{value:"none"};const t=nn.exec(e);return t?{value:t[1]}:{value:null,reason:function(e,t,n){return"WARNING: 属性`"+Ot(e)+"` 的值 `"+t+"` 必须是 none 或者 url(...)"}}},name:function(e){return(e=(e||"").toString()).match(on)?{value:e}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+t+"` 格式不正确"}}},enum:function(e,t){const n=e.indexOf(t);return n>0?{value:t}:0===n?{value:t,reason:function(e,t,n){return"NOTE:  属性`"+Ot(e)+"` 的值 `"+t+"` 是缺省值(可以忽略不写)"}}:{value:null,reason:function(t,n,o){return"ERROR: 属性`"+Ot(t)+"` 的值 `"+n+"` 无效 ` (有效枚举值为: `"+e.join("`|`")+"`)"}}},arraylength:function(e,t,n){const o=(t=(t||"").toString()).split(/\s+/);if(o&&o.length<=4){const t=[];let r;const s=[];let a=0;return o.forEach((e,o)=>{if(Dt((r=sn.length(e,n)).value)&&t.push(r.value),r.reason){let t=r.reason(o.toString(),e,r.value);const n=t.match(/^([A-Z]+):/);if(n){const e=Ht.indexOf(n[1]);a<Ht.indexOf(n[1])&&(a=e),t=t.replace(n[0],"").trim()}s.push(t)}}),{value:a<2?Pt(e,t):null,reason:s.length>0?function(e,t,n){return Ht[a]+": 属性`"+Ot(e)+"` 的值 `"+t+"` 存在问题: \n  "+s.join("\n  ")}:null}}return{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+t+"` 格式不正确"}}},arraycolor:function(e,t){const n=(t=(t||"").toString()).split(/\s+/);if(n&&n.length<=4){const t=[];let o;const r=[];let s=0;return n.forEach((e,n)=>{if(Dt((o=sn.color(e)).value)&&t.push(o.value),o.reason){let t=o.reason(n.toString(),e,o.value);const a=t.match(/^([A-Z]+):/);if(a){const e=Ht.indexOf(a[1]);s<Ht.indexOf(a[1])&&(s=e),t=t.replace(a[0],"").trim()}r.push(t)}}),{value:s<2?Pt(e,t):null,reason:r.length>0?function(e,t,n){return Ht[s]+": 属性`"+Ot(e)+"` 的值 `"+t+"` 存在问题: \n  "+r.join("\n  ")}:null}}return{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+t+"` 格式不正确"}}},border:function(e,t){const n=(e=(e||"").toString()).split(/\s+/);if(n&&n.length<=3){let e,o=[];const r=[];let s=0;const a=[];let i=-1;return n.forEach((n,i)=>{if(Dt(sn.length(n,t).value)?(a.push(0),(e=cn.borderWidth(n)).value instanceof Array&&(o=o.concat(e.value))):Dt(cn.borderStyle(n).value)?(a.push(1),e=cn.borderStyle(n),o.push({n:"borderStyle",v:n})):Dt(sn.color(n).value)?(a.push(2),(e=cn.borderColor(n)).value instanceof Array&&(o=o.concat(e.value))):(e={},s=2,r.push("属性`"+i+"` 的值 `"+n+"` 存在问题: \n  不满足width、style和color的检验标准")),e&&e.reason){let t=e.reason(i.toString(),n,e.value);const o=t.match(/^([A-Z]+):/);if(o){const e=Ht.indexOf(o[1]);s<Ht.indexOf(o[1])&&(s=e),t=t.replace(o[0],"").trim()}r.push(t)}}),a.forEach(e=>{e>i?i=e:(s=2,r.push("必须按顺序设置属性width style color"))}),{value:s<2?o:null,reason:r.length>0?function(e,t,n){return Ht[s]+": 属性`"+Ot(e)+"` 的值 `"+t+"` 存在问题: \n  "+r.join("\n  ")}:null}}return{value:null,reason:function(e,t,n){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+t+"` 格式不正确"}}},display:function(e){e=(e||"").toString();const t=["flex","none"],n=t.indexOf(e);return n>0?{value:e}:"block"===e?{value:"flex",reason:function(e,n,o){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+n+"` 需修改为flex ` (有效枚举值为: `"+t.join("`|`")+"`)"}}:0===n?{value:e,reason:!1}:{value:null,reason:function(e,n,o){return"ERROR: 属性`"+Ot(e)+"` 的值 `"+n+"` 无效 ` (有效枚举值为: `"+t.join("`|`")+"`)"}}}};function an(e){return sn.enum.bind(null,e)}function ln(e,t){return sn[e].bind(null,t)}const cn={width:sn.length,height:sn.length,padding:ln("arraylength",["paddingTop","paddingRight","paddingBottom","paddingLeft"]),paddingLeft:sn.length,paddingRight:sn.length,paddingTop:sn.length,paddingBottom:sn.length,margin:ln("arraylength",["marginTop","marginRight","marginBottom","marginLeft"]),marginLeft:sn.length,marginRight:sn.length,marginTop:sn.length,marginBottom:sn.length,border:sn.border,borderWidth:ln("arraylength",["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"]),borderLeftWidth:sn.length,borderTopWidth:sn.length,borderRightWidth:sn.length,borderBottomWidth:sn.length,borderColor:ln("arraycolor",["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"]),borderLeftColor:sn.color,borderTopColor:sn.color,borderRightColor:sn.color,borderBottomColor:sn.color,borderStyle:an(["solid","dotted","dashed"]),borderRadius:sn.length,borderBottomLeftRadius:sn.length,borderBottomRightRadius:sn.length,borderTopLeftRadius:sn.length,borderTopRightRadius:sn.length,flex:sn.number,flexGrow:sn.number,flexShrink:sn.number,flexBasis:sn.length,flexDirection:an(["row","column"]),flexWrap:an(["nowrap","wrap","wrap-reverse"]),justifyContent:an(["flex-start","flex-end","center","space-between"]),alignItems:an(["stretch","flex-start","flex-end","center"]),alignContent:an(["stretch","flex-start","flex-end","center","space-between","space-around"]),position:an(["none","fixed"]),top:sn.length,bottom:sn.length,left:sn.length,right:sn.length,zIndex:sn.integer,opacity:sn.number,backgroundColor:sn.color,backgroundImage:sn.url,backgroundRepeat:an(["no-repeat","repeat","repeat-x","repeat-y"]),backgroundPosition:sn.position,display:sn.display,visibility:an(["visible","hidden"]),lines:sn.integer,color:sn.color,fontSize:sn.length,fontStyle:an(["normal","italic"]),fontWeight:an(["normal","bold"]),textDecoration:an(["none","underline","line-through"]),textAlign:an(["left","center","right"]),lineHeight:sn.length,textOverflow:an(["clip","ellipsis"]),placeholderColor:sn.color,selectedColor:sn.color,textColor:sn.color,timeColor:sn.color,textHighlightColor:sn.color,strokeWidth:sn.length,progressColor:sn.color,resizeMode:an(["cover","contain","stretch","center"]),columns:sn.number,columnSpan:sn.number};function dn(e,t){const n={},o=[],r=function(e,t){let n,o;const r=cn[e];return"function"==typeof r?(n="function"!=typeof t?r(t):{value:t}).reason&&(o={reason:n.reason(e,t,n.value)}):(n={value:t},o={reason:"ERROR: 样式名 `"+Ot(e)+"` 不支持"}),{value:n.value instanceof Array?n.value:[{n:e,v:n.value}],log:o}}(It(e),t);return r.value.forEach(e=>{Dt(e.v)&&o.push(e)}),o&&(n.value=o),r.log&&(n.log=r.log.reason),n}const hn={img:"image",p:"text",h1:"text",h2:"text",h3:"text",h4:"text",h5:"text",h6:"text",b:"span",strong:"span",i:"span",del:"span",article:"div",br:"span"};function un(e){const t=hn[e];return void 0!==t?t:e}const pn={div:{},h1:{fontSize:"60px",fontWeight:"normal"},h2:{fontSize:"45px",fontWeight:"normal"},h3:{fontWeight:"normal",fontSize:"35px"},h4:{fontWeight:"normal",fontSize:"30px"},h5:{fontWeight:"normal",fontSize:"25px"},h6:{fontWeight:"normal",fontSize:"20px"},b:{fontWeight:"bold"},strong:{fontWeight:"bold"},i:{fontStyle:"italic"},a:{color:"#00BFFF"},del:{textDecoration:"line-through"}};function mn(e){let t={};return pn[e]&&(t=pn[e]),t}const fn={br:{value:"\n"}};function gn(e){let t={};return fn[e]&&(t=fn[e]),t}function _n(e,t,n){const o="html"!==t,r="edit"===n;e=function(e){return e.replace(/<\?xml.*\?>\n/,"").replace(/<.*!doctype.*>\n/,"").replace(/<.*!DOCTYPE.*>\n/,"")}(e),e=e.replace(/&([a-zA-Z#0-9]+?);/g,(e,t)=>Rt[t]||"&"+t+";").replace(/\r\n?/g,"");const s=[],a={type:"div",children:[],events:{},classList:[],attr:{},style:{flex:1,flexDirection:"column"}};return function(e,t){let n,o,r;const s=[];let a=e;for(s.last=function(){return this[this.length-1]};e;){if(o=!0,s.last()&&Wt[s.last()])e=e.replace(new RegExp("([\\s\\S]*?)(</"+s.last()+"[^>]*>)","i"),function(e,n){return n=n.replace(/<!--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1"),t.text&&t.text(n),""}),l(0,s.last());else if(0===e.indexOf("\x3c!--")?(n=e.indexOf("--\x3e"))>=0&&(t.comment&&t.comment(e.substring(4,n)),e=e.substring(n+3),o=!1):0===e.indexOf("</")?(r=e.match(Bt))&&(e=e.substring(r[0].length),r[0].replace(Bt,l),o=!1):0===e.indexOf("<")&&(r=e.match(kt))&&(e=e.substring(r[0].length),r[0].replace(kt,i),o=!1),o){n=e.indexOf("<");let o="";for(;0===n;)o+="<",n=(e=e.substring(1)).indexOf("<");o+=n<0?e:e.substring(0,n),e=n<0?"":e.substring(n),t.text&&t.text(o)}e===a&&console.error("### App Parser ### 解析错误: "+e),a=e}function i(e,n,o,r){if(n=n.toLowerCase(),Mt[n])for(;s.last()&&zt[s.last()];)l(0,s.last());if(Gt[n]&&s.last()===n&&l(0,n),(r=jt[n]||!!r)||s.push(n),t.start){const e=[];o.replace($t,function(t,n){const o=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:Ut[n]?n:"";e.push({name:n,value:o,escaped:o.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(n,e,r)}}function l(e,n){let o=0;if(n)for(n=n.toLowerCase(),o=s.length-1;o>=0&&s[o]!==n;o--);if(o>=0){for(let e=s.length-1;e>=o;e--)t.end&&t.end(s[e]);s.length=o}}l()}(e,{start:function(e,t,n){const i={type:o?e:un(e),children:[],events:{},classList:[],attr:o?{}:gn(e),style:o?{}:mn(e)};if(0!==t.length&&(i.attr=t.reduce(function(e,t){const n=It(t.name);let o=t.value;return"class"===n?i.classList=o.split(/\s+/):"style"===n?o.split(";").forEach(function(e){let t,n,o=e.trim().split(":");o.length>2&&(o[1]=o.slice(1).join(":"),o=o.slice(0,2)),2===o.length&&((n=dn(t=o[0].trim(),o[1].trim())).value&&n.value.forEach(e=>{Dt(e.v)&&(i.style[e.n]=e.v)}),n.log&&console.warn("### App Parser ###",n.log))}):"id"===n?i.id=o:r?e[n]=o:(o.match(/ /)&&(o=o.split(" ")),e[n]?Array.isArray(e[n])?e[n].push(o):e[n]=[e[n],o]:e[n]=o),e},{})),o||"source"!==i.type||(a.source=i.attr.src),n){const e=s[0]||a;void 0===e.children&&(e.children=[]),e.children.push(i)}else s.unshift(i)},end:function(e){const t=o?e:un(e),n=s.shift();if(n.type!==t&&console.error("### App Parser ### 结束标签不匹配:",e),!o&&"video"===n.type&&a.source&&(n.attr.src=a.source,delete a.source),0===s.length)a.children.push(n);else{const e=s[0];void 0===e.children&&(e.children=[]),e.children.push(n)}},text:function(e){if(""!==e.slice().replace(/\s*/,"")){const t=s[0];if(!r||t&&-1!==["text","a","span"].indexOf(t.type)){if(t)if(-1!==["text","a"].indexOf(t.type)){const n={type:"span",children:[],events:{},classList:[],attr:{value:e},style:{},polyfill:!0};void 0===t.children&&(t.children=[]),t.children.push(n)}else t.attr.value=e}else{const n={type:"text",children:[],events:{},classList:[],attr:{value:e},style:{}};(t||a).children.push(n)}}},comment:function(e){}}),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Parser ### 解析${t}文本成功：${JSON.stringify(a)}`),a}var yn={compile:_n,parseHTML:function(e){const t=_n(e,"","edit");return function e(t){if(t.children){-1!==["text","a"].indexOf(t.type)&&(t.children.length>0&&delete t.attr.value,1===t.children.length&&t.children[0].polyfill&&(t.attr=Object.assign(t.attr,t.children[0].attr),t.children=[]));for(let n=0,o=t.children.length;n<o;n++){const o=t.children[n];e(o)}}}(t),t.children||[]}};var bn={compile:function(e,t){return""===(e=e.trim())&&(e="<div></div>"),yn.compile(e,t)},validateStyle:dn,parseHTML:yn.parseHTML};const vn={Listener:ut,Streamer:pt,helper:ft,misc:Q},Cn={Node:m,Event:c,TouchEvent:d,DomDocument:Me,freeze:dt},wn={animation:class{constructor(e,t,n={},o){this.page=e,this.commonParams={componentId:t.ref,animationId:(Ct++).toString()},n.options&&n.options.iterations===1/0&&(n.options.iterations=-1),this.initParams=Object.assign(n,this.commonParams),this.animationModule=o,this.animationModule.enable(this.initParams)}set finished(e){console.warn("### App Framework ### Animation Api: finished 是只读属性")}get finished(){return this.animationModule.getFinished(this.commonParams)}set playState(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: playState 是只读属性")}get playState(){const e=this.animationModule.getPlayState(this.commonParams);return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### Animation Api: 获取 playState 状态为：${e}`),e}set startTime(e=""){Object.assign(this.commonParams,{startTime:e}),this.animationModule.setStartTime(this.commonParams)}get startTime(){const e=this.animationModule.getStartTime(this.commonParams);return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### Animation Api: 获取 startTime 状态为：${e}`),e}set onfinish(e){this.animationModule.onfinish({componentId:this.commonParams.componentId,animationId:this.commonParams.animationId,success:()=>{e&&e()}})}get onfinish(){return()=>{}}set oncancel(e){this.animationModule.oncancel({componentId:this.commonParams.componentId,animationId:this.commonParams.animationId,success:()=>{e&&e()}})}get oncancel(){return()=>{}}play(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 play 方法"),this.animationModule.play(this.commonParams)}finish(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 finish 方法"),this.animationModule.finish(this.commonParams)}pause(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 pause 方法"),this.animationModule.pause(this.commonParams)}cancel(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 cancel 方法"),this.animationModule.cancel(this.commonParams)}reverse(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 reverse 方法"),this.animationModule.reverse(this.commonParams)}},canvas:Tt,parser:bn};e.Runtime=yt,e.Base64=vt,e.runtime=vn,e.dom=Cn,e.bundles=wn,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=infras-ext.js.map
