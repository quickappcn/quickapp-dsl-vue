!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self)["infras-ext"]={})}(this,function(e){"use strict";class t{constructor(e,n={bubbles:!1,cancelable:!1}){if(arguments.length>1&&"object"!=typeof n)throw new Error(`### App Runtime ### addEventListener() 参数2传递的话，必须是对象：${n}`);this._type=e,this._bubbles=n.bubbles,this._cancelable=n.cancelable,this._target=null,this._currentTarget=null,this._eventPhase=t.NONE,this._defaultPrevented=!1,this._timeStamp=Date.now(),this._supportW3C=!0,this._flagStopPropagation=!1,this._flagStopImmediatePropagation=!1,this._throwError=!0}get type(){return this._type}get bubbles(){return this._bubbles}get cancelable(){return this._cancelable}get target(){return this._target}get currentTarget(){return this._currentTarget}get eventPhase(){return this._eventPhase}get defaultPrevented(){return this._defaultPrevented}get timeStamp(){return this._timeStamp}stopPropagation(){this._flagStopPropagation=!0}stopImmediatePropagation(){this._flagStopImmediatePropagation=!0,this.stopPropagation()}preventDefault(){throw new Error("### App Runtime ### preventDefault() 暂不支持该方法")}toJSON(){return{type:this._type,target:this._target,currentTarget:this._currentTarget,timeStamp:this._timeStamp}}}t.NONE=0,t.CAPTURING_PHASE=1,t.AT_TARGET=2,t.BUBBLING_PHASE=3;class n extends t{constructor(){super(...arguments),this._touches=null,this._changedTouches=null}get touches(){return this._touches}set touches(e){if(this._touches)throw new Error("### App Framework ### TouchEvent 不支持修改 touches 属性");this._touches=e}get changedTouches(){return this._changedTouches}set changedTouches(e){if(this._changedTouches)throw new Error("### App Framework ### TouchEvent 不支持修改 changedTouches 属性");this._changedTouches=e}toJSON(){const e=super.toJSON();return Object.assign(e,{touches:this._touches,changedTouches:this._changedTouches})}}const r={HTML_ID:"-1"},o={UNKNOWN:0,ELEMENT:1,ATTR:2,TEXT:3,COMMENT:8,DOCUMENT:9,DOCUMENT_FRAGMENT:11,FIGMENT:101};let s=1;class i{constructor(){this._nodeType=i.NodeType.UNKNOWN,this._nodeName=null,this._nodeValue=null,this._ownerDocument=null,this._textContent=null,this.ref=(s++).toString(),this.childNodes=[],this.layoutChildren=[],this.parentNode=null,this.nextSibling=null,this.previousSibling=null,this._docId=null,this._layout=!1,this._render=!1,this._renderCount=null}get nodeType(){return this._nodeType}get nodeName(){return this._nodeName}get nodeValue(){return this._nodeValue}get ownerDocument(){return this._ownerDocument}get textContent(){return this._textContent}set textContent(e){if(this.nodeType!==i.NodeType.TEXT){const t=this.ownerDocument.createTextNode(e);this.appendChild(t)}else this._textContent=e}}i.NodeRef=r,i.NodeType=o;const a={};function l(e){return a[e]}function d(e){const t=l(e);return t&&t.listener?t.listener:null}function c(e,t){if(e._docId===t)return;const n=l(t);if(n){e._docId=t,n._nodeMap[e.ref]=e;for(let t=0,n=e.childNodes.length;t<n;t++)c(e.childNodes[t],e._docId)}}function h(e,t){return e._nodeMap[t]}function u(e,t){e.parentNode=t,t._docId&&(c(e,t._docId),e._depth=t._depth+1);for(let t=0,n=e.childNodes.length;t<n;t++)u(e.childNodes[t],e)}function p(e,t,n,r){n<0&&(n=0);const o=t[n-1],s=t[n];return t.splice(n,0,e),r&&(o&&(o.nextSibling=e||null),e.previousSibling=o||null,e.nextSibling=s||null,s&&(s.previousSibling=e||null)),n}function m(e,t,n){const r=t.indexOf(e);if(!(r<0)){if(n){const n=t[r-1],o=t[r+1];n&&(n.nextSibling=o||null),o&&(o.previousSibling=n||null),e.previousSibling=null,e.nextSibling=null}t.splice(r,1)}}function f(e,t,n,r){const o=t.indexOf(e);if(o<0||o===n)return-1;m(e,t,r);let s=n;return o<=n&&(s=n-1),p(e,t,s,r),n}function g(e){const t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()}function _(e){const t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}const b=/-(\w)/g,y=_(e=>e.replace(b,v));function v(e,t){return t?t.toUpperCase():""}const C=/([a-z\d])([A-Z])/g,w=_(e=>e.replace(C,"$1-$2").toLowerCase());const E=/^data.+/;function A(e,t){const n=[],r=Object.assign({},t);if(e)for(let t=0,o=e.length;t<o;t++){const o=e[t];r.hasOwnProperty(o.name)?(n.push({name:w(o.name),value:r[o.name],disabled:!1}),delete r[o.name]):o.disabled&&n.push({name:w(o.name),value:o.value,disabled:o.disabled})}for(const e in r)n.push({name:w(e),value:r[e],disabled:!1});return n}const F={};function x(e){"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)||(e=[e]),e.forEach(e=>{if(!e)return;e.name||(e.name=e.type,delete e.type),e.methods=e.methods||[],global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 注册组件---- ",JSON.stringify(e));let t=F[e.name];t?t.methods=Array.from(new Set(t.methods.concat(e.methods))):(t=F[e.name]=JSON.parse(JSON.stringify(e))).def={}})}function N(e){return F[e]}function T(e){const t=N(e.tagName.toLowerCase());if(t&&t.methods){const n=t.methods.filter(e=>"animate"!==e);return n.forEach(function(n){e[n]||(e[n]=function(...r){const o=d(e._docId);o?(o.invokeComponentMethod(t.name,e.ref,n,r),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 调用组件的方法：${t.name}.${n}()`,JSON.stringify(r))):console.warn(`### App Runtime ### 调用组件的方法无效：${t.name}.${n}(), 组件已销毁`)})}),n}return[]}function O(e){return e._attr}function S(e){return e._style}function R(e){return e.mergedStyle}function P(e,t){e._style=t||{}}function I(e){const t={};return e.split(";").filter(e=>e.trim()).forEach(e=>{const n=e.indexOf(":");let r=e.substring(0,n).trim();r=y(r);const o=e.substring(n+1).trim();t[r]=o}),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的样式转换：${e} 为${JSON.stringify(t)}`),t}function L(e,t=!0,n=!1,r=!1){if(e.nodeType===o.ELEMENT){const o={ref:e.ref.toString(),type:e._type},s=function(e){if(e._styleObjectId)return e._styleObjectId;let t=e;for(;t&&!t._styleObjectId;)t=t.parentNode;return t&&(e._styleObjectId=t._styleObjectId),e._styleObjectId}(e);s&&(o.prop={_styleObjectId:s}),n&&e._styleObject&&(o.styleObject=e._styleObject);const i=O(e);if(i&&Object.keys(i).length){o.attr={};for(const e in i){const t=i[e];o.attr[e]=-1!==[null,void 0].indexOf(t)?"":t}}const a=S(e);if(a&&Object.keys(a).length&&(o.inlineStyle=a),r){const t=R(e);t&&Object.keys(t).length&&(o.style=t)}const l=Object.keys(e._eventTargetListeners||{});l&&l.length&&(o.event=l);const d=e.layoutChildren||e.childNodes;if(t&&d&&d.length){const e=[];for(let o=0,s=d.length;o<s;o++){const s=d[o],i=L(s,t,n,r);k(s)?e.push(i):e.push.apply(e,i)}o.children=e}return o}if(e.nodeType===o.FIGMENT){const s=[];if(t&&e.layoutChildren&&e.layoutChildren.length)for(let i=0,a=e.layoutChildren.length;i<a;i++){const a=e.layoutChildren[i],l=L(a,t,n,r);a.nodeType===o.FIGMENT?s.push.apply(s,l):s.push(l)}return s}if(e.nodeType===o.COMMENT)return[];global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### getNodeAsJSON() 忽略该类型(${e.nodeType})的节点序列化`)}function D(e){return e._depth}function B(e){return e._layout}function k(e){return e._render}function $(e,t=!1){let n=t?e:e.parentNode;for(;n&&!k(n);)n=n.parentNode;return n}function j(e,t=!1){const n=[];let r=$(e,t);for(;r;)n.push(r),r=$(r);return n}function M(e){if(null!==e._renderCount)return e._renderCount;let t=k(e)?1:0;if(B(e)&&!k(e))for(let n=0,r=e.layoutChildren.length;n<r;n++)t+=M(e.layoutChildren[n]);return e._renderCount=t,t}function z(e){let t=e;for(;t;)t._renderCount=null,t=t.parentNode}function U(e){const t=e.parentNode;if(e.nodeType===o.DOCUMENT||e.ref===r.HTML_ID)return 0;if(!t||!B(e))return-1;const n=W(e,t);let s=0;return k(t)||(s=U(t)),n<0||s<0?-1:n+s}function W(e,t){if(!t.layoutChildren||t.layoutChildren.length<=0)return-1;const n=t.layoutChildren.indexOf(e);if(n>0){let e=0;for(let r=0,o=n;r<o;r++)e+=M(t.layoutChildren[r]);return e}return n}function G(e){switch(e.nodeType){case o.DOCUMENT:!function(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### 销毁文档"),delete e._nodeMap,delete e.listener,delete e._styleSheetHash,e.documentElement&&H(e.documentElement);delete e.documentElement,delete e.body,delete e.childNodes,delete e.layoutChildren,J(e),t=e._docId,a[t]=null;var t}(e);break;case o.ELEMENT:H(e);break;default:J(e)}}function J(e){delete e._depth,delete e._tmpRenderIndexInParent,delete e._eventTargetListeners,delete e._bindWatcherList,delete e._vm,function(e){if(delete e._docId,delete e._layout,delete e._render,delete e._renderCount,delete e.nextSibling,delete e.previousSibling,delete e.parentNode,e.childNodes)for(let t=e.childNodes.length-1;t>=0;t--)H(e.childNodes[t]);delete e.layoutChildren,delete e.childNodes,delete e._content,delete e._ownerDocument,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 销毁节点：节点(${e.ref})剩余属性有：[${Object.keys(e).join(", ")}]`)}(e)}function H(e){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 销毁元素：${JSON.stringify(L(e,!1,!1,!1))}`),delete e._classList,delete e._styleObject,delete e._styleObjectId,delete e._useParentStyle,delete e._usedCSSPropertyCache,delete e._matchedCssRuleCache,delete e._mergedStyleCache,delete e._ownCssRuleCache,delete e._attr,delete e._style,delete e._dataset,J(e)}var q={registerComponents:x,getComponentDefaultOptions:N,bindComponentMethods:T,getDocumentNodeByRef:h,getNodeAttributesAsObject:O,getNodeInlineStyleAsObject:S,getNodeAttrClassList:function(e){if(e._classList)return e._classList;const t=O(e);return e._classList=(t.class||"").split(/\s+/).filter(e=>""!==e).filter((e,t,n)=>n.indexOf(e)===t),e._classList},getNodeMergedStyleAsObject:R,setNodeInlineStyle:P,getNodeAsJSON:L,getNodeDepth:D,supportLayout:B,supportRender:k,renderParent:$,renderParents:j,calcRenderCount:M,resetRenderCount:z,renderIndexInRenderParent:U,renderIndexInParent:W,destroyTagNode:G,cssText2StyleObject:I};function Z(e,n,r){r instanceof Object||(r={capture:!!r});const o=n.type,s=e._eventTargetListeners[o],i=r.capture?t.CAPTURING_PHASE:t.BUBBLING_PHASE;if(s&&s[i]&&s[i].list){const t=s[i].list;for(let r=0,o=t.length;r<o;r++){const o=t[r];n._target=e,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### fireTargetEventListener() 事件响应:${n.type}，节点:${e.ref}`),o&&o.call(n.target,n)}}}class V extends i{constructor(){super(...arguments),this._eventTargetListeners={}}addEventListener(e,n,r){if(arguments.length<2)throw new Error(`### App Runtime ### addEventListener() 至少需要传递两个参数:${arguments.length}`);if("string"!=typeof e)throw new Error("### App Runtime ### addEventListener() 参数1必须是字符串，事件类型");if("function"!=typeof n)throw new Error("### App Runtime ### addEventListener() 参数2必须是函数，监听事件");global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### addEventListener() 节点(${this.ref})注册事件(${e})`),r instanceof Object||(r={capture:!!r,once:!1,passive:!1});const o=r.capture?t.CAPTURING_PHASE:t.BUBBLING_PHASE,s=this._eventTargetListeners[e]=this._eventTargetListeners[e]||{};if(s[o]=s[o]||{},s[o].list=s[o].list||[],s[o].hash=s[o].hash||{},-1===s[o].list.indexOf(n)){const e=s[o].list.push(n);s[o].hash[e-1]={capture:!!r.capture,once:!!r.once,passive:!!r.passive}}const i=d(this._docId);i&&i.addEvent(this.ref,e)}removeEventListener(e,n,r){if(arguments.length<2)throw new Error(`### App Runtime ### addEventListener() 至少需要传递两个参数:${arguments.length}`);if("string"!=typeof e)throw new Error("### App Runtime ### addEventListener() 参数1必须是字符串，事件类型");if("function"!=typeof n)throw new Error("### App Runtime ### addEventListener() 参数2必须是函数，监听事件");global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### Element ${this.ref} 执行 removeEventListener(${e})---- `),r instanceof Object||(r={capture:!!r});const o=r.capture?t.CAPTURING_PHASE:t.BUBBLING_PHASE,s=this._eventTargetListeners[e]=this._eventTargetListeners[e]||{};s[o]=s[o]||{},s[o].list=s[o].list||[],s[o].hash=s[o].hash||{};const i=s[o].list.indexOf(n);-1!==i&&(s[o].list.splice(i,1),s[o].hash[i]=null),0===s[o].list.length&&(s[o]=null)}dispatchEvent(e){if(!(e instanceof t))throw new Error("### App Runtime ### dispatchEvent() 参数1所属类必须是事件类");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 执行事件:${e.type}, 来自节点:${this.ref}`),!e._supportW3C)return Z(this,e);e._target=this;const n=e.type,r=j(this,!0),o=r.slice().reverse().concat(r);if(o[0]&&o[0].parentNode===o[0].ownerDocument){const e=o[0].ownerDocument;o.unshift(e),o.push(e)}for(;o.length>0;){const r=o[0],s=o.indexOf(r),i=o.indexOf(this);if(e._eventPhase=s<i?t.CAPTURING_PHASE:s===i?t.AT_TARGET:t.BUBBLING_PHASE,e._currentTarget=r,!e.bubbles&&e.eventPhase===t.BUBBLING_PHASE)break;global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 执行事件:${n}, 阶段:${e.eventPhase}, Target:${e.target.ref}, CurrentTarget:${e.currentTarget.ref}`);const a=r._eventTargetListeners[n];let l=e.eventPhase;if(e.target===e.currentTarget&&(l=r===o[1]?t.CAPTURING_PHASE:t.BUBBLING_PHASE),a&&a[l]&&a[l].list){const t=a[l].hash,n=a[l].list.slice();for(let o=0,s=n.length;o<s&&!e._flagStopImmediatePropagation;o++){const s=n[o];try{global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### dispatchEvent() 事件响应:${e.type}，阶段:${e.eventPhase}`),s&&s.call(e.currentTarget,e)}catch(t){console.error(`### App Runtime ### dispatchEvent() 事件响应:${e.type}，阶段:${e.eventPhase}, JS报错:`,t.message,s),console.error(t.stack),e._throwError&&global.setTimeout(()=>{throw t},0)}t[o]&&t[o].once&&r.removeEventListener(e.type,s,t[o])}}if(e._flagStopImmediatePropagation||e._flagStopPropagation)break;o.shift()}e._currentTarget=null}}function X(e){if(e.nodeType===i.NodeType.ELEMENT&&e._docId)for(let t=0,n=e.layoutChildren.length;t<n;t++)X(e.layoutChildren[t])}function K(e,t,n){if(t.nodeType===i.NodeType.DOCUMENT_FRAGMENT){const r=t.childNodes.slice();for(let o=0,s=r.length;o<s;o++)t.removeChild(r[o]),K(e,r[o],n);return t}const r=$(e,!0),o=n?e.childNodes.indexOf(n):e.childNodes.length,s=d(e._docId);if(t.nodeType===i.NodeType.TEXT)throw new Error(`### App Runtime ### 不支持在非渲染节点中添加文本节点：${t.textContent}`);if(t.parentNode){if(f(t,e.childNodes,o,!0),B(t))if(n){const o=f(t,e.layoutChildren,e.layoutChildren.indexOf(n));z(e);const i=U(t);if(s&&o>=0)return s.moveNode(t,r,i)}else{const n=f(t,e.layoutChildren,e.layoutChildren.length);z(e);const o=U(t);if(s&&n>=0)return s.moveNode(t,r,o)}}else if(u(t,e),p(t,e.childNodes,o,!0),X(t),B(t))if(n){p(t,e.layoutChildren,e.layoutChildren.indexOf(n)),z(e);const o=U(t);if(s)return s.addNode(t,r,o)}else{p(t,e.layoutChildren,e.layoutChildren.length),z(e);const n=e===r?-1:U(t);if(s)return s.addNode(t,r,n)}}class Q extends V{constructor(){super(...arguments),this._depth=null,this._tmpRenderIndexInParent=null}appendChild(e){if(!(e&&e instanceof i))throw new Error("### App Runtime ### appendChild() 函数的node参数无效");if(e.parentNode&&e.parentNode!==this)throw new Error("### App Runtime ### appendChild() 参数node的父节点不匹配");return K(this,e,null)}insertBefore(e,t){if(!(e&&2===arguments.length&&e instanceof i))throw new Error("### App Runtime ### insertBefore() 函数的node/before参数无效");if(e.parentNode&&e.parentNode!==this)throw new Error("### App Runtime ### insertBefore() 参数node的父节点不匹配");return e===t||e.nextSibling&&e.nextSibling===t?e:K(this,e,t)}removeChild(e){if(!(e&&e instanceof i))throw new Error("### App Runtime ### removeChild() node参数无效");if(e.parentNode!==this)throw new Error("### App Runtime ### removeChild() 参数node的父节点不匹配");if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### removeChild() 移除节点：${JSON.stringify(L(e,!1,!1,!1))}`),z(e),e.parentNode=null,B(e)){if(k(e)){const t=d(e._docId);t&&t.removeElement(e.ref)}else{const t=e.childNodes.slice();for(let n=0;n<t.length;n++)e.removeChild(t[n])}m(e,this.layoutChildren)}return m(e,this.childNodes,!0),function e(t,n){if(t._docId!==n)return;const r=l(n);if(r){for(let n=0,r=t.childNodes.length;n<r;n++)e(t.childNodes[n],t._docId);t._depth=null,r._nodeMap[t.ref]=null,t._docId=null}}(e,e._docId),e}toJSON(){return L(this,!0,!1,!1)}}class Y extends Q{constructor(e){super(...arguments),this._nodeType=i.NodeType.COMMENT,this._nodeName="#comment",this._nodeValue=e,this._layout=!0,this._render=!1,this._data=e}get data(){return this._data}set data(e){const t=""+e;return this._nodeValue=t,this._data=t,this._data}appendChild(e){throw new Error("### App Runtime ### appendChild() 注释节点不支持插入子节点")}insertBefore(e,t){throw new Error("### App Runtime ### insertBefore() 注释节点不支持插入子节点")}toString(){return"\x3c!-- "+this._data+" --\x3e"}}function ee(e,t,n,r){if(!e._ownerDocument||"ref"===t)return;if((null===(o=n)||"object"!=typeof o)&&O(e)[t]===n&&!1!==r)return;var o;if("class"===t)e._classList=null;else if(E.test(t)){const r=t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()).replace(/^data-/,"").replace(/-([a-z])/g,(e,t)=>t.toUpperCase());e._dataset[r]=n}const s=O(e)[t];O(e)[t]=n,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的属性(${t})更新(${s}=>${n})`),ne(e,r,t,n)}function te(e,t,n){if(!e._ownerDocument)return;if(t=t||"",S(e)===t&&!1!==n)return;P(e,"string"==typeof t?I(t):t),ne(e,n,"style")}function ne(e,t,n,r,o){const s=d(e._docId);s&&("class"===n?!t&&s.setStyles(e.ref,null,{class:r}):"id"===n?!t&&s.setStyles(e.ref,null,{id:r}):"style"===n?o?!t&&s.setStyle(e.ref,...o):!t&&s.setStyles(e.ref,S(e)):!t&&s.setAttr(e.ref,n,r))}class re extends Q{constructor(e){super(...arguments),this._nodeType=i.NodeType.ELEMENT,this._nodeName=e.toUpperCase(),this._tagName=e.toUpperCase(),this._type=e,this._attr={},this._style={},this._dataset={},this._layout=!0,this._render=!0,this._classList=null,this._styleObject=null,this._styleObjectId=null,this._useParentStyle=null,this._usedCSSPropertyCache={},this._matchedCssRuleCache={},this._mergedStyleCache=null,this._ownCssRuleCache={}}get style(){return this._style}get type(){return console.warn("### App Runtime ### type属性将被废弃，不推荐使用"),this._type}get id(){console.warn("### App Runtime ### id属性将被废弃，不推荐使用");const e=O(this);return e&&e.id}get dataset(){return this._dataset}get attr(){return console.warn("### App Runtime ### attr属性将被废弃，不推荐使用"),O(this)}get tagName(){return this._tagName}get mergedStyle(){return null}appendChild(e){return e.nodeType===i.NodeType.TEXT?(ee(this,"value",e.textContent),u(e,this),e):super.appendChild(e)}insertBefore(e,t){return e.nodeType===i.NodeType.TEXT?(ee(this,"value",e.textContent),u(e,this),e):super.insertBefore(e,t)}hasAttribute(e){const t=O(this);return t&&t.hasOwnProperty(e)}toString(){const e=O(this),t=S(this);return"<"+this._type+" attr="+JSON.stringify(e)+" style="+JSON.stringify(t)+">"+this.layoutChildren.map(e=>e.toString()).join("")+"</"+this._type+">"}}class oe extends Q{constructor(){super(...arguments),this._nodeType=i.NodeType.DOCUMENT_FRAGMENT,this._nodeName="#document-fragment",this._layout=!0,this._render=!1}}class se extends Q{constructor(){super(...arguments),this._nodeType=i.NodeType.FIGMENT,this._nodeName="#figment",this._layout=!0,this._render=!1}toString(){let e="";return this.childNodes.length&&(e=this.childNodes.map(e=>e.toString()).join("")),e}}class ie extends Q{constructor(e){super(...arguments),this._nodeType=i.NodeType.TEXT,this._nodeName="#text",this._textContent=e,this._wholeText=e,this._layout=!1,this._render=!1}get wholeText(){return this._wholeText}appendChild(e){throw new Error("### App Runtime ### appendChild() 文本节点不支持插入子节点")}insertBefore(e,t){throw new Error("### App Runtime ### insertBefore() 文本节点不支持插入子节点")}}class ae extends re{constructor(){super(...arguments),this.ref=i.NodeRef.HTML_ID,this._depth=0}appendChild(e){return function(e,t,n){if(e.layoutChildren.length>0||t.parentNode)return void console.warn("### App Runtime ### Document添加多个Body节点----");const r=l(e._docId),o=e.childNodes,s=o.indexOf(n);s<0?o.push(t):o.splice(s,0,t),B(t)?(c(t,t._docId),u(t,e),p(t,e.layoutChildren,e.layoutChildren.length),z(e),X(t),r.body=t,d(e._docId).createBody(t)):u(t,e)}(this,e)}insertBefore(e,t){console.warn("### App Runtime ### 暂不支持nodeHtml.insertBefore()")}}class le extends re{get value(){return this._attr&&this._attr.value}set value(e){this._attr&&(this._attr.value=e)}get checked(){return this._attr&&this._attr.checked}set checked(e){this._attr&&(this._attr.checked=e)}}const de=/^(touchstart|touchmove|touchcancel|touchend)$/,ce=/^(touchstart|touchmove|touchcancel|touchend|click|longpress)$/;function he(e,r){let o;return de.test(e)?(o=new n(e,r))._supportW3C=!1:(o=new t(e,r))._supportW3C=!1,ce.test(e)&&global.isRpkMinPlatformVersionGEQ(1040)&&(o._supportW3C=!0,o._bubbles=!0),o}function ue(e){const t=new ae("html");return t._ownerDocument=e,c(t,e._docId),t.parentNode=e,e.childNodes.push(t),e.layoutChildren.push(t),t}class pe extends Q{constructor(e,t){var n,r;super(...arguments),this._nodeType=i.NodeType.DOCUMENT,this._nodeName="#document",this.body=null,e=e?e.toString():"",this._docId=e,this._nodeMap={},this.listener=t,this._styleSheetHash={},this._styleSheetHash[0]=[],n=this._docId,r=this,n&&(a[n]=r),Object.defineProperty(this,"documentElement",{configurable:!0,enumerable:!1,writable:!1,value:ue(this)})}createElement(e){let t;return(t="input"===e||"textarea"===e?new le(e):new re(e))._ownerDocument=this,t}createDocumentFragment(){const e=new oe;return e._ownerDocument=this,e}createTextNode(e){const t=new ie(e);return t._ownerDocument=this,t}createComment(e){const t=new Y(e);return t._ownerDocument=this,t}createEvent(e,t){return he(e,t)}}function me(){Object.freeze(t),Object.freeze(t.prototype),Object.freeze(Y),Object.freeze(Y.prototype),Object.freeze(pe),Object.freeze(pe.prototype),Object.freeze(re),Object.freeze(re.prototype),Object.freeze(se),Object.freeze(se.prototype),Object.freeze(oe),Object.freeze(oe.prototype),Object.freeze(ae),Object.freeze(ae.prototype),Object.freeze(i),Object.freeze(i.prototype),Object.freeze(Q),Object.freeze(Q.prototype),Object.freeze(V),Object.freeze(V.prototype),Object.freeze(ie),Object.freeze(ie.prototype)}function fe(e,t=[]){return{module:"dom",method:e,args:t}}class ge{constructor(e,t){this.id=e,this.streamer=t,this.actionLen=0}createFinish(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### createFinish---- ");const t=this.streamer.over(this.id,[fe("createFinish")],e);return this.resetActionLen(),t}updateFinish(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### updateFinish---- ");const t=this.streamer.over(this.id,[fe("updateFinish")],e);return this.resetActionLen(),t}createBody(e){const t=L(e,!0,!0,!1),n=t.children;delete t.children;const r=[fe("createBody",[t])];return n&&r.push.apply(r,n.map(e=>fe("addElement",[t.ref,e,-1]))),this.addActions(r)}addNode(e,t,n){let r;if(t&&k(t)||console.error(`### App Runtime ### addNode的parent(${t.type})必须是可渲染节点`),n<0&&(n=-1),k(e))r=this.addElement(e,t.ref,n);else{let o=n;e.layoutChildren.every(e=>(r=k(e)?this.addElement(e,t.ref,o):this.addNode(e,t,o),o+=M(e),-1!==r))}return r}addElement(e,t,n){return n>=0||(n=-1),this.addActions(fe("addElement",[t,L(e,!0,!0,!1),n]))}removeNode(e){let t;return k(e)?t=this.removeElement(e.ref):e.layoutChildren.every(e=>-1!==(t=k(e)?this.removeElement(e.ref):this.removeNode(e))),t}removeElement(e){if(Array.isArray(e)){const t=e.map(e=>fe("removeElement",[e]));return this.addActions(t)}return this.addActions(fe("removeElement",[e]))}moveNode(e,t,n){let r;if(t&&k(t)||console.error("### App Runtime ### moveNode的parent必须是可渲染节点"),n>=0||(n=-1),k(e))r=this.moveElement(e.ref,t.ref,n);else{let o=n;e.layoutChildren.every(e=>(r=k(e)?this.moveElement(e.ref,t.ref,o):this.moveNode(e,t,o),o+=M(e),-1!==r))}return r}moveElement(e,t,n){return this.addActions(fe("moveElement",[e,t,n]))}setProp(e,t,n){const r={prop:{}};return r.prop[t]=n,this.addActions(fe("updateProps",[e,r]))}setAttr(e,t,n){const r={attr:{}};return null==n?(console.warn(`### App Runtime ### 组件 ${e} 的属性 ${t} 被修改为 undefined/null, 自动修改为默认值或空值`),r.attr[t]=""):r.attr[t]=n,this.addActions(fe("updateAttrs",[e,r]))}setStyle(e,t,n){const r={style:{}};return null==n?(console.warn(`### App Runtime ### 组件 ${e} 的样式 ${t} 被修改为 undefined/null, 自动修改为默认值或空值`),r.style[t]=""):r.style[t]=n,this.addActions(fe("updateStyle",[e,r]))}setStyles(e,t,n){const r={attr:n};return t&&(r.style=t),this.addActions(fe("updateStyles",[e,r]))}setStyleObject(e,t,n,r,o){return this.addActions(fe("updateStyleObject",[e,t,n,r,o]))}addEvent(e,t){return this.addActions(fe("addEvent",[e,t]))}removeEvent(e,t){return this.addActions(fe("removeEvent",[e,t]))}updatePageTitleBar(e){return this.addActions(fe("updateTitleBar",[e]))}exitFullscreen(){return this.addActions(fe("exitFullscreen",[]))}invokeComponentMethod(e,t,n,r){return this.addActions({component:e,ref:t,method:n,args:r})}addActions(e){Array.isArray(e)||(e=[e]),global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Runtime ### addActions---- ",JSON.stringify(e)),this.actionLen+=e.length,this.streamer.push(this.id,e)}hasActions(){return!!this.actionLen}resetActionLen(){this.actionLen=0}}class _e{constructor(e,t){this.call=e,this.batchThreshold=void 0===t?50:t,this._boolDefineNextTick=!0,this.list=[]}push(e,t){let n;if(0===this.batchThreshold)this.list.push.apply(this.list,t);else if(1===this.batchThreshold)this.list.push.apply(this.list,t),n=this.call(e,this.list),this.list.splice(0);else{if(!(this.batchThreshold>1))throw new Error(`### App Runtime ### push() 不支持的batchThreshold值：${this.batchThreshold}`);for(this.list.push.apply(this.list,t);this.list.length>=this.batchThreshold;){const t=this.list.splice(0,this.batchThreshold);n=this.call(e,t)}}return this._boolDefineNextTick&&this._defineNextTick(e),n}over(e,t){return this.list.length&&(this.call(e,this.list),this.list.splice(0)),this.call(e,t)}_defineNextTick(e){this._nextTick||(this._nextTick=Promise.resolve().then(()=>{this.list.length&&console.warn(`### App Runtime ### _defineNextTick(${e}) 应该由框架保证及时发送`),this._nextTick=null}))}}const be=function(e,t,...n){return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Bridge ### sendActions() 发送消息：${e},${t.length},${JSON.stringify(t)}`),t=JSON.stringify(t,function(e,t){return t&&t.constructor===RegExp?{type:g(t),source:t.source,flags:t.flags}:t}),global.callNative(e,t,...n)};const ye=[{newN:"t",oldN:"type",newV:["d","a","t","u","p","pe"],oldV:["descendant","attribute","tag","universal","pseudo","pseudo-element"]},{newN:"n",oldN:"name"},{newN:"i",oldN:"ignoreCase"},{newN:"a",oldN:"action"},{newN:"v",oldN:"value"}];let ve=1;var Ce={registerComponents:x,getComponentDefaultOptions:N,bindComponentMethods:T,createDocument:function(e){const t=new _e(be),n=new ge(e,t);return new pe(e,n)},registerStyleObject:function(e,t,n,r){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 基于节点(${r&&r.ref})注册样式节点(${n})`),!r._ownerDocument)return;!function(e){for(const t in e){const n=e[t];if(n&&n._meta&&n._meta.ruleDef){const e=n._meta.ruleDef;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let e=0,t=ye.length;e<t;e++){const t=ye[e];n.hasOwnProperty(t.newN)&&(n[t.oldN]=n[t.newN],delete n[t.newN],t.newV&&t.newV.indexOf(n[t.oldN])>-1&&(n[t.oldN]=t.oldV[t.newV.indexOf(n[t.oldN])]))}}}}}(t);const o=ve++;n||(r._styleObject=t,r._styleObjectId=o);const s=d(r._docId);s&&s.setStyleObject(r.ref,n,e,o,t)},createEvent:he,createFigment:function(e){const t=new se;return t._ownerDocument=e,t},updatePageTitleBar:function(e,t){const n=d(e._docId);n&&n.updatePageTitleBar(t)},exitFullscreen:function(e){const t=d(e._docId);t&&t.exitFullscreen()},setElementProp:function(e,t,n,r){if(!e._ownerDocument||"ref"===t)return;if(e[t]===n&&!1!==r)return;const o=e[t];e[t]=n,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 元素的内部属性(${t})更新(${o}=>${n})`);const s=d(e._docId);s&&s.setProp(e.ref,t,n)},setElementAttr:ee,setElementStyle:function(e,t,n,r){e._ownerDocument&&(S(e)[t]===n&&!1!==r||(S(e)[t]=n,ne(e,r,"style",null,[t,n])))},setElementStyles:te,getElementMatchedCssRuleList:function(e,t){const n=S(e),r=[{editable:!0,styleSheetName:null,style:A(e._inlineStyleFullList,n)}],o=JSON.parse(JSON.stringify(r));return console.warn(`### App Runtime ### 获取样式:该平台版本仅支持获取节点${e.ref}的内联样式`),o},setElementMatchedCssRule:function(e,t,n){const r={},o=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];o.push({name:t.name,value:t.value,disabled:t.disabled}),t.disabled||(r[t.name]=t.value)}"INLINE"===t?(te(e,r),e._inlineStyleFullList=o,global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Runtime ### 更新样式:元素(${e.ref})的内联样式：${t}:${JSON.stringify(r)}`)):console.warn(`### App Runtime ### 更新样式:该平台版本仅支持更新内联样式，不支持：${t}`)},resetNodeChildren:function(e){for(let t=0,n=e.layoutChildren.length;t<n;t++){const n=e.layoutChildren[t];n._tmpRenderIndexInParent=W(n,e)}e.childNodes.length=0,e.layoutChildren.length=0},restoreNodeChildren:function(e,t){if(!t.parentNode||t.parentNode!==e)return;e.childNodes.push(t),e.layoutChildren.push(t);const n=$(e,!0);if(B(t)){const r=d(e._docId),o=U(t),s=o!==t._tmpRenderIndexInParent;if(t._tmpRenderIndexInParent=null,r&&s)return r.moveNode(t,n,o)}},fireTargetEventListener:Z,clearTargetEventListener:function(e,n,r){r instanceof Object||(r={capture:!!r});const o=r.capture?t.CAPTURING_PHASE:t.BUBBLING_PHASE;e._eventTargetListeners[n]&&delete e._eventTargetListeners[n][o]},getDocumentNodeByRef:h,isNodeInDocument:function(e){return!(!e||!e._docId)},recreateDocument:function(e){const t=e.body;t?e.listener.createBody(t):console.error("### App Runtime ### Document没有body节点, 无法重建")},destroyTagNode:G,getNodeAsJSON:L,getNodeDepth:D};var we={init:function(){me()},Node:i,Event:t,TouchEvent:n,helper:Ce,exposure:{registerComponents:x}};const Ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var Ae={arrayBufferToBase64:function(e){const t=new Uint8Array(256);for(let e=0;e<Ee.length;e++)t[Ee.charCodeAt(e)]=e;const n=new Uint8Array(e),r=n.length;let o="";for(let e=0;e<r;e+=3)o+=Ee[n[e]>>2],o+=Ee[(3&n[e])<<4|n[e+1]>>4],o+=Ee[(15&n[e+1])<<2|n[e+2]>>6],o+=Ee[63&n[e+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},base64ToArrayBuffer:function(e){const t=new Uint8Array(256);for(let e=0;e<Ee.length;e++)t[Ee.charCodeAt(e)]=e;let n=.75*e.length;const r=e.length;let o,s,i,a,l,d=0;"="===e[e.length-1]&&(n--,"="===e[e.length-2]&&n--);const c=new ArrayBuffer(n),h=new Uint8Array(c);for(o=0;o<r;o+=4)s=t[e.charCodeAt(o)],i=t[e.charCodeAt(o+1)],a=t[e.charCodeAt(o+2)],l=t[e.charCodeAt(o+3)],h[d++]=s<<2|i>>4,h[d++]=(15&i)<<4|a>>2,h[d++]=(3&a)<<6|63&l;return c},btoa:function(e){const t=String(e);let n=Ee,r=0,o="";for(let e,s,i=.75;!isNaN(e=t.charCodeAt(i))||63&r||(n="=",(i-.75)%1);i+=.75)if(e>127){(s=encodeURI(t.charAt(i)).split("%")).shift();for(let e,t=i%1;s[0|t];t+=.75)e=s[0|t],r=r<<8|parseInt(e,16),o+=n.charAt(63&r>>8-t%1*8);i=.75===i?0:i,i+=.75*s.length%1}else r=r<<8|e,o+=n.charAt(63&r>>8-i%1*8);return o}};let Fe=0;let xe=1;const Ne=function(){};class Te{constructor(){this._id=xe++,this._width=0,this._height=0,this._src=void 0,this._onload=Ne,this._onerror=Ne,this.complete=!1}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get src(){return this._src}set src(e){e.startsWith("//")&&(e="http:"+e),this._src=e,Te.channel.preloadImage([this._src,this._id],e=>{let t={};"string"==typeof e&&(e=JSON.parse(e)),e.error?(t={type:"error",target:this},this.onerror(t)):(this.complete=!0,this.width="number"==typeof e.width?e.width:0,this.height="number"==typeof e.height?e.height:0,t={type:"load",target:this},this.onload(t))})}addEventListener(e,t){"load"===e?this.onload=t:"error"===e&&(this.onerror=t)}removeEventListener(e,t){"load"===e?this.onload=Ne:"error"===e&&(this.onerror=Ne)}get onload(){return this._onload}set onload(e){this._onload=e}get onerror(){return this._onerror}set onerror(e){this._onerror=e}}class Oe{constructor(e,t){this._style=t,this._img=e}}class Se{constructor(){arguments&&4===arguments.length?(this._start_pos={_x:arguments[0],_y:arguments[1]},this._end_pos={_x:arguments[2],_y:arguments[3]},this._type="linear"):arguments&&6===arguments.length&&(this._start_pos={_x:arguments[0],_y:arguments[1],_r:arguments[2]},this._end_pos={_x:arguments[3],_y:arguments[4],_r:arguments[5]},this._type="radial"),this._stop_count=0,this._stops=[0,0,0,0,0]}addColorStop(e,t){this._stop_count<5&&e>=0&&e<=1&&(this._stops[this._stop_count]={_pos:e,_color:t},this._stop_count++)}}class Re{constructor(e){this.className="CanvasRenderingContext2D",this._drawCommands="",this._globalAlpha=1,this._fillStyle="rgb(0,0,0)",this._strokeStyle="rgb(0,0,0)",this._lineWidth=1,this._lineDashOffset=0,this._lineDash=[],this._lineCap="butt",this._lineJoin="miter",this._miterLimit=10,this._globalCompositeOperation="source-over",this._textAlign="start",this._textBaseline="alphabetic",this._font="10px sans-serif",this._savedGlobalAlpha=[],this.timer=null,this.componentId=e.ref,this.canvas=e,this.schedule=!1}set fillStyle(e){this._fillStyle=e;let t="";if("string"==typeof e)this._drawCommands=this._drawCommands.concat("F"+e+";");else if(e instanceof Oe){const t=e._img;Re.channel.bindImageTexture(this.canvas,t),this._drawCommands=this._drawCommands.concat("G"+t._id+","+e._style+";")}else if("linear"===e._type){t="D"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}else if("radial"===e._type){t="H"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._start_pos._r.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._end_pos._r.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}this.usePromise()}get fillStyle(){return this._fillStyle}get globalAlpha(){return this._globalAlpha}set globalAlpha(e){this._globalAlpha=e,this._drawCommands=this._drawCommands.concat("a"+e.toFixed(2)+";"),this.usePromise()}get strokeStyle(){return this._strokeStyle}set strokeStyle(e){this._strokeStyle=e;let t="";if("string"==typeof e)this._drawCommands=this._drawCommands.concat("S"+e+";");else if(e instanceof Oe){const t=e._img;Re.channel.bindImageTexture(this.canvas,t),this._drawCommands=this._drawCommands.concat("Q"+t._id+","+e._style+";")}else if("linear"===e._type){t="N"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}else if("radial"===e._type){t="O"+e._start_pos._x.toFixed(2)+","+e._start_pos._y.toFixed(2)+","+e._start_pos._r.toFixed(2)+","+e._end_pos._x.toFixed(2)+","+e._end_pos._y.toFixed(2)+","+e._end_pos._r.toFixed(2)+","+e._stop_count;for(let n=0;n<e._stop_count;++n)t+=","+e._stops[n]._pos+","+e._stops[n]._color;this._drawCommands=this._drawCommands.concat(t+";")}this.usePromise()}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._drawCommands=this._drawCommands.concat("W"+e+";"),this.usePromise()}get lineCap(){return this._lineCap}set lineCap(e){this._lineCap=e,this._drawCommands=this._drawCommands.concat("C"+e+";"),this.usePromise()}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin=e,this._drawCommands=this._drawCommands.concat("J"+e+";"),this.usePromise()}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit=e,this._drawCommands=this._drawCommands.concat("M"+e+";"),this.usePromise()}get globalCompositeOperation(){return this._globalCompositeOperation}set globalCompositeOperation(e){this._globalCompositeOperation=e;let t=0;switch(e){case"source-over":t=0;break;case"source-atop":t=1;break;case"source-in":t=2;break;case"source-out":t=3;break;case"destination-over":t=4;break;case"destination-atop":t=5;break;case"destination-in":t=6;break;case"destination-out":t=7;break;case"lighter":t=8;break;case"copy":t=9;break;case"xor":t=10;break;default:t=0}this._drawCommands=this._drawCommands.concat("B"+t+";"),this.usePromise()}get textAlign(){return this._textAlign}set textAlign(e){this._textAlign=e;let t=0;switch(e){case"start":t=0;break;case"end":t=1;break;case"left":t=2;break;case"center":t=3;break;case"right":t=4;break;default:t=0}this._drawCommands=this._drawCommands.concat("A"+t+";"),this.usePromise()}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline=e;let t=0;switch(e){case"alphabetic":t=0;break;case"middle":t=1;break;case"top":t=2;break;case"hanging":t=3;break;case"bottom":t=4;break;case"ideographic":t=5;break;default:t=0}this._drawCommands=this._drawCommands.concat("E"+t+";"),this.usePromise()}get font(){return this._font}set font(e){this._font=e,this._drawCommands=this._drawCommands.concat("j"+e+";"),this.usePromise()}setTransform(e,t,n,r,o,s){this._drawCommands=this._drawCommands.concat("t"+(1===e?"1":e.toFixed(2))+","+(0===t?"0":t.toFixed(2))+","+(0===n?"0":n.toFixed(2))+","+(1===r?"1":r.toFixed(2))+","+o.toFixed(2)+","+s.toFixed(2)+";"),this.usePromise()}transform(e,t,n,r,o,s){this._drawCommands=this._drawCommands.concat("f"+(1===e?"1":e.toFixed(2))+","+(0===t?"0":t.toFixed(2))+","+(0===n?"0":n.toFixed(2))+","+(1===r?"1":r.toFixed(2))+","+o+","+s+";"),this.usePromise()}resetTransform(){this._drawCommands=this._drawCommands.concat("m;"),this.usePromise()}scale(e,t){this._drawCommands=this._drawCommands.concat("k"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}rotate(e){this._drawCommands=this._drawCommands.concat("r"+e.toFixed(6)+";"),this.usePromise()}translate(e,t){this._drawCommands=this._drawCommands.concat("l"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}save(){this._savedGlobalAlpha.push(this._globalAlpha),this._drawCommands=this._drawCommands.concat("v;"),this.usePromise()}restore(){this._drawCommands=this._drawCommands.concat("e;"),this._globalAlpha=this._savedGlobalAlpha.pop(),this.usePromise()}createPattern(e,t){return new Oe(e,t)}createLinearGradient(e,t,n,r){return new Se(e,t,n,r)}createRadialGradient(e,t,n,r,o,s){return new Se(e,t,n,r,o,s)}strokeRect(e,t,n,r){this._drawCommands=this._drawCommands.concat("s"+e+","+t+","+n+","+r+";"),this.usePromise()}clearRect(e,t,n,r){this._drawCommands=this._drawCommands.concat("c"+e+","+t+","+n+","+r+";"),this.usePromise()}clip(){this._drawCommands=this._drawCommands.concat("p;"),this.usePromise()}resetClip(){this._drawCommands=this._drawCommands.concat("q;"),this.usePromise()}closePath(){this._drawCommands=this._drawCommands.concat("o;"),this.usePromise()}moveTo(e,t){this._drawCommands=this._drawCommands.concat("g"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}lineTo(e,t){this._drawCommands=this._drawCommands.concat("i"+e.toFixed(2)+","+t.toFixed(2)+";"),this.usePromise()}getLineDash(){return this._lineDash}setLineDash(e){if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++){if("number"!=typeof e[t]||e[t]<0)return void console.warn("### App Canvas ### setLineDash 的参数必须为数组，且数组元素为数字类型，元素值不小于0");if(isNaN(e[t]))return void console.warn("### App Canvas ### setLineDash 的参数必须为数组且元素值不能为 NaN")}e.length%2==1&&e.push(...e),this._lineDash=e,this._drawCommands=this._drawCommands.concat("I"+e+";"),this.usePromise()}else console.warn("### App Canvas ### setLineDash 的参数必须为数组")}get lineDashOffset(){return this._lineDashOffset}set lineDashOffset(e){"number"==typeof e?isNaN(e)?console.warn("### App Canvas ### lineDashOffset 值不能为 NaN"):(this._lineDashOffset=e,this._drawCommands=this._drawCommands.concat("V"+e+";"),this.usePromise()):console.warn("### App Canvas ### lineDashOffset 值必须为数字类型")}quadraticCurveTo(e,t,n,r){this._drawCommands=this._drawCommands.concat("u"+e+","+t+","+n+","+r+";"),this.usePromise()}bezierCurveTo(e,t,n,r,o,s){this._drawCommands=this._drawCommands.concat("z"+e.toFixed(2)+","+t.toFixed(2)+","+n.toFixed(2)+","+r.toFixed(2)+","+o.toFixed(2)+","+s.toFixed(2)+";"),this.usePromise()}arcTo(e,t,n,r,o){this._drawCommands=this._drawCommands.concat("h"+e+","+t+","+n+","+r+","+o+";"),this.usePromise()}beginPath(){this._drawCommands=this._drawCommands.concat("b;")}fillRect(e,t,n,r){this._drawCommands=this._drawCommands.concat("n"+e+","+t+","+n+","+r+";"),this.usePromise()}rect(e,t,n,r){this._drawCommands=this._drawCommands.concat("w"+e+","+t+","+n+","+r+";"),this.usePromise()}fill(){this._drawCommands=this._drawCommands.concat("L;"),this.usePromise()}stroke(){this._drawCommands=this._drawCommands.concat("x;"),this.usePromise()}arc(e,t,n,r,o,s){let i=0;s&&(i=1),this._drawCommands=this._drawCommands.concat("y"+e.toFixed(2)+","+t.toFixed(2)+","+n.toFixed(2)+","+r+","+o+","+i+";"),this.usePromise()}fillText(e,t,n){this._drawCommands=this._drawCommands.concat("T"+Ae.btoa(e)+","+t+","+n+",0.0;"),this.usePromise()}strokeText(e,t,n){this._drawCommands=this._drawCommands.concat("U"+Ae.btoa(e)+","+t+","+n+",0.0;"),this.usePromise()}measureText(e){this._drawCommands=this._drawCommands.concat("K"+e+";");const t=parseFloat(Re.channel.renderBufferSync(this.componentId,this._drawCommands));return this._drawCommands="",{width:t}}isPointInPath(e,t){throw new Error("Canvas not supported yet")}drawImage(e,t,n,r,o,s,i,a,l){const d=arguments.length;"image"===e.type&&(e={src:e.attr.src}),Re.channel.bindImageTexture(this.canvas,e),this._drawCommands+=function(e){if(3===d){const r=parseFloat(t)||0,o=parseFloat(n)||0;return"d"+e._id+",0,0,"+e.width+","+e.height+","+r+","+o+","+e.width+","+e.height+";"}if(5===d){const s=parseFloat(t)||0,i=parseFloat(n)||0,a=parseInt(r)||e.width,l=parseInt(o)||e.height;return"d"+e._id+",0,0,"+e.width+","+e.height+","+s+","+i+","+a+","+l+";"}if(9===d)return t=parseFloat(t)||0,n=parseFloat(n)||0,r=parseInt(r)||e.width,o=parseInt(o)||e.height,s=parseFloat(s)||0,i=parseFloat(i)||0,a=parseInt(a)||e.width,l=parseInt(l)||e.height,"d"+e._id+","+t+","+n+","+r+","+o+","+s+","+i+","+a+","+l+";"}(e),this.usePromise()}getImageData(e,t,n,r){this._drawCommands=this._drawCommands.concat("R"+e+","+t+","+n+","+r+";");const o=Re.channel.renderBufferSync(this.componentId,this._drawCommands);this._drawCommands="";const s=Ae.base64ToArrayBuffer(o);return{data:new Uint8ClampedArray(s),width:n,height:r}}createImageData(e,t){let n;return 1===arguments.length&&(e=(n=e).width,t=n.height),(e<=0||t<=0)&&(e=0,t=0),{width:e,height:t,data:new Uint8ClampedArray(e*t*4)}}putImageData(e,t,n,r=0,o=0,s,i){const a=arguments.length,l=e.width,d=e.height,c=e.data;if(c.length!==d*l*4)throw new Error("illegal ImageData");if(3===a)this._drawCommands=this._drawCommands.concat("P"+t+","+n+","+l+","+d+","+l+","+d+";"+Ae.arrayBufferToBase64(c)+";");else if(7===a){const e={left:r<0?0:r,top:o<0?0:o};e.right=Math.min(Math.max(r+s,e.left),l),e.bottom=Math.min(Math.max(o+i,e.top),d),r=e.left,o=e.top,s=e.right-e.left,i=e.bottom-e.top;const t=new Uint8ClampedArray(s*i*4);let n,a=0;for(let i=o;i<e.bottom;i++){n=4*(l*i+r);for(let e=0;e<s;e++)t[a]=c[n],t[a+1]=c[n+1],t[a+2]=c[n+2],t[a+3]=c[n+3],a+=4,n+=4}this._drawCommands=this._drawCommands.concat("P"+r+","+o+","+s+","+i+","+s+","+i+";"+Ae.arrayBufferToBase64(t)+";")}this.usePromise()}usePromise(){const e=this;e.schedule||(Promise.resolve().then(()=>{Re.channel.render2d(e.componentId,e._drawCommands),e._drawCommands="",e.schedule=!1}),e.schedule=!0)}}const Pe=function(){let e=null;const t={},n=536870913,r=536870912;return{getModule:t=>e,setModule(n,r){const o="__native_module__"+n;t[o]||(t[o]=r,e=r)},callEnable:(t,n)=>e.enable({componentId:t,config:n}),callSetContextType(t,n){e.setContextType({componentId:t,contextType:n})},renderBufferSync:function(e,t){return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas syncDrawBuffer ### ${t} `),global.extendCallNative(e,r,t)},render2d:function(e,t){t&&(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas render2d ### ${t} `),global.extendCallNative(e,n,t))},bindImageTexture(t,n={}){if(global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas bindImageTexture url ### ${n.src} `),!n._id){let e=new Te;n._id=e._id,e=null}const r=n._id+"_"+n.src;if(-1!==t._bindTexture.indexOf(r))return;let o=e.bindImageTexture({componentId:t.ref,src:n.src,imageId:n._id});"string"==typeof o&&(o=JSON.parse(o)),o&&o.height&&o.width&&(n.height=o.height,n.width=o.width,t._bindTexture.push(r))},preloadImage([t,n],r){global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Canvas preloadImage url ### ${t} `),e.preloadImage({url:t,id:n,success:function(e){e.url=t,e.id=n,r&&r(e)}})}}}();var Ie={enable:function(e,t,{module:n}={}){e._bindTexture=[],Pe.setModule(t.id,n),Te.channel=Re.channel=Pe,Pe.callEnable(e.ref,[0,-1,!1,!1,1,"white",!1]),global.Image=Te;const r={};e.getContext=function(e){let t=null;if(!e.match(/2d/i))throw new Error("### App Canvas ### not supported context "+e);return r[this.ref]||(r[this.ref]=new Re(this)),t=r[this.ref],Pe.callSetContextType(this.ref,0),t};const o=e.toTempFilePath;return e.toTempFilePath=((...t)=>{const n=e.getContext("2d");Re.channel.render2d(n.componentId,n._drawCommands),n._drawCommands="",o(...t)}),e}};const Le=new Map([["forall","∀"],["part","∂"],["exists","∃"],["empty","∅"],["nabla","∇"],["isin","∈"],["notin","∉"],["ni","∋"],["prod","∏"],["sum","∑"],["minus","−"],["lowast","∗"],["radic","√"],["prop","∝"],["infin","∞"],["ang","∠"],["and","∧"],["or","∨"],["cap","∩"],["cup","∪"],["int","∫"],["there4","∴"],["sim","∼"],["cong","≅"],["asymp","≈"],["ne","≠"],["le","≤"],["ge","≥"],["sub","⊂"],["sup","⊃"],["nsub","⊄"],["sube","⊆"],["supe","⊇"],["oplus","⊕"],["otimes","⊗"],["perp","⊥"],["sdot","⋅"],["Alpha","Α"],["Beta","Β"],["Gamma","Γ"],["Delta","Δ"],["Epsilon","Ε"],["Zeta","Ζ"],["Eta","Η"],["Theta","Θ"],["Iota","Ι"],["Kappa","Κ"],["Lambda","Λ"],["Mu","Μ"],["Nu","Ν"],["Xi","Ν"],["Omicron","Ο"],["Pi","Π"],["Rho","Ρ"],["Sigma","Σ"],["Tau","Τ"],["Upsilon","Υ"],["Phi","Φ"],["Chi","Χ"],["Psi","Ψ"],["Omega","Ω"],["alpha","α"],["beta","β"],["gamma","γ"],["delta","δ"],["epsilon","ε"],["zeta","ζ"],["eta","η"],["theta","θ"],["iota","ι"],["kappa","κ"],["lambda","λ"],["mu","μ"],["nu","ν"],["xi","ξ"],["omicron","ο"],["pi","π"],["rho","ρ"],["sigmaf","ς"],["sigma","σ"],["tau","τ"],["upsilon","υ"],["phi","φ"],["chi","χ"],["psi","ψ"],["omega","ω"],["thetasym","ϑ"],["upsih","ϒ"],["piv","ϖ"],["middot","·"],["nbsp"," "],["quot","'"],["amp","&"],["lt","<"],["gt",">"],["OElig","Œ"],["oelig","œ"],["Scaron","Š"],["scaron","š"],["Yuml","Ÿ"],["fnof","ƒ"],["circ","ˆ"],["tilde","˜"],["ensp",""],["emsp",""],["thinsp",""],["zwnj",""],["zwj",""],["lrm",""],["rlm",""],["ndash","–"],["mdash","—"],["lsquo","‘"],["rsquo","’"],["sbquo","‚"],["ldquo","“"],["rdquo","”"],["bdquo","„"],["dagger","†"],["Dagger","‡"],["bull","•"],["hellip","…"],["permil","‰"],["prime","′"],["Prime","″"],["lsaquo","‹"],["rsaquo","›"],["oline","‾"],["euro","€"],["trade","™"],["larr","←"],["uarr","↑"],["rarr","→"],["darr","↓"],["harr","↔"],["crarr","↵"],["lceil","⌈"],["rceil","⌉"],["lfloor","⌊"],["rfloor","⌋"],["loz","◊"],["spades","♠"],["clubs","♣"],["hearts","♥"],["diams","♦"],["#8203",""]]);function De(e){const t=new Map,n=e.split(",");for(let e=0;e<n.length;e++)t.set(n[e],!0);return t}function Be(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})}function ke(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}function $e(e,t){const n=[];if(t)switch(e.forEach((e,t)=>{n[t]={},n[t].n=e}),t.length){case 1:e.forEach((e,r)=>{n[r].v=t[0]});break;case 2:e.forEach((e,r)=>{n[r].v=r%2?t[1]:t[0]});break;case 3:e.forEach((e,r)=>{n[r].v=r%2?t[1]:t[r]});break;default:e.forEach((e,r)=>{n[r].v=t[r]})}return n}function je(e){return"number"==typeof e||"string"==typeof e}const Me=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,ze=/^<\/([-A-Za-z0-9_]+)[^>]*>/,Ue=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,We=De("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr"),Ge=De("br,a,code,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),Je=De("abbr,acronym,applet,b,basefont,bdo,big,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),He=De("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),qe=De("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),Ze=De("script,style,block");const Ve=["NOTE","WARNING","ERROR"],Xe=new Map([["aliceblue","#F0F8FF"],["antiquewhite","#FAEBD7"],["aqua","#00FFFF"],["aquamarine","#7FFFD4"],["azure","#F0FFFF"],["beige","#F5F5DC"],["bisque","#FFE4C4"],["black","#000000"],["blanchedalmond","#FFEBCD"],["blue","#0000FF"],["blueviolet","#8A2BE2"],["brown","#A52A2A"],["burlywood","#DEB887"],["cadetblue","#5F9EA0"],["chartreuse","#7FFF00"],["chocolate","#D2691E"],["coral","#FF7F50"],["cornflowerblue","#6495ED"],["cornsilk","#FFF8DC"],["crimson","#DC143C"],["cyan","#00FFFF"],["darkblue","#00008B"],["darkcyan","#008B8B"],["darkgoldenrod","#B8860B"],["darkgray","#A9A9A9"],["darkgreen","#006400"],["darkgrey","#A9A9A9"],["darkkhaki","#BDB76B"],["darkmagenta","#8B008B"],["darkolivegreen","#556B2F"],["darkorange","#FF8C00"],["darkorchid","#9932CC"],["darkred","#8B0000"],["darksalmon","#E9967A"],["darkseagreen","#8FBC8F"],["darkslateblue","#483D8B"],["darkslategray","#2F4F4F"],["darkslategrey","#2F4F4F"],["darkturquoise","#00CED1"],["darkviolet","#9400D3"],["deeppink","#FF1493"],["deepskyblue","#00BFFF"],["dimgray","#696969"],["dimgrey","#696969"],["dodgerblue","#1E90FF"],["firebrick","#B22222"],["floralwhite","#FFFAF0"],["forestgreen","#228B22"],["fuchsia","#FF00FF"],["gainsboro","#DCDCDC"],["ghostwhite","#F8F8FF"],["gold","#FFD700"],["goldenrod","#DAA520"],["gray","#808080"],["green","#008000"],["greenyellow","#ADFF2F"],["grey","#808080"],["honeydew","#F0FFF0"],["hotpink","#FF69B4"],["indianred","#CD5C5C"],["indigo","#4B0082"],["ivory","#FFFFF0"],["khaki","#F0E68C"],["lavender","#E6E6FA"],["lavenderblush","#FFF0F5"],["lawngreen","#7CFC00"],["lemonchiffon","#FFFACD"],["lightblue","#ADD8E6"],["lightcoral","#F08080"],["lightcyan","#E0FFFF"],["lightgoldenrodyellow","#FAFAD2"],["lightgray","#D3D3D3"],["lightgreen","#90EE90"],["lightgrey","#D3D3D3"],["lightpink","#FFB6C1"],["lightsalmon","#FFA07A"],["lightseagreen","#20B2AA"],["lightskyblue","#87CEFA"],["lightslategray","#778899"],["lightslategrey","#778899"],["lightsteelblue","#B0C4DE"],["lightyellow","#FFFFE0"],["lime","#00FF00"],["limegreen","#32CD32"],["linen","#FAF0E6"],["magenta","#FF00FF"],["maroon","#800000"],["mediumaquamarine","#66CDAA"],["mediumblue","#0000CD"],["mediumorchid","#BA55D3"],["mediumpurple","#9370DB"],["mediumseagreen","#3CB371"],["mediumslateblue","#7B68EE"],["mediumspringgreen","#00FA9A"],["mediumturquoise","#48D1CC"],["mediumvioletred","#C71585"],["midnightblue","#191970"],["mintcream","#F5FFFA"],["mistyrose","#FFE4E1"],["moccasin","#FFE4B5"],["navajowhite","#FFDEAD"],["navy","#000080"],["oldlace","#FDF5E6"],["olive","#808000"],["olivedrab","#6B8E23"],["orange","#FFA500"],["orangered","#FF4500"],["orchid","#DA70D6"],["palegoldenrod","#EEE8AA"],["palegreen","#98FB98"],["paleturquoise","#AFEEEE"],["palevioletred","#DB7093"],["papayawhip","#FFEFD5"],["peachpuff","#FFDAB9"],["peru","#CD853F"],["pink","#FFC0CB"],["plum","#DDA0DD"],["powderblue","#B0E0E6"],["purple","#800080"],["red","#FF0000"],["rosybrown","#BC8F8F"],["royalblue","#4169E1"],["saddlebrown","#8B4513"],["salmon","#FA8072"],["sandybrown","#F4A460"],["seagreen","#2E8B57"],["seashell","#FFF5EE"],["sienna","#A0522D"],["silver","#C0C0C0"],["skyblue","#87CEEB"],["slateblue","#6A5ACD"],["slategray","#708090"],["slategrey","#708090"],["snow","#FFFAFA"],["springgreen","#00FF7F"],["steelblue","#4682B4"],["tan","#D2B48C"],["teal","#008080"],["thistle","#D8BFD8"],["tomato","#FF6347"],["turquoise","#40E0D0"],["violet","#EE82EE"],["wheat","#F5DEB3"],["white","#FFFFFF"],["whitesmoke","#F5F5F5"],["yellow","#FFFF00"],["yellowgreen","#9ACD32"]]),Ke=["px","%"],Qe=/^[-+]?[0-9]*\.?[0-9]+(.*)$/,Ye=/^#[0-9a-fA-F]{6}$/,et=/^#[0-9a-fA-F]{3}$/,tt=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/,nt=/^rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d*\.?\d+)\s*\)$/,rt=/^hsl\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*\)$/,ot=/^hsla\(\s*(\d+)\s*,\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d*\.?\d+)\s*\)$/,st=/^[-+]?[0-9]+$/,it=/^url\(\s*['"]?\s*([^()]+?)\s*['"]?\s*\)$/,at=/^[a-zA-Z_][a-zA-Z0-9]*$/,lt=/^[-+]?[0-9]*\.?[0-9]+$/,dt={length:function(e,t){const n=(e=(e||"").toString()).match(Qe);if(t||(t=Ke),n){const r=n[1];return r?t.indexOf(r.toLowerCase())>=0?{value:e}:{value:parseFloat(e)+t[0],reason:function(e,n,o){return"ERROR: 属性 `"+ke(e)+"` 不支持单位 `"+r+"`, 目前仅支持 `"+JSON.stringify(t)+"`"}}:{value:parseFloat(e)+t[0],reason:function(e,n,r){return"WARNING: 属性 `"+ke(e)+"` 没有指定单位，默认为 `"+t[0]+"`"}}}return{value:null,reason:function(e,t,n){return"ERROR: 属性 `"+ke(e)+"` 的值 `"+t+"` 不正确(仅支持数值)"}}},color:function(e){if((e=(e||"").toString()).match(Ye))return{value:e};if(e.match(et))return{value:"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3],reason:function(e,t,n){return"NOTE: 颜色值 `"+t+"` 转换为 `"+n+"`"}};if(Xe.get(e))return{value:Xe.get(e),reason:function(e,t,n){return"NOTE: 颜色值 `"+t+"` 转换为 `"+n+"`"}};let t,n,r,o,s,i,a,l;return(t=tt.exec(e))&&(n=parseInt(t[1]),r=parseInt(t[2]),o=parseInt(t[3]),n>=0&&n<=255&&r>=0&&r<=255&&o>=0&&o<=255)?{value:"rgb("+[n,r,o].join(",")+")"}:(t=nt.exec(e))&&(n=parseInt(t[1]),r=parseInt(t[2]),o=parseInt(t[3]),s=parseFloat(t[4]),n>=0&&n<=255&&r>=0&&r<=255&&o>=0&&o<=255&&s>=0&&s<=1)?{value:"rgba("+[n,r,o,s].join(",")+")"}:(t=rt.exec(e)||ot.exec(e))&&(i=parseInt(t[1]),a=parseInt(t[2]),l=parseInt(t[3]),s=parseFloat(t[4]),i>=0&&i<=360&&a>=0&&a<=100&&l>=0&&l<=100)?s>=0&&s<=1?{value:`hsla(${i},${a}%,${l}%,${s})`}:{value:`hsl(${i},${a}%,${l}%)`}:"transparent"===e?{value:"rgba(0,0,0,0)"}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的颜色值 `"+t+"` 无效`"}}},number:function(e){const t=(e=(e||"").toString()).match(lt);return t&&!t[1]?{value:parseFloat(e)}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的值 `"+t+"` 无效 ` (仅支持数值)"}}},integer:function(e){return(e=(e||"").toString()).match(st)?{value:parseInt(e,10)}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的值 `"+t+"` 无效 ` (仅支持整数)"}}},url:function(e){if((e=(e||"").toString().trim()).match(/^none$/i))return{value:"none"};const t=it.exec(e);return t?{value:t[1]}:{value:null,reason:function(e,t,n){return"WARNING: 属性`"+ke(e)+"` 的值 `"+t+"` 必须是 none 或者 url(...)"}}},name:function(e){return(e=(e||"").toString()).match(at)?{value:e}:{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的值 `"+t+"` 格式不正确"}}},enum:function(e,t){const n=e.indexOf(t);return n>0?{value:t}:0===n?{value:t,reason:function(e,t,n){return"NOTE:  属性`"+ke(e)+"` 的值 `"+t+"` 是缺省值(可以忽略不写)"}}:{value:null,reason:function(t,n,r){return"ERROR: 属性`"+ke(t)+"` 的值 `"+n+"` 无效 ` (有效枚举值为: `"+e.join("`|`")+"`)"}}},arraylength:function(e,t,n){const r=(t=(t||"").toString()).split(/\s+/);if(r&&r.length<=4){const t=[];let o;const s=[];let i=0;return r.forEach((e,r)=>{if(je((o=dt.length(e,n)).value)&&t.push(o.value),o.reason){let t=o.reason(r.toString(),e,o.value);const n=t.match(/^([A-Z]+):/);if(n){const e=Ve.indexOf(n[1]);i<Ve.indexOf(n[1])&&(i=e),t=t.replace(n[0],"").trim()}s.push(t)}}),{value:i<2?$e(e,t):null,reason:s.length>0?function(e,t,n){return Ve[i]+": 属性`"+ke(e)+"` 的值 `"+t+"` 存在问题: \n  "+s.join("\n  ")}:null}}return{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的值 `"+t+"` 格式不正确"}}},arraycolor:function(e,t){const n=(t=(t||"").toString()).split(/\s+/);if(n&&n.length<=4){const t=[];let r;const o=[];let s=0;return n.forEach((e,n)=>{if(je((r=dt.color(e)).value)&&t.push(r.value),r.reason){let t=r.reason(n.toString(),e,r.value);const i=t.match(/^([A-Z]+):/);if(i){const e=Ve.indexOf(i[1]);s<Ve.indexOf(i[1])&&(s=e),t=t.replace(i[0],"").trim()}o.push(t)}}),{value:s<2?$e(e,t):null,reason:o.length>0?function(e,t,n){return Ve[s]+": 属性`"+ke(e)+"` 的值 `"+t+"` 存在问题: \n  "+o.join("\n  ")}:null}}return{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的值 `"+t+"` 格式不正确"}}},border:function(e,t){const n=(e=(e||"").toString()).split(/\s+/);if(n&&n.length<=3){let e,r=[];const o=[];let s=0;const i=[];let a=-1;return n.forEach((n,a)=>{if(je(dt.length(n,t).value)?(i.push(0),(e=ut.borderWidth(n)).value instanceof Array&&(r=r.concat(e.value))):je(ut.borderStyle(n).value)?(i.push(1),e=ut.borderStyle(n),r.push({n:"borderStyle",v:n})):je(dt.color(n).value)?(i.push(2),(e=ut.borderColor(n)).value instanceof Array&&(r=r.concat(e.value))):(e={},s=2,o.push("属性`"+a+"` 的值 `"+n+"` 存在问题: \n  不满足width、style和color的检验标准")),e&&e.reason){let t=e.reason(a.toString(),n,e.value);const r=t.match(/^([A-Z]+):/);if(r){const e=Ve.indexOf(r[1]);s<Ve.indexOf(r[1])&&(s=e),t=t.replace(r[0],"").trim()}o.push(t)}}),i.forEach(e=>{e>a?a=e:(s=2,o.push("必须按顺序设置属性width style color"))}),{value:s<2?r:null,reason:o.length>0?function(e,t,n){return Ve[s]+": 属性`"+ke(e)+"` 的值 `"+t+"` 存在问题: \n  "+o.join("\n  ")}:null}}return{value:null,reason:function(e,t,n){return"ERROR: 属性`"+ke(e)+"` 的值 `"+t+"` 格式不正确"}}},display:function(e){e=(e||"").toString();const t=["flex","none"],n=t.indexOf(e);return n>0?{value:e}:"block"===e?{value:"flex",reason:function(e,n,r){return"ERROR: 属性`"+ke(e)+"` 的值 `"+n+"` 需修改为flex ` (有效枚举值为: `"+t.join("`|`")+"`)"}}:0===n?{value:e,reason:!1}:{value:null,reason:function(e,n,r){return"ERROR: 属性`"+ke(e)+"` 的值 `"+n+"` 无效 ` (有效枚举值为: `"+t.join("`|`")+"`)"}}}};function ct(e){return dt.enum.bind(null,e)}function ht(e,t){return dt[e].bind(null,t)}const ut={width:dt.length,height:dt.length,padding:ht("arraylength",["paddingTop","paddingRight","paddingBottom","paddingLeft"]),paddingLeft:dt.length,paddingRight:dt.length,paddingTop:dt.length,paddingBottom:dt.length,margin:ht("arraylength",["marginTop","marginRight","marginBottom","marginLeft"]),marginLeft:dt.length,marginRight:dt.length,marginTop:dt.length,marginBottom:dt.length,border:dt.border,borderWidth:ht("arraylength",["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"]),borderLeftWidth:dt.length,borderTopWidth:dt.length,borderRightWidth:dt.length,borderBottomWidth:dt.length,borderColor:ht("arraycolor",["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"]),borderLeftColor:dt.color,borderTopColor:dt.color,borderRightColor:dt.color,borderBottomColor:dt.color,borderStyle:ct(["solid","dotted","dashed"]),borderRadius:dt.length,borderBottomLeftRadius:dt.length,borderBottomRightRadius:dt.length,borderTopLeftRadius:dt.length,borderTopRightRadius:dt.length,flex:dt.number,flexGrow:dt.number,flexShrink:dt.number,flexBasis:dt.length,flexDirection:ct(["row","column"]),flexWrap:ct(["nowrap","wrap","wrap-reverse"]),justifyContent:ct(["flex-start","flex-end","center","space-between"]),alignItems:ct(["stretch","flex-start","flex-end","center"]),alignContent:ct(["stretch","flex-start","flex-end","center","space-between","space-around"]),position:ct(["none","fixed"]),top:dt.length,bottom:dt.length,left:dt.length,right:dt.length,zIndex:dt.integer,opacity:dt.number,backgroundColor:dt.color,backgroundImage:dt.url,backgroundRepeat:ct(["no-repeat","repeat","repeat-x","repeat-y"]),backgroundPosition:dt.position,display:dt.display,visibility:ct(["visible","hidden"]),lines:dt.integer,color:dt.color,fontSize:dt.length,fontStyle:ct(["normal","italic"]),fontWeight:ct(["normal","bold"]),textDecoration:ct(["none","underline","line-through"]),textAlign:ct(["left","center","right"]),lineHeight:dt.length,textOverflow:ct(["clip","ellipsis"]),placeholderColor:dt.color,selectedColor:dt.color,textColor:dt.color,timeColor:dt.color,textHighlightColor:dt.color,strokeWidth:dt.length,progressColor:dt.color,resizeMode:ct(["cover","contain","stretch","center"]),columns:dt.number,columnSpan:dt.number};function pt(e,t){const n={},r=[],o=function(e,t){let n,r;const o=ut[e];return"function"==typeof o?(n="function"!=typeof t?o(t):{value:t}).reason&&(r={reason:n.reason(e,t,n.value)}):(n={value:t},r={reason:"ERROR: 样式名 `"+ke(e)+"` 不支持"}),{value:n.value instanceof Array?n.value:[{n:e,v:n.value}],log:r}}(Be(e),t);return o.value.forEach(e=>{je(e.v)&&r.push(e)}),r&&(n.value=r),o.log&&(n.log=o.log.reason),n}const mt=new Map([["img","image"],["p","text"],["h1","text"],["h2","text"],["h3","text"],["h4","text"],["h5","text"],["h6","text"],["b","span"],["strong","span"],["i","span"],["del","span"],["article","div"],["br","span"]]);function ft(e){const t=mt.get(e);return void 0!==t?t:e}const gt={div:{},h1:{fontSize:"60px",fontWeight:"normal"},h2:{fontSize:"45px",fontWeight:"normal"},h3:{fontWeight:"normal",fontSize:"35px"},h4:{fontWeight:"normal",fontSize:"30px"},h5:{fontWeight:"normal",fontSize:"25px"},h6:{fontWeight:"normal",fontSize:"20px"},b:{fontWeight:"bold"},strong:{fontWeight:"bold"},i:{fontStyle:"italic"},a:{color:"#00BFFF"},del:{textDecoration:"line-through"}};function _t(e){let t={};return gt[e]&&(t=gt[e]),t}const bt={br:{value:"\n"}};function yt(e){let t={};return bt[e]&&(t=bt[e]),t}function vt(e,t,n){const r="html"!==t,o="edit"===n;e=function(e){return e.replace(/<\?xml.*\?>\n/,"").replace(/<.*!doctype.*>\n/,"").replace(/<.*!DOCTYPE.*>\n/,"")}(e),e=e.replace(/&([a-zA-Z#0-9]+?);/g,(e,t)=>Le.get[t]||"&"+t+";").replace(/\r\n?/g,"");const s=[],i={type:"div",children:[],events:{},classList:[],attr:{},style:{flex:1,flexDirection:"column"}};return function(e,t){let n,r,o;const s=[];let i=e;for(s.last=function(){return this[this.length-1]};e;){if(r=!0,s.last()&&Ze.has(s.last()))e=e.replace(new RegExp("([\\s\\S]*?)(</"+s.last()+"[^>]*>)","i"),function(e,n){return n=n.replace(/<!--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1"),t.text&&t.text(n),""}),l(0,s.last());else if(0===e.indexOf("\x3c!--")?(n=e.indexOf("--\x3e"))>=0&&(t.comment&&t.comment(e.substring(4,n)),e=e.substring(n+3),r=!1):0===e.indexOf("</")?(o=e.match(ze))&&(e=e.substring(o[0].length),o[0].replace(ze,l),r=!1):0===e.indexOf("<")&&(o=e.match(Me))&&(e=e.substring(o[0].length),o[0].replace(Me,a),r=!1),r){n=e.indexOf("<");let r="";for(;0===n;)r+="<",n=(e=e.substring(1)).indexOf("<");r+=n<0?e:e.substring(0,n),e=n<0?"":e.substring(n),t.text&&t.text(r)}e===i&&console.error("### App Parser ### 解析错误: "+e),i=e}function a(e,n,r,o){if(n=n.toLowerCase(),Ge.has(n))for(;s.last()&&Je.has(s.last());)l(0,s.last());if(He.has(n)&&s.last()===n&&l(0,n),(o=We.has(n)||!!o)||s.push(n),t.start){const e=[];r.replace(Ue,function(t,n){const r=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:qe.has(n)?n:"";e.push({name:n,value:r,escaped:r.replace(/(^|[^\\])"/g,'$1\\"')})}),t.start&&t.start(n,e,o)}}function l(e,n){let r=0;if(n)for(n=n.toLowerCase(),r=s.length-1;r>=0&&s[r]!==n;r--);if(r>=0){for(let e=s.length-1;e>=r;e--)t.end&&t.end(s[e]);s.length=r}}l()}(e,{start:function(e,t,n){const a={type:r?e:ft(e),children:[],events:{},classList:[],attr:r?{}:yt(e),style:r?{}:_t(e)};if(0!==t.length&&(a.attr=t.reduce(function(e,t){const n=Be(t.name);let r=t.value;return"class"===n?a.classList=r.split(/\s+/):"style"===n?r.split(";").forEach(function(e){let t,n,r=e.trim().split(":");r.length>2&&(r[1]=r.slice(1).join(":"),r=r.slice(0,2)),2===r.length&&((n=pt(t=r[0].trim(),r[1].trim())).value&&n.value.forEach(e=>{je(e.v)&&(a.style[e.n]=e.v)}),n.log&&console.warn("### App Parser ###",n.log))}):"id"===n?a.id=r:o?e[n]=r:(r.match(/ /)&&(r=r.split(" ")),e[n]?Array.isArray(e[n])?e[n].push(r):e[n]=[e[n],r]:e[n]=r),e},{})),r||"source"!==a.type||(i.source=a.attr.src),n){const e=s[0]||i;void 0===e.children&&(e.children=[]),e.children.push(a)}else s.unshift(a)},end:function(e){const t=r?e:ft(e),n=s.shift();if(n.type!==t&&console.error("### App Parser ### 结束标签不匹配:",e),!r&&"video"===n.type&&i.source&&(n.attr.src=i.source,delete i.source),0===s.length)i.children.push(n);else{const e=s[0];void 0===e.children&&(e.children=[]),e.children.push(n)}},text:function(e){if(""!==e.slice().replace(/\s*/,"")){const t=s[0];if(!o||t&&-1!==["text","a","span"].indexOf(t.type)){if(t)if(-1!==["text","a"].indexOf(t.type)){const n={type:"span",children:[],events:{},classList:[],attr:{value:e},style:{},polyfill:!0};void 0===t.children&&(t.children=[]),t.children.push(n)}else t.attr.value=e}else{const n={type:"text",children:[],events:{},classList:[],attr:{value:e},style:{}};(t||i).children.push(n)}}},comment:function(e){}}),global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Parser ### 解析${t}文本成功：${JSON.stringify(i)}`),i}var Ct={compile:vt,parseHTML:function(e){const t=vt(e,"","edit");return function e(t){if(t.children){-1!==["text","a"].indexOf(t.type)&&(t.children.length>0&&delete t.attr.value,1===t.children.length&&t.children[0].polyfill&&(t.attr=Object.assign(t.attr,t.children[0].attr),t.children=[]));for(let n=0,r=t.children.length;n<r;n++){const r=t.children[n];e(r)}}}(t),t.children||[]}};var wt={compile:function(e,t){return""===(e=e.trim())&&(e="<div></div>"),Ct.compile(e,t)},validateStyle:pt,parseHTML:Ct.parseHTML};const Et={Listener:ge,Streamer:_e,helper:Ce,misc:q},At={Node:i,Event:t,TouchEvent:n,DomDocument:pe,freeze:me},Ft={animation:class{constructor(e,t,n={},r){this.page=e,this.commonParams={componentId:t.ref,animationId:(Fe++).toString()},n.options&&n.options.iterations===1/0&&(n.options.iterations=-1),this.initParams=Object.assign(n,this.commonParams),this.animationModule=r,this.animationModule.enable(this.initParams)}set finished(e){console.warn("### App Framework ### Animation Api: finished 是只读属性")}get finished(){return this.animationModule.getFinished(this.commonParams)}set playState(e){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: playState 是只读属性")}get playState(){const e=this.animationModule.getPlayState(this.commonParams);return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### Animation Api: 获取 playState 状态为：${e}`),e}set startTime(e=""){Object.assign(this.commonParams,{startTime:e}),this.animationModule.setStartTime(this.commonParams)}get startTime(){const e=this.animationModule.getStartTime(this.commonParams);return global.Env&&"trace"===global.Env.logLevel&&console.trace(`### App Framework ### Animation Api: 获取 startTime 状态为：${e}`),e}set onfinish(e){this.animationModule.onfinish({componentId:this.commonParams.componentId,animationId:this.commonParams.animationId,success:()=>{e&&e()}})}get onfinish(){return()=>{}}set oncancel(e){this.animationModule.oncancel({componentId:this.commonParams.componentId,animationId:this.commonParams.animationId,success:()=>{e&&e()}})}get oncancel(){return()=>{}}play(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 play 方法"),this.animationModule.play(this.commonParams)}finish(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 finish 方法"),this.animationModule.finish(this.commonParams)}pause(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 pause 方法"),this.animationModule.pause(this.commonParams)}cancel(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 cancel 方法"),this.animationModule.cancel(this.commonParams)}reverse(){global.Env&&"trace"===global.Env.logLevel&&console.trace("### App Framework ### Animation Api: 调用 reverse 方法"),this.animationModule.reverse(this.commonParams)}},canvas:Ie,parser:wt};e.Runtime=we,e.Base64=Ae,e.runtime=Et,e.dom=At,e.bundles=Ft,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=infras-ext.js.map
